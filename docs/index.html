<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Introduction - SimpleQBN</title>
    <meta name="description" content="Because nothing about quality-based narratives is actually simple.">
    <link rel="stylesheet" href="/simple-qbn/assets/css/style.css">
</head>
<body>
    <div class="book">
        <nav class="sidebar">
  <div class="book-summary">
    <h2>SimpleQBN</h2>
    <ul class="summary">
      
      <li class="chapter ">
        
        <a href="/simple-qbn/">Introduction</a>
        
        
      </li>
      
      <li class="chapter has-children">
        
        <span class="section-title">History of Related Terms</span>
        
        
        <ul class="articles">
          
          <li>
            <a href="/simple-qbn/scenes">Scenes and Cycles (1983)</a>
          </li>
          
          <li>
            <a href="/simple-qbn/episodes">Episodes and Sequences (1989)</a>
          </li>
          
          <li>
            <a href="/simple-qbn/sculpturalmodel">Sculptural Hypertext Model (2001)</a>
          </li>
          
          <li>
            <a href="/simple-qbn/storylet">Storylet (2010)</a>
          </li>
          
          <li>
            <a href="/simple-qbn/qbn">Quality-Based Narrative (2010)</a>
          </li>
          
        </ul>
        
      </li>
      
      <li class="chapter has-children">
        
        <span class="section-title">Metaphors in SimpleQBN</span>
        
        
        <ul class="articles">
          
          <li>
            <a href="/simple-qbn/expressions">Expressions and QualitySet</a>
          </li>
          
          <li>
            <a href="/simple-qbn/cards">Decks and Cards</a>
          </li>
          
          <li>
            <a href="/simple-qbn/State">State Management</a>
          </li>
          
        </ul>
        
      </li>
      
      <li class="chapter has-children">
        
        <span class="section-title">Examples</span>
        
        
        <ul class="articles">
          
          <li>
            <a href="/simple-qbn/examples/deckbuilding">Deck Building</a>
          </li>
          
          <li>
            <a href="/simple-qbn/examples/storygates">Story Gates</a>
          </li>
          
          <li>
            <a href="/simple-qbn/examples/webbuild">Bundled for Web</a>
          </li>
          
        </ul>
        
      </li>
      
    </ul>
  </div>
</nav>

        <div class="book-body">
            <div class="body-inner">
                <div class="page-wrapper">
                    <div class="page-inner">
                        <div class="markdown-section">
<h1 id="simpleqbn">SimpleQBN</h1>

<p><em>Because nothing about quality-based narratives is actually simple.</em></p>

<p>SimpleQBN is a quality-based narrative (QBN) generic JavaScript library for use in browsers or Node.js-based projects. It provides state management and resolves expressions for checking openness (availability) based on states changes.</p>

<p>This project is based on another project <a href="https://github.com/videlais/quis">Quis</a>, which it uses to resolve expressions.</p>

<h2 id="installation">Installation</h2>

<h3 id="for-use-in-your-project">For Use in Your Project</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install </span>simple-qbn
</code></pre></div></div>

<h3 id="for-development">For Development</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/videlais/simple-qbn.git
<span class="nb">cd </span>simple-qbn
npm <span class="nb">install</span>
</code></pre></div></div>

<h2 id="usage">Usage</h2>

<h3 id="as-an-npm-package">As an NPM Package</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Original architecture</span>
<span class="k">import</span> <span class="nx">State</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">simple-qbn/State</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">Card</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">simple-qbn/Card</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">Deck</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">simple-qbn/Deck</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Or reactive architecture</span>
<span class="k">import</span> <span class="nx">ReactiveState</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">simple-qbn/reactive/State</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">ReactiveCard</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">simple-qbn/reactive/Card</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">ReactiveDeck</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">simple-qbn/reactive/Deck</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="in-the-browser">In the Browser</h3>

<p>Download the pre-built bundles from the <code class="language-javascript highlighter-rouge"><span class="nx">build</span><span class="o">/</span></code> directory:</p>
<ul>
  <li><code class="language-javascript highlighter-rouge"><span class="nx">simpleqbn</span><span class="p">.</span><span class="nx">bundle</span><span class="p">.</span><span class="nx">js</span></code> - Original architecture (~20KB minified)</li>
  <li><code class="language-javascript highlighter-rouge"><span class="nx">reactive</span><span class="o">-</span><span class="nx">simpleqbn</span><span class="p">.</span><span class="nx">bundle</span><span class="p">.</span><span class="nx">js</span></code> - Reactive architecture (~29KB minified)</li>
</ul>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- Original architecture --&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"simpleqbn.bundle.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script&gt;</span>
  <span class="kd">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimpleQBN</span><span class="p">.</span><span class="nc">State</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">deck</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimpleQBN</span><span class="p">.</span><span class="nc">Deck</span><span class="p">();</span>
<span class="nt">&lt;/script&gt;</span>

<span class="c">&lt;!-- OR Reactive architecture --&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"reactive-simpleqbn.bundle.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script&gt;</span>
  <span class="kd">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ReactiveSimpleQBN</span><span class="p">.</span><span class="nc">ReactiveState</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">deck</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ReactiveSimpleQBN</span><span class="p">.</span><span class="nc">ReactiveDeck</span><span class="p">([],</span> <span class="nx">state</span><span class="p">);</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<h2 id="state-and-reactive-state">State and Reactive State</h2>

<p>SimpleQBN provides two distinct architectures for managing game state:</p>

<ul>
  <li>Manual, State-based, and;</li>
  <li>Automatic, Reactive State-based.</li>
</ul>

<p><strong>These two systems are incompatible and cannot be mixed within the same application.</strong></p>

<h3 id="original-state-architecture">Original State Architecture</h3>

<p>The original architecture uses the <code class="language-javascript highlighter-rouge"><span class="nx">State</span></code> class along with <code class="language-javascript highlighter-rouge"><span class="nx">Card</span></code>, <code class="language-javascript highlighter-rouge"><span class="nx">Deck</span></code>, <code class="language-javascript highlighter-rouge"><span class="nx">Expression</span></code>, and <code class="language-javascript highlighter-rouge"><span class="nx">QualitySet</span></code> classes. This architecture requires manual state passing and explicit availability checking.</p>

<p><strong>Key Classes:</strong> <code class="language-javascript highlighter-rouge"><span class="nx">State</span></code>, <code class="language-javascript highlighter-rouge"><span class="nx">Card</span></code>, <code class="language-javascript highlighter-rouge"><span class="nx">Deck</span></code>, <code class="language-javascript highlighter-rouge"><span class="nx">Expression</span></code>, <code class="language-javascript highlighter-rouge"><span class="nx">QualitySet</span></code></p>

<p><strong>Example:</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">State</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">simple-qbn/State</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">Card</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">simple-qbn/Card</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">Deck</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">simple-qbn/Deck</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Create game state</span>
<span class="kd">const</span> <span class="nx">gameState</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">State</span><span class="p">();</span>
<span class="nx">gameState</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">health</span><span class="dl">'</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
<span class="nx">gameState</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">hasKey</span><span class="dl">'</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

<span class="c1">// Create cards with quality requirements</span>
<span class="kd">const</span> <span class="nx">healingCard</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Card</span><span class="p">(</span>
    <span class="dl">'</span><span class="s1">Drink a healing potion</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">[</span><span class="dl">'</span><span class="s1">$health &lt; 80</span><span class="dl">'</span><span class="p">]);</span>
<span class="kd">const</span> <span class="nx">doorCard</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Card</span><span class="p">(</span>
    <span class="dl">'</span><span class="s1">Open the locked door</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">[</span><span class="dl">'</span><span class="s1">$hasKey == true</span><span class="dl">'</span><span class="p">]);</span>

<span class="c1">// Create deck and add cards</span>
<span class="kd">const</span> <span class="nx">deck</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Deck</span><span class="p">();</span>
<span class="nx">deck</span><span class="p">.</span><span class="nf">addCard</span><span class="p">(</span>
    <span class="nx">healingCard</span><span class="p">.</span><span class="nx">content</span><span class="p">,</span>
    <span class="nx">healingCard</span><span class="p">.</span><span class="nx">qualities</span><span class="p">);</span>
<span class="nx">deck</span><span class="p">.</span><span class="nf">addCard</span><span class="p">(</span>
    <span class="nx">doorCard</span><span class="p">.</span><span class="nx">content</span><span class="p">,</span>
    <span class="nx">doorCard</span><span class="p">.</span><span class="nx">qualities</span><span class="p">);</span>

<span class="c1">// Check availability manually.</span>
<span class="c1">// Need to pass state each time.</span>
<span class="kd">const</span> <span class="nx">availableCards</span> <span class="o">=</span> <span class="nx">deck</span><span class="p">.</span><span class="nf">draw</span><span class="p">(</span><span class="nx">gameState</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">availableCards</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="s2"> cards available`</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="reactive-architecture">Reactive Architecture</h3>

<p>The reactive architecture uses <code class="language-javascript highlighter-rouge"><span class="nx">ReactiveState</span></code> with <code class="language-javascript highlighter-rouge"><span class="nx">ReactiveCard</span></code>, <code class="language-javascript highlighter-rouge"><span class="nx">ReactiveDeck</span></code>, <code class="language-javascript highlighter-rouge"><span class="nx">ReactiveExpression</span></code>, and <code class="language-javascript highlighter-rouge"><span class="nx">ReactiveQualitySet</span></code>. This architecture provides automatic updates and event-driven state management.</p>

<p><strong>Key Classes:</strong> <code class="language-javascript highlighter-rouge"><span class="nx">ReactiveState</span></code>, <code class="language-javascript highlighter-rouge"><span class="nx">ReactiveCard</span></code>, <code class="language-javascript highlighter-rouge"><span class="nx">ReactiveDeck</span></code>, <code class="language-javascript highlighter-rouge"><span class="nx">ReactiveExpression</span></code>, <code class="language-javascript highlighter-rouge"><span class="nx">ReactiveQualitySet</span></code></p>

<p><strong>Example:</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">ReactiveState</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">simple-qbn/reactive/State</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">ReactiveCard</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">simple-qbn/reactive/Card</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">ReactiveDeck</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">simple-qbn/reactive/Deck</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Create reactive game state.</span>
<span class="kd">const</span> <span class="nx">gameState</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ReactiveState</span><span class="p">();</span>
<span class="nx">gameState</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">health</span><span class="dl">'</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
<span class="nx">gameState</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">hasKey</span><span class="dl">'</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

<span class="c1">// Create reactive cards.</span>
<span class="kd">const</span> <span class="nx">healingCard</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ReactiveCard</span><span class="p">(</span>
    <span class="dl">'</span><span class="s1">Drink a healing potion</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">[</span><span class="dl">'</span><span class="s1">$health &lt; 80</span><span class="dl">'</span><span class="p">]);</span>
<span class="kd">const</span> <span class="nx">doorCard</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ReactiveCard</span><span class="p">(</span>
    <span class="dl">'</span><span class="s1">Open the locked door</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">[</span><span class="dl">'</span><span class="s1">$hasKey == true</span><span class="dl">'</span><span class="p">]);</span>

<span class="c1">// Create reactive deck and bind to state.</span>
<span class="kd">const</span> <span class="nx">deck</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ReactiveDeck</span><span class="p">(</span>
    <span class="p">[</span><span class="nx">healingCard</span><span class="p">,</span> <span class="nx">doorCard</span><span class="p">],</span>
    <span class="nx">gameState</span><span class="p">);</span>

<span class="c1">// Subscribe to automatic updates.</span>
<span class="nx">deck</span><span class="p">.</span><span class="nf">subscribe</span><span class="p">((</span><span class="nx">availableCards</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">availableCards</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="s2"> cards now available`</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// State changes trigger automatic updates.</span>
<span class="nx">gameState</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">health</span><span class="dl">'</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="architecture-compatibility">Architecture Compatibility</h3>

<p><strong>Important:</strong> The two architectures are mutually exclusive:</p>

<ul>
  <li><strong>Original classes</strong> (<code class="language-javascript highlighter-rouge"><span class="nx">Card</span></code>, <code class="language-javascript highlighter-rouge"><span class="nx">Deck</span></code>, etc.) work only with <code class="language-javascript highlighter-rouge"><span class="nx">State</span></code></li>
  <li><strong>Reactive classes</strong> (<code class="language-javascript highlighter-rouge"><span class="nx">ReactiveCard</span></code>, <code class="language-javascript highlighter-rouge"><span class="nx">ReactiveDeck</span></code>, etc.) work only with <code class="language-javascript highlighter-rouge"><span class="nx">ReactiveState</span></code></li>
  <li>You cannot pass a <code class="language-javascript highlighter-rouge"><span class="nx">State</span></code> to reactive classes or a <code class="language-javascript highlighter-rouge"><span class="nx">ReactiveState</span></code> to original classes</li>
</ul>

<p><strong>Choose one architecture for your entire application.</strong></p>

<h2 id="expression-language">Expression Language</h2>

<p>Starting with version 1.5.0, SimpleQBN uses <a href="https://www.npmjs.com/package/quis">Quis</a> 1.3.6+ for expression evaluation with pure Quis syntax.</p>

<p>Previous versions used TinyQBN format and MongoDB query language compatibility, but as of 1.5.0, the library has been simplified to use only Quis string expressions to reduce dependencies and code size.</p>

<p>For full Quis expression syntax documentation, see the <a href="https://github.com/videlais/quis">Quis documentation</a>.</p>

<h2 id="development">Development</h2>

<h3 id="available-scripts">Available Scripts</h3>

<ul>
  <li><code class="language-javascript highlighter-rouge"><span class="nx">npm</span> <span class="nx">run</span> <span class="nx">build</span></code> - Build the main bundle</li>
  <li><code class="language-javascript highlighter-rouge"><span class="nx">npm</span> <span class="nx">run</span> <span class="nx">build</span><span class="p">:</span><span class="nx">all</span></code> - Build both original and reactive architecture bundles</li>
  <li><code class="language-javascript highlighter-rouge"><span class="nx">npm</span> <span class="nx">run</span> <span class="nx">build</span><span class="p">:</span><span class="nx">original</span></code> - Build only the original architecture bundle</li>
  <li><code class="language-javascript highlighter-rouge"><span class="nx">npm</span> <span class="nx">run</span> <span class="nx">build</span><span class="p">:</span><span class="nx">reactive</span></code> - Build only the reactive architecture bundle</li>
  <li><code class="language-javascript highlighter-rouge"><span class="nx">npm</span> <span class="nx">test</span></code> - Run all tests with coverage</li>
  <li><code class="language-javascript highlighter-rouge"><span class="nx">npm</span> <span class="nx">run</span> <span class="nx">test</span><span class="p">:</span><span class="nx">browser</span></code> - Run browser environment tests</li>
  <li><code class="language-javascript highlighter-rouge"><span class="nx">npm</span> <span class="nx">run</span> <span class="nx">test</span><span class="p">:</span><span class="nx">node</span></code> - Run Node.js tests only</li>
  <li><code class="language-javascript highlighter-rouge"><span class="nx">npm</span> <span class="nx">run</span> <span class="nx">lint</span></code> - Lint and fix source code</li>
  <li><code class="language-javascript highlighter-rouge"><span class="nx">npm</span> <span class="nx">run</span> <span class="nx">docs</span></code> - Build documentation</li>
  <li><code class="language-javascript highlighter-rouge"><span class="nx">npm</span> <span class="nx">run</span> <span class="nx">all</span></code> - Run complete build pipeline (compile, lint, test, build, docs)</li>
</ul>

<h3 id="testing">Testing</h3>

<p>The project includes comprehensive test coverage (99.54%) with both Node.js and browser environment tests:</p>

<ul>
  <li><strong>Unit Tests</strong>: Test individual classes and their functionality</li>
  <li><strong>Browser Tests</strong>: Simulate browser environment using JSDOM to test DOM interaction, localStorage, and browser-specific features</li>
  <li><strong>Reactive Tests</strong>: Test reactive state management and automatic updates</li>
</ul>

<h3 id="requirements">Requirements</h3>

<ul>
  <li>Node.js 18+ recommended</li>
  <li>npm 9+ or compatible package manager</li>
</ul>

<h3 id="project-structure">Project Structure</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">src</span><span class="o">/</span>                    <span class="err">#</span> <span class="nx">Source</span> <span class="nx">TypeScript</span> <span class="nx">files</span>
  <span class="err">├──</span> <span class="nx">Card</span><span class="p">.</span><span class="nx">ts</span>
  <span class="err">├──</span> <span class="nx">Deck</span><span class="p">.</span><span class="nx">ts</span>
  <span class="err">├──</span> <span class="nx">Expression</span><span class="p">.</span><span class="nx">ts</span>
  <span class="err">├──</span> <span class="nx">QualitySet</span><span class="p">.</span><span class="nx">ts</span>
  <span class="err">├──</span> <span class="nx">State</span><span class="p">.</span><span class="nx">ts</span>
  <span class="err">└──</span> <span class="nx">reactive</span><span class="o">/</span>         <span class="err">#</span> <span class="nx">Reactive</span> <span class="nx">architecture</span>
<span class="nx">test</span><span class="o">/</span>                   <span class="err">#</span> <span class="nx">Test</span> <span class="nx">files</span>
  <span class="err">├──</span> <span class="nx">Browser</span><span class="p">.</span><span class="nx">test</span><span class="p">.</span><span class="nx">js</span>   <span class="err">#</span> <span class="nx">Browser</span> <span class="nx">environment</span> <span class="nx">tests</span>
  <span class="err">└──</span> <span class="nx">reactive</span><span class="o">/</span>         <span class="err">#</span> <span class="nx">Reactive</span> <span class="nx">architecture</span> <span class="nx">tests</span>
<span class="nx">build</span><span class="o">/</span>                  <span class="err">#</span> <span class="nx">Compiled</span> <span class="nx">bundles</span>
<span class="nx">dist</span><span class="o">/</span>                   <span class="err">#</span> <span class="nx">TypeScript</span> <span class="nx">compilation</span> <span class="nx">output</span>
<span class="nx">docs</span><span class="o">/</span>                   <span class="err">#</span> <span class="nx">Generated</span> <span class="nx">documentation</span>
</code></pre></div></div>

<h2 id="history-and-documentation">History and Documentation</h2>

<p>Jekyll is used to create <a href="https://videlais.github.io/simple-qbn/">a history and documentation of this project</a>.</p>


</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
