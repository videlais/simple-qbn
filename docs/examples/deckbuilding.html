<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deck Building - SimpleQBN</title>
    <meta name="description" content="Because nothing about quality-based narratives is actually simple.">
    <link rel="stylesheet" href="/simple-qbn/assets/css/style.css">
</head>
<body>
    <div class="book">
        <nav class="sidebar">
  <div class="book-summary">
    <h2>SimpleQBN</h2>
    <ul class="summary">
      
      <li class="chapter ">
        
        <a href="/simple-qbn/">Introduction</a>
        
        
      </li>
      
      <li class="chapter has-children">
        
        <span class="section-title">History of Related Terms</span>
        
        
        <ul class="articles">
          
          <li>
            <a href="/simple-qbn/scenes">Scenes and Cycles (1983)</a>
          </li>
          
          <li>
            <a href="/simple-qbn/episodes">Episodes and Sequences (1989)</a>
          </li>
          
          <li>
            <a href="/simple-qbn/sculpturalmodel">Sculptural Hypertext Model (2001)</a>
          </li>
          
          <li>
            <a href="/simple-qbn/storylet">Storylet (2010)</a>
          </li>
          
          <li>
            <a href="/simple-qbn/qbn">Quality-Based Narrative (2010)</a>
          </li>
          
        </ul>
        
      </li>
      
      <li class="chapter has-children">
        
        <span class="section-title">Metaphors in SimpleQBN</span>
        
        
        <ul class="articles">
          
          <li>
            <a href="/simple-qbn/expressions">Expressions and QualitySet</a>
          </li>
          
          <li>
            <a href="/simple-qbn/cards">Decks and Cards</a>
          </li>
          
          <li>
            <a href="/simple-qbn/State">State Management</a>
          </li>
          
        </ul>
        
      </li>
      
      <li class="chapter has-children">
        
        <span class="section-title">Examples</span>
        
        
        <ul class="articles">
          
          <li>
            <a href="/simple-qbn/examples/deckbuilding">Deck Building</a>
          </li>
          
          <li>
            <a href="/simple-qbn/examples/storygates">Story Gates</a>
          </li>
          
          <li>
            <a href="/simple-qbn/examples/webbuild">Bundled for Web</a>
          </li>
          
        </ul>
        
      </li>
      
    </ul>
  </div>
</nav>

        <div class="book-body">
            <div class="body-inner">
                <div class="page-wrapper">
                    <div class="page-inner">
                        <div class="markdown-section">
<h1 id="deck-building">Deck Building</h1>

<h2 id="using-manual-state-based-api">Using manual, State-based API</h2>

<p>One of the most common first tasks with QBN projects is building a deck of cards. In SimpleQBN, this starts with the <strong>Deck</strong> class.</p>

<blockquote>
  <p><strong>Note</strong>: The examples on this page assume usage in Node.js with either importing all classes or the ones specified in the examples.</p>
</blockquote>

<pre><code class="language-JavaScript">const d = new Deck();
</code></pre>

<p>Creating a <strong>Deck</strong> also creates an internal <strong>State</strong> as its <em>state</em> property. The <strong>State</strong> API has the methods <em>set()</em>, <em>get()</em>, <em>exists()</em>,and <em>remove()</em>, which it uses to manipulate data stored as key-value pairs. Commonly, a String key is paired with a numeric value.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Create a new Deck</span>
<span class="kd">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Deck</span><span class="p">();</span>
<span class="c1">// Add a key-value pair</span>
<span class="nx">d</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</code></pre></div></div>

<p>The method <em>addCard()</em> of <strong>Deck</strong> accepts a String (<em>content</em>) and array (<em>qualities</em>) of a new <strong>Card</strong>. Internally, a <strong>Card</strong> will also create a unique <em>hash</em> as well.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Create a new Deck</span>
<span class="kd">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Deck</span><span class="p">();</span>
<span class="c1">// Add a key-value pair</span>
<span class="nx">d</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="c1">// Create a card</span>
<span class="nx">d</span><span class="p">.</span><span class="nf">addCard</span><span class="p">(</span><span class="dl">"</span><span class="s2">Content</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$test == 1</span><span class="dl">'</span><span class="p">]);</span>
</code></pre></div></div>

<p>In quality-based narratives, a <em>quality</em> defines if content can be accessed. They are written as conditional statements. In SimpleQBN 1.5.0, these are created using Quis syntax.</p>

<p>Qualities can be passed as either an array when using <em>addCard()</em> (of <strong>Deck</strong>) or with the <strong>Card</strong> method <em>addQuality()</em>. In either usage, qualities are expressed as string values using Quis syntax. These then become part of a collection called a <strong>QualitySet</strong> internally in a <strong>Card</strong>.</p>

<pre><code class="language-JavaScript">// Create a new Deck
const d = new Deck();
// Add a key-value pair
d.state.set('test', 1);
// Create a card
// content - "Content"  
// qualities - ['$test == 1']
d.addCard("Content", ['$test == 1']);
</code></pre>

<p>Cards are selected through the metaphor of <em>drawing</em>. A <strong>Card</strong> is drawn when it is available; a <strong>Card</strong> is available when all of the <strong>Expressions</strong> within its <strong>QualitySet</strong> are valid. The <strong>State</strong> of the <strong>Deck</strong> is used to determine this validity. For example, if the <strong>State</strong> contains a key-value pair of <code class="language-javascript highlighter-rouge"><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">:</span> <span class="mi">1</span></code>, then any <strong>Cards</strong> with the quality <code class="language-javascript highlighter-rouge"><span class="dl">'</span><span class="s1">$test == 1</span><span class="dl">'</span></code> are potentially valid.</p>

<p>The method <em>draw()</em> of <strong>Deck</strong> returns an array of results matching an argument up to the <em>size</em> passed to it. However, only a <strong>Card</strong> that is available can be drawn.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Create a new Deck</span>
<span class="kd">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Deck</span><span class="p">();</span>
<span class="c1">// Add a key-value pair</span>
<span class="nx">d</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="c1">// Create a card</span>
<span class="c1">// content - "Content"</span>
<span class="c1">// qualities - ['$test == 1']</span>
<span class="nx">d</span><span class="p">.</span><span class="nf">addCard</span><span class="p">(</span><span class="dl">"</span><span class="s2">Content</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$test == 1</span><span class="dl">'</span><span class="p">]);</span>
<span class="c1">// Draw the card from the deck</span>
<span class="kd">const</span> <span class="nx">hand</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nf">draw</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="c1">// Show the content of the first (and only) drawn card</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">hand</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">content</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="adding-shuffling-and-re-drawing-cards">Adding, Shuffling, and Re-Drawing Cards</h2>

<p>Once a <strong>Deck</strong> is created, any number of additional <strong>Cards</strong> can be added. Based on their qualities, a <strong>Card</strong> can initially be available or become it through altering the <strong>State</strong> of the <strong>Deck</strong>. Alternatively, once a <strong>Card</strong> is drawn from a <strong>Deck</strong>, it can be updated in the <strong>Deck</strong> using the method <em>updateCard()</em> (passing the <strong>Card</strong> to the method). Additional qualities can be added to a <strong>Card</strong> and then updated in the deck in this way.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Create a new Deck</span>
<span class="kd">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Deck</span><span class="p">();</span>
<span class="c1">// Add a key-value pair</span>
<span class="nx">d</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="c1">// Create a card</span>
<span class="nx">d</span><span class="p">.</span><span class="nf">addCard</span><span class="p">(</span><span class="dl">"</span><span class="s2">Content</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$test == 1</span><span class="dl">'</span><span class="p">]);</span>
<span class="c1">// Create another</span>
<span class="nx">d</span><span class="p">.</span><span class="nf">addCard</span><span class="p">(</span><span class="dl">"</span><span class="s2">More Content</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$test == 1</span><span class="dl">'</span><span class="p">]);</span>
<span class="c1">// Create a third</span>
<span class="nx">d</span><span class="p">.</span><span class="nf">addCard</span><span class="p">(</span><span class="dl">"</span><span class="s2">Even More Content</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$test == 1</span><span class="dl">'</span><span class="p">]);</span>
</code></pre></div></div>

<p>The method <em>shuffle()</em> randomly distributes existing cards within the <strong>Deck</strong>. Because all <strong>Cards</strong> are added in sequence, this method can be used to re-sort the <strong>Cards</strong> in the <strong>Deck</strong>.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Create a new Deck</span>
<span class="kd">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Deck</span><span class="p">();</span>
<span class="c1">// Add a key-value pair</span>
<span class="nx">d</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="c1">// Create a card</span>
<span class="nx">d</span><span class="p">.</span><span class="nf">addCard</span><span class="p">(</span><span class="dl">"</span><span class="s2">Content</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$test == 1</span><span class="dl">'</span><span class="p">]);</span>
<span class="c1">// Create another</span>
<span class="nx">d</span><span class="p">.</span><span class="nf">addCard</span><span class="p">(</span><span class="dl">"</span><span class="s2">More Content</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$test == 1</span><span class="dl">'</span><span class="p">]);</span>
<span class="c1">// Create a third</span>
<span class="nx">d</span><span class="p">.</span><span class="nf">addCard</span><span class="p">(</span><span class="dl">"</span><span class="s2">Even More Content</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$test == 1</span><span class="dl">'</span><span class="p">]);</span>
<span class="c1">// Shuffle the cards</span>
<span class="nx">d</span><span class="p">.</span><span class="nf">shuffle</span><span class="p">();</span>
</code></pre></div></div>

<p>The method <em>draw()</em> creates a new array. It does not alter the original <strong>Deck</strong> and its <strong>Cards</strong>. This means <strong>Cards</strong> can be drawn, manipulated, and then re-drawn again (assuming their qualities allow it).</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Create a new Deck</span>
<span class="kd">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Deck</span><span class="p">();</span>
<span class="c1">// Add a key-value pair</span>
<span class="nx">d</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="c1">// Create a card</span>
<span class="nx">d</span><span class="p">.</span><span class="nf">addCard</span><span class="p">(</span><span class="dl">"</span><span class="s2">Content</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$test == 1</span><span class="dl">'</span><span class="p">]);</span>
<span class="c1">// Create another</span>
<span class="nx">d</span><span class="p">.</span><span class="nf">addCard</span><span class="p">(</span><span class="dl">"</span><span class="s2">More Content</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$test == 1</span><span class="dl">'</span><span class="p">]);</span>
<span class="c1">// Create a third</span>
<span class="nx">d</span><span class="p">.</span><span class="nf">addCard</span><span class="p">(</span><span class="dl">"</span><span class="s2">Even More Content</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$test == 1</span><span class="dl">'</span><span class="p">]);</span>
<span class="c1">// Shuffle the cards</span>
<span class="nx">d</span><span class="p">.</span><span class="nf">shuffle</span><span class="p">();</span>
<span class="c1">// Draw all cards</span>
<span class="kd">const</span> <span class="nx">hand</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nf">draw</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="c1">// Get the first card in the drawn array</span>
<span class="kd">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">hand</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="c1">// Add a new quality</span>
<span class="nx">c</span><span class="p">.</span><span class="nf">addQuality</span><span class="p">(</span><span class="dl">'</span><span class="s1">$example == 1</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// Update the deck</span>
<span class="nx">d</span><span class="p">.</span><span class="nf">updateCard</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span>
<span class="c1">// Draw another array</span>
<span class="c1">// (However, only two cards will be available now.)</span>
<span class="kd">const</span> <span class="nx">anotherHand</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nf">draw</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</code></pre></div></div>

<p>In the above code, the method <em>addQuality()</em> is used to add another quality to a card. As only the <strong>Card</strong> in the drawn collection would be updated, the <strong>Deck</strong> method <em>updateCard()</em> is also used. Through passing the <strong>Card</strong> to this method, it will update the internal <strong>Card</strong> where the unique <em>hash</em> of each match.</p>

<h2 id="using-automatic-reactive-state-based-api">Using automatic, Reactive State-based API</h2>

<p>The reactive architecture provides the same deck building functionality with automatic updates and event-driven state management. Instead of manual state passing, reactive components automatically synchronize when state changes occur.</p>

<blockquote>
  <p><strong>Note</strong>: The examples below use the new nested import structure available in SimpleQBN 1.5.0+. These reactive classes are incompatible with the original State-based classes shown above.</p>
</blockquote>

<pre><code class="language-JavaScript">import { Deck } from 'simple-qbn/reactive';
// Or: import ReactiveDeck from 'simple-qbn/reactive/Deck';

const d = new Deck();
</code></pre>

<p>Creating a <strong>ReactiveDeck</strong> requires binding it to a <strong>ReactiveState</strong>. Unlike the original architecture, the reactive state is passed explicitly during construction or binding, enabling automatic updates across all connected components.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">State</span><span class="p">,</span> <span class="nx">Deck</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">simple-qbn/reactive</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Create a reactive state</span>
<span class="kd">const</span> <span class="nx">gameState</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">State</span><span class="p">();</span>
<span class="c1">// Add a key-value pair</span>
<span class="nx">gameState</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="c1">// Create a deck bound to the state</span>
<span class="kd">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Deck</span><span class="p">([],</span> <span class="nx">gameState</span><span class="p">);</span>
</code></pre></div></div>

<p>The method <em>addCard()</em> of <strong>ReactiveDeck</strong> accepts a <strong>ReactiveCard</strong> instance. Unlike the original API, you create <strong>ReactiveCard</strong> objects explicitly and then add them to the deck.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">State</span><span class="p">,</span> <span class="nx">Card</span><span class="p">,</span> <span class="nx">Deck</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">simple-qbn/reactive</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Create a reactive state</span>
<span class="kd">const</span> <span class="nx">gameState</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">State</span><span class="p">();</span>
<span class="c1">// Add a key-value pair</span>
<span class="nx">gameState</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="c1">// Create a reactive card</span>
<span class="kd">const</span> <span class="nx">card</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Card</span><span class="p">(</span><span class="dl">"</span><span class="s2">Content</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$test == 1</span><span class="dl">'</span><span class="p">]);</span>
<span class="c1">// Create a deck and add the card</span>
<span class="kd">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Deck</span><span class="p">([</span><span class="nx">card</span><span class="p">],</span> <span class="nx">gameState</span><span class="p">);</span>
</code></pre></div></div>

<p>In the reactive architecture, qualities work the same way as conditional statements using Quis syntax. However, reactive cards automatically recalculate their availability when the bound state changes, eliminating the need for manual availability checking.</p>

<p>Reactive cards maintain the same <strong>QualitySet</strong> concept internally, but with automatic cache invalidation when state changes occur.</p>

<pre><code class="language-JavaScript">import { State, Card, Deck } from 'simple-qbn/reactive';

// Create a reactive state
const gameState = new State();
// Add a key-value pair
gameState.set('test', 1);
// Create a reactive card with qualities
const card = new Card("Content", ['$test == 1']);
// Create a deck bound to state
const d = new Deck([card], gameState);
</code></pre>

<p>Cards are accessed through the <em>availableCards</em> property, which automatically updates when state changes. A <strong>ReactiveCard</strong> is available when all <strong>ReactiveExpressions</strong> within its <strong>ReactiveQualitySet</strong> are valid against the current <strong>ReactiveState</strong>.</p>

<p>The <em>availableCards</em> getter returns an array of currently available cards, and this list automatically updates when the state changes through the reactive subscription system.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">State</span><span class="p">,</span> <span class="nx">Card</span><span class="p">,</span> <span class="nx">Deck</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">simple-qbn/reactive</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Create a reactive state</span>
<span class="kd">const</span> <span class="nx">gameState</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">State</span><span class="p">();</span>
<span class="c1">// Add a key-value pair</span>
<span class="nx">gameState</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="c1">// Create a reactive card</span>
<span class="kd">const</span> <span class="nx">card</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Card</span><span class="p">(</span><span class="dl">"</span><span class="s2">Content</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$test == 1</span><span class="dl">'</span><span class="p">]);</span>
<span class="c1">// Create a deck bound to state</span>
<span class="kd">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Deck</span><span class="p">([</span><span class="nx">card</span><span class="p">],</span> <span class="nx">gameState</span><span class="p">);</span>

<span class="c1">// Subscribe to automatic updates</span>
<span class="nx">d</span><span class="p">.</span><span class="nf">subscribe</span><span class="p">((</span><span class="nx">availableCards</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">availableCards</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="s2"> cards available`</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Access available cards (triggers subscription)</span>
<span class="kd">const</span> <span class="nx">available</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">availableCards</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">available</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">content</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="adding-shuffling-and-drawing-reactive-cards">Adding, Shuffling, and Drawing Reactive Cards</h2>

<p>Reactive decks support dynamic card management with automatic availability updates. When cards are added or removed, all subscribed listeners are notified automatically.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">State</span><span class="p">,</span> <span class="nx">Card</span><span class="p">,</span> <span class="nx">Deck</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">simple-qbn/reactive</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Create a reactive state and deck</span>
<span class="kd">const</span> <span class="nx">gameState</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">State</span><span class="p">();</span>
<span class="nx">gameState</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Deck</span><span class="p">([],</span> <span class="nx">gameState</span><span class="p">);</span>

<span class="c1">// Create and add multiple cards</span>
<span class="kd">const</span> <span class="nx">card1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Card</span><span class="p">(</span><span class="dl">"</span><span class="s2">Content</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$test == 1</span><span class="dl">'</span><span class="p">]);</span>
<span class="kd">const</span> <span class="nx">card2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Card</span><span class="p">(</span><span class="dl">"</span><span class="s2">More Content</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$test == 1</span><span class="dl">'</span><span class="p">]);</span>  
<span class="kd">const</span> <span class="nx">card3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Card</span><span class="p">(</span><span class="dl">"</span><span class="s2">Even More Content</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$test == 1</span><span class="dl">'</span><span class="p">]);</span>

<span class="nx">d</span><span class="p">.</span><span class="nf">addCard</span><span class="p">(</span><span class="nx">card1</span><span class="p">);</span>
<span class="nx">d</span><span class="p">.</span><span class="nf">addCard</span><span class="p">(</span><span class="nx">card2</span><span class="p">);</span>
<span class="nx">d</span><span class="p">.</span><span class="nf">addCard</span><span class="p">(</span><span class="nx">card3</span><span class="p">);</span>
</code></pre></div></div>

<p>The method <em>shuffle()</em> works the same way as the original architecture, randomly redistributing cards within the <strong>ReactiveDeck</strong>. All subscribers are notified when the shuffle occurs.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">State</span><span class="p">,</span> <span class="nx">Card</span><span class="p">,</span> <span class="nx">Deck</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">simple-qbn/reactive</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Create a reactive state and deck</span>
<span class="kd">const</span> <span class="nx">gameState</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">State</span><span class="p">();</span>
<span class="nx">gameState</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Deck</span><span class="p">([],</span> <span class="nx">gameState</span><span class="p">);</span>

<span class="c1">// Add cards</span>
<span class="kd">const</span> <span class="nx">card1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Card</span><span class="p">(</span><span class="dl">"</span><span class="s2">Content</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$test == 1</span><span class="dl">'</span><span class="p">]);</span>
<span class="kd">const</span> <span class="nx">card2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Card</span><span class="p">(</span><span class="dl">"</span><span class="s2">More Content</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$test == 1</span><span class="dl">'</span><span class="p">]);</span>
<span class="kd">const</span> <span class="nx">card3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Card</span><span class="p">(</span><span class="dl">"</span><span class="s2">Even More Content</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$test == 1</span><span class="dl">'</span><span class="p">]);</span>

<span class="nx">d</span><span class="p">.</span><span class="nf">addCard</span><span class="p">(</span><span class="nx">card1</span><span class="p">);</span>
<span class="nx">d</span><span class="p">.</span><span class="nf">addCard</span><span class="p">(</span><span class="nx">card2</span><span class="p">);</span>
<span class="nx">d</span><span class="p">.</span><span class="nf">addCard</span><span class="p">(</span><span class="nx">card3</span><span class="p">);</span>

<span class="c1">// Shuffle the cards (notifies subscribers)</span>
<span class="nx">d</span><span class="p">.</span><span class="nf">shuffle</span><span class="p">();</span>
</code></pre></div></div>

<p>The <em>draw()</em> method returns a random available card (or null if none available), while <em>availableCards</em> provides the full list. Unlike the original architecture, reactive cards automatically update their availability as state changes, and all deck subscribers are notified in real-time.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">State</span><span class="p">,</span> <span class="nx">Card</span><span class="p">,</span> <span class="nx">Deck</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">simple-qbn/reactive</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Create a reactive state and deck</span>
<span class="kd">const</span> <span class="nx">gameState</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">State</span><span class="p">();</span>
<span class="nx">gameState</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Deck</span><span class="p">([],</span> <span class="nx">gameState</span><span class="p">);</span>

<span class="c1">// Add cards</span>
<span class="kd">const</span> <span class="nx">card1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Card</span><span class="p">(</span><span class="dl">"</span><span class="s2">Content</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$test == 1</span><span class="dl">'</span><span class="p">]);</span>
<span class="kd">const</span> <span class="nx">card2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Card</span><span class="p">(</span><span class="dl">"</span><span class="s2">More Content</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$test == 1</span><span class="dl">'</span><span class="p">]);</span>
<span class="kd">const</span> <span class="nx">card3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Card</span><span class="p">(</span><span class="dl">"</span><span class="s2">Even More Content</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">$test == 1</span><span class="dl">'</span><span class="p">]);</span>

<span class="nx">d</span><span class="p">.</span><span class="nf">addCard</span><span class="p">(</span><span class="nx">card1</span><span class="p">);</span>
<span class="nx">d</span><span class="p">.</span><span class="nf">addCard</span><span class="p">(</span><span class="nx">card2</span><span class="p">);</span>
<span class="nx">d</span><span class="p">.</span><span class="nf">addCard</span><span class="p">(</span><span class="nx">card3</span><span class="p">);</span>

<span class="c1">// Subscribe to changes</span>
<span class="nx">d</span><span class="p">.</span><span class="nf">subscribe</span><span class="p">((</span><span class="nx">availableCards</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">availableCards</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="s2"> cards available`</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Shuffle the cards</span>
<span class="nx">d</span><span class="p">.</span><span class="nf">shuffle</span><span class="p">();</span>

<span class="c1">// Draw a random available card</span>
<span class="kd">const</span> <span class="nx">drawnCard</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nf">draw</span><span class="p">();</span>
<span class="k">if </span><span class="p">(</span><span class="nx">drawnCard</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Drew: </span><span class="p">${</span><span class="nx">drawnCard</span><span class="p">.</span><span class="nx">content</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Add a new quality to the first card</span>
<span class="nx">card1</span><span class="p">.</span><span class="nf">addQuality</span><span class="p">(</span><span class="dl">'</span><span class="s1">$example == 1</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// The deck automatically updates - no updateCard() needed!</span>

<span class="c1">// State change automatically updates all cards</span>
<span class="nx">gameState</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">example</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="c1">// All subscribers notified automatically</span>

<span class="c1">// Get currently available cards</span>
<span class="kd">const</span> <span class="nx">available</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">availableCards</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Now </span><span class="p">${</span><span class="nx">available</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="s2"> cards available`</span><span class="p">);</span>
</code></pre></div></div>

<p>In the reactive architecture, the method <em>addQuality()</em> automatically triggers updates to the card’s availability and notifies all deck subscribers. There’s no need for an <em>updateCard()</em> method since the reactive system handles synchronization automatically through the subscription system.</p>

</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
