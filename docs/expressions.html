<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expressions and QualitySet - SimpleQBN</title>
    <meta name="description" content="Because nothing about quality-based narratives is actually simple.">
    <link rel="stylesheet" href="/simple-qbn/assets/css/style.css">
</head>
<body>
    <div class="book">
        <nav class="sidebar">
  <div class="book-summary">
    <h2>SimpleQBN</h2>
    <ul class="summary">
      
      <li class="chapter ">
        
        <a href="/simple-qbn/">Introduction</a>
        
        
      </li>
      
      <li class="chapter has-children">
        
        <span class="section-title">History of Related Terms</span>
        
        
        <ul class="articles">
          
          <li>
            <a href="/simple-qbn/scenes">Scenes and Cycles (1983)</a>
          </li>
          
          <li>
            <a href="/simple-qbn/episodes">Episodes and Sequences (1989)</a>
          </li>
          
          <li>
            <a href="/simple-qbn/sculpturalmodel">Sculptural Hypertext Model (2001)</a>
          </li>
          
          <li>
            <a href="/simple-qbn/storylet">Storylet (2010)</a>
          </li>
          
          <li>
            <a href="/simple-qbn/qbn">Quality-Based Narrative (2010)</a>
          </li>
          
        </ul>
        
      </li>
      
      <li class="chapter has-children">
        
        <span class="section-title">Metaphors in SimpleQBN</span>
        
        
        <ul class="articles">
          
          <li>
            <a href="/simple-qbn/expressions">Expressions and QualitySet</a>
          </li>
          
          <li>
            <a href="/simple-qbn/cards">Decks and Cards</a>
          </li>
          
          <li>
            <a href="/simple-qbn/State">State Management</a>
          </li>
          
        </ul>
        
      </li>
      
      <li class="chapter has-children">
        
        <span class="section-title">Examples</span>
        
        
        <ul class="articles">
          
          <li>
            <a href="/simple-qbn/examples/deckbuilding">Deck Building</a>
          </li>
          
          <li>
            <a href="/simple-qbn/examples/storygates">Story Gates</a>
          </li>
          
          <li>
            <a href="/simple-qbn/examples/webbuild">Bundled for Web</a>
          </li>
          
        </ul>
        
      </li>
      
    </ul>
  </div>
</nav>

        <div class="book-body">
            <div class="body-inner">
                <div class="page-wrapper">
                    <div class="page-inner">
                        <div class="markdown-section">
<h1 id="expressions-and-qualityset">Expressions and QualitySet</h1>

<h2 id="qualities-as-expressions">Qualities as Expressions</h2>

<p>While both the <a href="./sculpturalmodel.md">sculptural</a> and <a href="./qbn.md">QBN</a> models define their own terms of how sections of a story might become available (constraints and qualities, respectively), neither explain how to <em>express</em> these.</p>

<h3 id="grams-format">Grams Format</h3>

<p>Working with the story format SugarCube in Twine 2, the library TinyQBN by Grams (2019) solves this issue through using the tags of passages. Based on the requirements of not containing spaces, Grams (2019) introduced a shorthand for writing qualities using hyphens between the operators (what is being compared) and the operation (how to compare values): <code class="language-javascript highlighter-rouge"><span class="nx">operator</span><span class="o">-</span><span class="nx">operation</span><span class="o">-</span><span class="nx">operator</span></code>.</p>

<p>This format created an easy way to include prerequisites in Twine using tags in passages, but comes with some issues:</p>

<ul>
  <li><em>Operators have to be converted into and out of String values</em>. Tags in Twine 2 are stored as the values of attributes within <a href="https://github.com/iftechfoundation/twine-specs/blob/master/twine-2-htmloutput-spec.md">its HTML</a>. These tags are assumed to be String values. Any use of other primative data types in JavaScript such as Numbers and Booleans must be converted out of their String representation.</li>
  <li><em>Only one comparison can be used at a time</em>. Complex comparisons are not possible in the format because of its internal parsing. Additional tags can be added, but each is only one comparison between a single variable and value.</li>
</ul>

<h3 id="working-with-quis-expression-language">Working with Quis Expression Language</h3>

<p>Starting with version 1.4, SimpleQBN began to use the MongoDB Query Language for expressions. As of version 1.4.2, SimpleQBN started using the <a href="https://www.npmjs.com/package/quis">Quis</a> NPM package. <strong>As of version 1.5.0, SimpleQBN exclusively uses Quis syntax for all expressions</strong>, removing MongoDB query language support to reduce dependencies and code size.</p>

<p>Quis expressions support:</p>

<ul>
  <li>Comparison operators: <code class="language-javascript highlighter-rouge"><span class="o">==</span></code>, <code class="language-javascript highlighter-rouge"><span class="o">!=</span></code>, <code class="language-javascript highlighter-rouge"><span class="o">&gt;</span></code>, <code class="language-javascript highlighter-rouge"><span class="o">&gt;=</span></code>, <code class="language-javascript highlighter-rouge"><span class="o">&lt;</span></code>, <code class="language-javascript highlighter-rouge"><span class="o">&lt;=</span></code></li>
  <li>Boolean operators: <code class="language-javascript highlighter-rouge"><span class="o">&amp;&amp;</span></code> (AND), <code class="language-javascript highlighter-rouge"><span class="o">||</span></code> (OR), <code class="language-javascript highlighter-rouge"><span class="o">!</span></code> (NOT)</li>
  <li>Parentheses for grouping: <code class="language-javascript highlighter-rouge"><span class="p">(</span><span class="nx">$health</span> <span class="o">&gt;</span> <span class="mi">50</span> <span class="o">&amp;&amp;</span> <span class="nx">$level</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">||</span> <span class="nx">$emergency</span> <span class="o">==</span> <span class="kc">true</span></code></li>
  <li>Variable access: <code class="language-javascript highlighter-rouge"><span class="nx">$variableName</span></code> for simple values</li>
</ul>

<p>Examples:</p>

<ul>
  <li>Simple: <code class="language-javascript highlighter-rouge"><span class="nx">$health</span> <span class="o">&gt;</span> <span class="mi">50</span></code></li>
  <li>Complex: <code class="language-javascript highlighter-rouge"><span class="nx">$user_role</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">admin</span><span class="dl">"</span> <span class="o">&amp;&amp;</span> <span class="nx">$user_active</span> <span class="o">==</span> <span class="kc">true</span></code></li>
  <li>Grouped: <code class="language-javascript highlighter-rouge"><span class="p">(</span><span class="nx">$score</span> <span class="o">&gt;=</span> <span class="mi">80</span> <span class="o">||</span> <span class="nx">$bonus_points</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">$attempts</span> <span class="o">&lt;=</span> <span class="mi">3</span></code></li>
</ul>

<p>For full Quis syntax documentation, see the <a href="https://github.com/videlais/quis">Quis documentation</a>.</p>

<h3 id="historical-previous-use-of-mingo-mongodb-query-support">Historical: Previous use of Mingo (MongoDB Query Support)</h3>

<blockquote>
  <p><strong>Note</strong>: MongoDB query language support was removed in version 1.5.0. This section is preserved for historical reference only. Current versions use only Quis syntax.</p>
</blockquote>

<p>In versions 1.4.0 through 1.4.x, SimpleQBN supported MongoDB query language through the Mingo library.</p>

<p>For example, an <strong>Expression</strong> to test if the <strong>State</strong> value <em>score</em> was greater than 15 would be written as the following:</p>

<pre><code class="language-JavaScript">{score: {$gt: 15}}
</code></pre>

<p>The use of the MongoDB query language also introduces much more complex queries as well. To test if the <strong>State</strong> value <em>score</em> was greater than 15, <strong>State</strong> value <em>act1</em> was <code class="language-javascript highlighter-rouge"><span class="kc">true</span></code>, and <strong>State</strong> value <em>reputation</em> was less than <code class="language-javascript highlighter-rouge"><span class="mf">3.5</span></code>, it would be the following:</p>

<pre><code class="language-JavaScript">{score: {$gt: 15}, act1: true, reputation: {$lt: 3.5}}
</code></pre>

<h2 id="references">References</h2>

<p>Grams, J. (2019). Tiny-QBN. GitHub. Retrieved from <code class="language-javascript highlighter-rouge"><span class="nx">https</span><span class="p">:</span><span class="c1">//github.com/JoshuaGrams/tiny-qbn</span></code></p>

</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
