!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ReactiveSimpleQBN=e():t.ReactiveSimpleQBN=e()}(this,()=>(()=>{"use strict";var t={698:t=>{class e extends SyntaxError{constructor(t,e,s,i){super(t),this.expected=e,this.found=s,this.location=i,this.name="SyntaxError"}format(t){let e="Error: "+this.message;if(this.location){let s=null;const i=t.find(t=>t.source===this.location.source);i&&(s=i.text.split(/\r\n|\n|\r/g));const r=this.location.start,n=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(r):r,a=this.location.source+":"+n.line+":"+n.column;if(s){const t=this.location.end,i="".padEnd(n.line.toString().length," "),o=s[r.line-1],c=(r.line===t.line?t.column:o.length+1)-r.column||1;e+="\n --\x3e "+a+"\n"+i+" |\n"+n.line+" | "+o+"\n"+i+" | "+"".padEnd(r.column-1," ")+"".padEnd(c,"^")}else e+="\n at "+a}return e}static buildMessage(t,e){function s(t){return t.codePointAt(0).toString(16).toUpperCase()}const i=Object.prototype.hasOwnProperty.call(RegExp.prototype,"unicode")?new RegExp("[\\p{C}\\p{Mn}\\p{Mc}]","gu"):null;function r(t){return i?t.replace(i,t=>"\\u{"+s(t)+"}"):t}function n(t){return r(t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,t=>"\\x0"+s(t)).replace(/[\x10-\x1F\x7F-\x9F]/g,t=>"\\x"+s(t)))}function a(t){return r(t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,t=>"\\x0"+s(t)).replace(/[\x10-\x1F\x7F-\x9F]/g,t=>"\\x"+s(t)))}const o={literal:t=>'"'+n(t.text)+'"',class(t){const e=t.parts.map(t=>Array.isArray(t)?a(t[0])+"-"+a(t[1]):a(t));return"["+(t.inverted?"^":"")+e.join("")+"]"+(t.unicode?"u":"")},any:()=>"any character",end:()=>"end of input",other:t=>t.description};function c(t){return o[t.type](t)}return"Expected "+function(t){const e=t.map(c);if(e.sort(),e.length>0){let t=1;for(let s=1;s<e.length;s++)e[s-1]!==e[s]&&(e[t]=e[s],t++);e.length=t}switch(e.length){case 1:return e[0];case 2:return e[0]+" or "+e[1];default:return e.slice(0,-1).join(", ")+", or "+e[e.length-1]}}(t)+" but "+function(t){return t?'"'+n(t)+'"':"end of input"}(e)+" found."}}t.exports={StartRules:["Start"],SyntaxError:e,parse:function(t,s){const i={},r=(s=void 0!==s?s:{}).grammarSource,n={Start:me};let a=me;const o="null",c="(",h=")",l="true",u="false",d="!",f="&&",p="AND",b="and",g="||",y="OR",v="or",_="==",w=">",m=">=",E="<",x="<=",C="!=",S="is not",R="is",A="gt",L="lt",q="lte",k="gte",j=".",M="-",D="$",O="[",P="]",T='"',N="'",Q=/^[ \t\n\r]/,U=/^[0-9]/,F=/^[a-zA-Z_]/,$=/^[\-_]/,z=/^[ \-_]/,I=ye("Boolean Value"),V=ye("Null Value"),B=be("null",!1),G=ge([" ","\t","\n","\r"],!1,!1,!1),K=ye("Left Parentheses"),W=be("(",!1),Z=ye("Right Parentheses"),H=be(")",!1),J=ye("True"),X=be("true",!1),Y=ye("False"),tt=be("false",!1),et=ye("Negation"),st=be("!",!1),it=ye("And Operator"),rt=be("&&",!1),nt=be("AND",!1),at=be("and",!1),ot=ye("Or Operator"),ct=be("||",!1),ht=be("OR",!1),lt=be("or",!1),ut=ye("Equality"),dt=be("==",!1),ft=ye("Greater-than"),pt=be(">",!1),bt=ye("Greater-than or equal"),gt=be(">=",!1),yt=ye("Less-than"),vt=be("<",!1),_t=ye("Less-than or equal"),wt=be("<=",!1),mt=ye("Inequality"),Et=be("!=",!1),xt=ye("Inequality Shorthand"),Ct=be("is not",!1),St=ye("Equality Shorthand"),Rt=be("is",!1),At=ye("Greater-than Shorthand"),Lt=be("gt",!1),qt=ye("Less-than Shorthand"),kt=be("lt",!1),jt=ye("Less-than or equal Shorthand"),Mt=be("lte",!1),Dt=ye("Greater-than or equal Shorthand"),Ot=be("gte",!1),Pt=ye("Digit"),Tt=ge([["0","9"]],!1,!1,!1),Nt=ye("Decimal Point"),Qt=be(".",!1),Ut=ye("Number"),Ft=ye("Integer"),$t=ye("Decimal"),zt=ye("Negative"),It=be("-",!1),Vt=ye("Letter"),Bt=ge([["a","z"],["A","Z"],"_"],!1,!1,!1),Gt=ye("Variable"),Kt=be("$",!1),Wt=ye("Variable With Whitespace"),Zt=ye("Variable Retrieval"),Ht=ye("Key-Value Retrieval"),Jt=ye("Dot Notation"),Xt=ye("Bracket Notation"),Yt=be("[",!1),te=be("]",!1),ee=ye("Dot Key"),se=ye("Bracket Key"),ie=ge(["-","_"],!1,!1,!1),re=be('"',!1),ne=ge([" ","-","_"],!1,!1,!1),ae=be("'",!1),oe=ye("String Literal");let ce=0|s.peg$currPos,he=ce;const le=[{line:1,column:1}];let ue,de=ce,fe=s.peg$maxFailExpected||[],pe=0|s.peg$silentFails;if(s.startRule){if(!(s.startRule in n))throw new Error("Can't start parsing from rule \""+s.startRule+'".');a=n[s.startRule]}function be(t,e){return{type:"literal",text:t,ignoreCase:e}}function ge(t,e,s,i){return{type:"class",parts:t,inverted:e,ignoreCase:s,unicode:i}}function ye(t){return{type:"other",description:t}}function ve(e){let s,i=le[e];if(i)return i;if(e>=le.length)s=le.length-1;else for(s=e;!le[--s];);for(i=le[s],i={line:i.line,column:i.column};s<e;)10===t.charCodeAt(s)?(i.line++,i.column=1):i.column++,s++;return le[e]=i,i}function _e(t,e,s){const i=ve(t),n=ve(e),a={source:r,start:{offset:t,line:i.line,column:i.column},end:{offset:e,line:n.line,column:n.column}};return s&&r&&"function"==typeof r.offset&&(a.start=r.offset(a.start),a.end=r.offset(a.end)),a}function we(t){ce<de||(ce>de&&(de=ce,fe=[]),fe.push(t))}function me(){let t;return t=Ee(),t}function Ee(){let t,e,s,r,n,a;if(t=ce,e=xe(),e!==i){for(s=[],r=ce,n=Le(),n!==i?(a=xe(),a!==i?(n=[n,a],r=n):(ce=r,r=i)):(ce=r,r=i);r!==i;)s.push(r),r=ce,n=Le(),n!==i?(a=xe(),a!==i?(n=[n,a],r=n):(ce=r,r=i)):(ce=r,r=i);he=t,o=e,t=s.reduce((t,e)=>t||e[1],o)}else ce=t,t=i;var o;return t}function xe(){let t,e,s,r,n,a;if(t=ce,e=Ce(),e!==i){for(s=[],r=ce,n=Ae(),n!==i?(a=Ce(),a!==i?(n=[n,a],r=n):(ce=r,r=i)):(ce=r,r=i);r!==i;)s.push(r),r=ce,n=Ae(),n!==i?(a=Ce(),a!==i?(n=[n,a],r=n):(ce=r,r=i)):(ce=r,r=i);he=t,o=e,t=s.reduce((t,e)=>!!t&&!!e[1],o)}else ce=t,t=i;var o;return t}function Ce(){let e,s,r,n;return e=ce,s=Se(),s!==i?(r=function(){let e,s,r;return pe++,e=ce,t.substr(ce,6)===S?(s=S,ce+=6):(s=i,0===pe&&we(Ct)),s!==i?(r=Re(),he=e,e="is not"):(ce=e,e=i),pe--,e===i&&(s=i,0===pe&&we(xt)),e}(),r===i&&(r=function(){let e,s,r;return pe++,e=ce,t.substr(ce,2)===m?(s=m,ce+=2):(s=i,0===pe&&we(gt)),s!==i?(r=Re(),he=e,e=">="):(ce=e,e=i),pe--,e===i&&(s=i,0===pe&&we(bt)),e}(),r===i&&(r=function(){let e,s,r;return pe++,e=ce,t.substr(ce,3)===k?(s=k,ce+=3):(s=i,0===pe&&we(Ot)),s!==i?(r=Re(),he=e,e="gte"):(ce=e,e=i),pe--,e===i&&(s=i,0===pe&&we(Dt)),e}(),r===i&&(r=function(){let e,s,r;return pe++,e=ce,t.substr(ce,2)===x?(s=x,ce+=2):(s=i,0===pe&&we(wt)),s!==i?(r=Re(),he=e,e="<="):(ce=e,e=i),pe--,e===i&&(s=i,0===pe&&we(_t)),e}(),r===i&&(r=function(){let e,s,r;return pe++,e=ce,t.substr(ce,3)===q?(s=q,ce+=3):(s=i,0===pe&&we(Mt)),s!==i?(r=Re(),he=e,e="lte"):(ce=e,e=i),pe--,e===i&&(s=i,0===pe&&we(jt)),e}(),r===i&&(r=function(){let e,s,r;return pe++,e=ce,60===t.charCodeAt(ce)?(s=E,ce++):(s=i,0===pe&&we(vt)),s!==i?(r=Re(),he=e,e="<"):(ce=e,e=i),pe--,e===i&&(s=i,0===pe&&we(yt)),e}(),r===i&&(r=function(){let e,s,r;return pe++,e=ce,t.substr(ce,2)===L?(s=L,ce+=2):(s=i,0===pe&&we(kt)),s!==i?(r=Re(),he=e,e="lt"):(ce=e,e=i),pe--,e===i&&(s=i,0===pe&&we(qt)),e}(),r===i&&(r=function(){let e,s,r;return pe++,e=ce,62===t.charCodeAt(ce)?(s=w,ce++):(s=i,0===pe&&we(pt)),s!==i?(r=Re(),he=e,e=">"):(ce=e,e=i),pe--,e===i&&(s=i,0===pe&&we(ft)),e}(),r===i&&(r=function(){let e,s,r;return pe++,e=ce,t.substr(ce,2)===A?(s=A,ce+=2):(s=i,0===pe&&we(Lt)),s!==i?(r=Re(),he=e,e="gt"):(ce=e,e=i),pe--,e===i&&(s=i,0===pe&&we(At)),e}(),r===i&&(r=function(){let e,s,r;return pe++,e=ce,t.substr(ce,2)===_?(s=_,ce+=2):(s=i,0===pe&&we(dt)),s!==i?(r=Re(),he=e,e="=="):(ce=e,e=i),pe--,e===i&&(s=i,0===pe&&we(ut)),e}(),r===i&&(r=function(){let e,s,r;return pe++,e=ce,t.substr(ce,2)===R?(s=R,ce+=2):(s=i,0===pe&&we(Rt)),s!==i?(r=Re(),he=e,e="is"):(ce=e,e=i),pe--,e===i&&(s=i,0===pe&&we(St)),e}(),r===i&&(r=function(){let e,s,r;return pe++,e=ce,t.substr(ce,2)===C?(s=C,ce+=2):(s=i,0===pe&&we(Et)),s!==i?(r=Re(),he=e,e="!="):(ce=e,e=i),pe--,e===i&&(s=i,0===pe&&we(mt)),e}()))))))))))),r!==i?(n=Se(),n!==i?(he=e,e=function(t,e,s){let i;return i=Array.isArray(e)?e.join("").trim():"string"==typeof e?e.trim():String(e).trim(),">="===i||"gte"===i?t>=s:"<="===i||"lte"===i?t<=s:"<"===i||"lt"===i?t<s:">"===i||"gt"===i?t>s:"!="===i||i.includes("is not")?t!=s:("=="===i||"is"===i)&&t==s}(s,r,n)):(ce=e,e=i)):(ce=e,e=i)):(ce=e,e=i),e===i&&(e=function(){let e,s,r;return e=ce,s=function(){let e,s,r;return pe++,e=ce,33===t.charCodeAt(ce)?(s=d,ce++):(s=i,0===pe&&we(st)),s!==i?(r=Re(),s=[s,r],e=s):(ce=e,e=i),pe--,e===i&&(s=i,0===pe&&we(et)),e}(),s!==i?(r=Ce(),r!==i?(he=e,e=!r):(ce=e,e=i)):(ce=e,e=i),e}(),e===i&&(e=function(){let e,s,r,n;return e=ce,s=function(){let e,s,r;return pe++,e=ce,40===t.charCodeAt(ce)?(s=c,ce++):(s=i,0===pe&&we(W)),s!==i?(r=Re(),s=[s,r],e=s):(ce=e,e=i),pe--,e===i&&(s=i,0===pe&&we(K)),e}(),s!==i?(r=Ee(),r!==i?(n=function(){let e,s,r;return pe++,e=ce,41===t.charCodeAt(ce)?(s=h,ce++):(s=i,0===pe&&we(H)),s!==i?(r=Re(),s=[s,r],e=s):(ce=e,e=i),pe--,e===i&&(s=i,0===pe&&we(Z)),e}(),n!==i?(he=e,e=r):(ce=e,e=i)):(ce=e,e=i)):(ce=e,e=i),e}(),e===i&&(e=Se()))),e}function Se(){let e,r;return e=ce,r=function(){let e,s;return pe++,e=function(){let e,s,r,n,a,o,c;if(pe++,e=ce,s=ce,r=ke(),r===i&&(r=null),n=[],a=qe(),a!==i)for(;a!==i;)n.push(a),a=qe();else n=i;if(n!==i)if(a=function(){let e,s;return pe++,46===t.charCodeAt(ce)?(e=j,ce++):(e=i,0===pe&&we(Qt)),pe--,e===i&&(s=i,0===pe&&we(Nt)),e}(),a!==i){if(o=[],c=qe(),c!==i)for(;c!==i;)o.push(c),c=qe();else o=i;o!==i?(r=[r,n,a,o],s=r):(ce=s,s=i)}else ce=s,s=i;else ce=s,s=i;return s!==i?(r=Re(),he=e,e=Number(s.flat().join(""))):(ce=e,e=i),pe--,e===i&&(s=i,0===pe&&we($t)),e}(),e===i&&(e=function(){let t,e,s,r,n;if(pe++,t=ce,e=ce,s=ke(),s===i&&(s=null),r=[],n=qe(),n!==i)for(;n!==i;)r.push(n),n=qe();else r=i;return r!==i?(s=[s,r],e=s):(ce=e,e=i),e!==i?(s=Re(),he=t,t=Number(e.flat().join(""))):(ce=t,t=i),pe--,t===i&&(e=i,0===pe&&we(Ft)),t}()),pe--,e===i&&(s=i,0===pe&&we(Ut)),e}(),r!==i&&(he=e),e=r,e===i&&(e=ce,r=function(){let e,s,r,n,a;if(pe++,e=ce,34===t.charCodeAt(ce)?(s=T,ce++):(s=i,0===pe&&we(re)),s!==i){for(r=[],n=je(),n===i&&(n=qe(),n===i&&(n=t.charAt(ce),z.test(n)?ce++:(n=i,0===pe&&we(ne))));n!==i;)r.push(n),n=je(),n===i&&(n=qe(),n===i&&(n=t.charAt(ce),z.test(n)?ce++:(n=i,0===pe&&we(ne))));34===t.charCodeAt(ce)?(n=T,ce++):(n=i,0===pe&&we(re)),n!==i?(a=Re(),he=e,e=r.join("")):(ce=e,e=i)}else ce=e,e=i;if(e===i)if(e=ce,39===t.charCodeAt(ce)?(s=N,ce++):(s=i,0===pe&&we(ae)),s!==i){for(r=[],n=je(),n===i&&(n=qe(),n===i&&(n=t.charAt(ce),z.test(n)?ce++:(n=i,0===pe&&we(ne))));n!==i;)r.push(n),n=je(),n===i&&(n=qe(),n===i&&(n=t.charAt(ce),z.test(n)?ce++:(n=i,0===pe&&we(ne))));39===t.charCodeAt(ce)?(n=N,ce++):(n=i,0===pe&&we(ae)),n!==i?(a=Re(),he=e,e=r.join("")):(ce=e,e=i)}else ce=e,e=i;return pe--,e===i&&(s=i,0===pe&&we(oe)),e}(),r!==i&&(he=e),e=r,e===i&&(e=ce,r=function(){let e,r;return pe++,e=ce,r=function(){let e,r,n,a;return pe++,e=ce,r=Me(),r!==i?(n=function(){let e,s,r,n,a;if(pe++,e=ce,46===t.charCodeAt(ce)?(s=j,ce++):(s=i,0===pe&&we(Qt)),s!==i)if(r=je(),r!==i){for(n=[],a=je(),a===i&&(a=qe());a!==i;)n.push(a),a=je(),a===i&&(a=qe());he=e,e=r+n.join("")}else ce=e,e=i;else ce=e,e=i;return pe--,e===i&&(s=i,0===pe&&we(ee)),e}(),n!==i?(a=Re(),he=e,e=function(t,e){let i=null;if(Object.prototype.hasOwnProperty.call(s,"values")){let r=s.values(t);r&&"object"==typeof r&&e in r&&(i=r[e])}return i}(r,n)):(ce=e,e=i)):(ce=e,e=i),pe--,e===i&&(r=i,0===pe&&we(Jt)),e}(),r!==i&&(he=e),e=r,e===i&&(e=ce,r=function(){let e,r,n,a,o,c;return pe++,e=ce,r=Me(),r!==i?(91===t.charCodeAt(ce)?(n=O,ce++):(n=i,0===pe&&we(Yt)),n!==i?(a=function(){let e,s,r,n;if(pe++,e=ce,s=[],r=je(),r===i&&(r=qe(),r===i&&(r=t.charAt(ce),$.test(r)?ce++:(r=i,0===pe&&we(ie)))),r!==i)for(;r!==i;)s.push(r),r=je(),r===i&&(r=qe(),r===i&&(r=t.charAt(ce),$.test(r)?ce++:(r=i,0===pe&&we(ie))));else s=i;if(s!==i&&(he=e,s=s.join("")),e=s,e===i){if(e=ce,34===t.charCodeAt(ce)?(s=T,ce++):(s=i,0===pe&&we(re)),s!==i){for(r=[],n=je(),n===i&&(n=qe(),n===i&&(n=t.charAt(ce),z.test(n)?ce++:(n=i,0===pe&&we(ne))));n!==i;)r.push(n),n=je(),n===i&&(n=qe(),n===i&&(n=t.charAt(ce),z.test(n)?ce++:(n=i,0===pe&&we(ne))));34===t.charCodeAt(ce)?(n=T,ce++):(n=i,0===pe&&we(re)),n!==i?(he=e,e=r.join("")):(ce=e,e=i)}else ce=e,e=i;if(e===i)if(e=ce,39===t.charCodeAt(ce)?(s=N,ce++):(s=i,0===pe&&we(ae)),s!==i){for(r=[],n=je(),n===i&&(n=qe(),n===i&&(n=t.charAt(ce),z.test(n)?ce++:(n=i,0===pe&&we(ne))));n!==i;)r.push(n),n=je(),n===i&&(n=qe(),n===i&&(n=t.charAt(ce),z.test(n)?ce++:(n=i,0===pe&&we(ne))));39===t.charCodeAt(ce)?(n=N,ce++):(n=i,0===pe&&we(ae)),n!==i?(he=e,e=function(t){return t.join("")}(r)):(ce=e,e=i)}else ce=e,e=i}return pe--,e===i&&(s=i,0===pe&&we(se)),e}(),a!==i?(93===t.charCodeAt(ce)?(o=P,ce++):(o=i,0===pe&&we(te)),o!==i?(c=Re(),he=e,e=function(t,e){let i=null;if(Object.prototype.hasOwnProperty.call(s,"values")){let r=s.values(t);r&&"object"==typeof r&&e in r&&(i=r[e])}return i}(r,a)):(ce=e,e=i)):(ce=e,e=i)):(ce=e,e=i)):(ce=e,e=i),pe--,e===i&&(r=i,0===pe&&we(Xt)),e}(),r!==i&&(he=e),e=r),pe--,e===i&&(r=i,0===pe&&we(Ht)),e}(),r!==i&&(he=e),e=r,e===i&&(e=ce,r=function(){let t,e;return pe++,t=ce,e=function(){let t,e,s;return pe++,t=ce,e=Me(),e!==i?(s=Re(),he=t,t=e):(ce=t,t=i),pe--,t===i&&(e=i,0===pe&&we(Wt)),t}(),e!==i&&(he=t,e=function(t){let e=null;return Object.prototype.hasOwnProperty.call(s,"values")&&(e=s.values(t)),e}(e)),t=e,pe--,t===i&&(e=i,0===pe&&we(Zt)),t}(),r!==i&&(he=e),e=r,e===i&&(e=ce,r=function(){let e,s,r;return pe++,e=ce,t.substr(ce,4)===o?(s=o,ce+=4):(s=i,0===pe&&we(B)),s!==i?(r=Re(),he=e,e=null):(ce=e,e=i),pe--,e===i&&(s=i,0===pe&&we(V)),e}(),r!==i&&(he=e),e=r,e===i&&(e=function(){let e,s;return pe++,e=ce,s=function(){let e,s,r;return pe++,e=ce,t.substr(ce,4)===l?(s=l,ce+=4):(s=i,0===pe&&we(X)),s!==i?(r=Re(),s=[s,r],e=s):(ce=e,e=i),pe--,e===i&&(s=i,0===pe&&we(J)),e}(),s!==i&&(he=e,s=!0),e=s,e===i&&(e=ce,s=function(){let e,s,r;return pe++,e=ce,t.substr(ce,5)===u?(s=u,ce+=5):(s=i,0===pe&&we(tt)),s!==i?(r=Re(),s=[s,r],e=s):(ce=e,e=i),pe--,e===i&&(s=i,0===pe&&we(Y)),e}(),s!==i&&(he=e,s=!1),e=s),pe--,e===i&&(s=i,0===pe&&we(I)),e}()))))),e}function Re(){let e,s;for(pe++,e=[],s=t.charAt(ce),Q.test(s)?ce++:(s=i,0===pe&&we(G));s!==i;)e.push(s),s=t.charAt(ce),Q.test(s)?ce++:(s=i,0===pe&&we(G));return pe--,e}function Ae(){let e,s,r;return pe++,e=ce,t.substr(ce,2)===f?(s=f,ce+=2):(s=i,0===pe&&we(rt)),s===i&&(t.substr(ce,3)===p?(s=p,ce+=3):(s=i,0===pe&&we(nt)),s===i&&(t.substr(ce,3)===b?(s=b,ce+=3):(s=i,0===pe&&we(at)))),s!==i?(r=Re(),s=[s,r],e=s):(ce=e,e=i),pe--,e===i&&(s=i,0===pe&&we(it)),e}function Le(){let e,s,r;return pe++,e=ce,t.substr(ce,2)===g?(s=g,ce+=2):(s=i,0===pe&&we(ct)),s===i&&(t.substr(ce,2)===y?(s=y,ce+=2):(s=i,0===pe&&we(ht)),s===i&&(t.substr(ce,2)===v?(s=v,ce+=2):(s=i,0===pe&&we(lt)))),s!==i?(r=Re(),s=[s,r],e=s):(ce=e,e=i),pe--,e===i&&(s=i,0===pe&&we(ot)),e}function qe(){let e,s;return pe++,e=t.charAt(ce),U.test(e)?ce++:(e=i,0===pe&&we(Tt)),pe--,e===i&&(s=i,0===pe&&we(Pt)),e}function ke(){let e,s;return pe++,45===t.charCodeAt(ce)?(e=M,ce++):(e=i,0===pe&&we(It)),pe--,e===i&&(s=i,0===pe&&we(zt)),e}function je(){let e,s;return pe++,e=t.charAt(ce),F.test(e)?ce++:(e=i,0===pe&&we(Bt)),pe--,e===i&&(s=i,0===pe&&we(Vt)),e}function Me(){let e,s,r,n;if(pe++,e=ce,36===t.charCodeAt(ce)?(s=D,ce++):(s=i,0===pe&&we(Kt)),s!==i){for(r=[],n=je(),n===i&&(n=qe());n!==i;)r.push(n),n=je(),n===i&&(n=qe());he=e,e=r.join("")}else ce=e,e=i;return pe--,e===i&&(s=i,0===pe&&we(Gt)),e}ue=a();const De=ue!==i&&ce===t.length;function Oe(){throw ue!==i&&ce<t.length&&we({type:"end"}),s=fe,r=de<t.length?function(e=ce){const s=t.codePointAt(e);return void 0===s?"":String.fromCodePoint(s)}(de):null,n=de<t.length?_e(de,de+1):_e(de,de),new e(e.buildMessage(s,r),s,r,n);var s,r,n}return s.peg$library?{peg$result:ue,peg$currPos:ce,peg$FAILED:i,peg$maxFailExpected:fe,peg$maxFailPos:de,peg$success:De,peg$throw:De?void 0:Oe}:De?ue:void Oe()}}}},e={};function s(i){var r=e[i];if(void 0!==r)return r.exports;var n=e[i]={exports:{}};return t[i](n,n.exports,s),n.exports}s.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return s.d(e,{a:e}),e},s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var i={};s.r(i),s.d(i,{ReactiveCard:()=>w,ReactiveDeck:()=>E,ReactiveExpression:()=>c,ReactiveQualitySet:()=>u,ReactiveState:()=>l,default:()=>x});var r=s(698),n=s.n(r);const{parse:a}=n();class o{constructor(t){this._expression="",this.change(t)}get expression(){return this._expression}change(t){if("string"!=typeof t)throw new Error("Expressions must be strings!");this._expression=t}check(t){if(!t||!t.keys)return!1;try{const e=e=>t.keys[e];return a(this._expression,{values:e})}catch(t){return console.warn("Expression check failed:",t),!1}}}class c{constructor(t,e){this.state=e,this.cachedResult=null,this.subscriptions=[],this.listeners=new Set,this.expression=new o(t),this.state&&this.bindToState(this.state)}get expressionString(){return this.expression.expression}bindToState(t){this.unbind(),this.state=t;const e=t.subscribe(()=>{this.invalidateCache(),this.notifyListeners()});this.subscriptions.push(e)}unbind(){this.subscriptions.forEach(t=>t()),this.subscriptions=[],this.state=void 0,this.cachedResult=null}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}get result(){if(!this.state)throw new Error("ReactiveExpression must be bound to a state");return null===this.cachedResult&&(this.cachedResult=this.expression.check(this.state)),this.cachedResult}check(t){return this.expression.check(t)}change(t){this.expression.change(t),this.invalidateCache(),this.notifyListeners()}listenerCount(){return this.listeners.size}clearListeners(){this.listeners.clear()}dispose(){this.unbind(),this.clearListeners()}invalidateCache(){this.cachedResult=null}notifyListeners(){if(!this.state)return;const t=this.result;this.listeners.forEach(e=>{try{e(t)}catch(t){console.error("Error in ReactiveExpression listener:",t)}})}}class h{constructor(){this._values={}}get keys(){return this._values}set(t,e){this._values[t]=e}get(t){let e=null;return this.exists(t)&&(e=this._values[t]),e}delete(t){let e=null;return this.exists(t)&&(e=this.get(t),delete this._values[t]),e}exists(t){return Object.prototype.hasOwnProperty.call(this._values,t)}size(){return Object.keys(this._values).length}}class l extends h{constructor(){super(),this.batchMode=!1,this.pendingNotifications=!1,this.listeners=new Set}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}set(t,e){const s=this.get(t);super.set(t,e),s!==e&&this.notifyListeners()}delete(t){const e=super.delete(t);return null!==e&&this.notifyListeners(),e}batch(t){if(this.batchMode)t();else{this.batchMode=!0,this.pendingNotifications=!1;try{t()}finally{this.batchMode=!1,this.pendingNotifications&&this.notifyListeners()}}}listenerCount(){return this.listeners.size}clearListeners(){this.listeners.clear()}notifyListeners(){this.batchMode?this.pendingNotifications=!0:this.listeners.forEach(t=>{try{t(this)}catch(t){console.error("Error in ReactiveState listener:",t)}})}}class u{constructor(t){this.state=t,this._set=[],this.cachedResult=null,this.subscriptions=[],this.listeners=new Set,this.state&&this.bindToState(this.state)}bindToState(t){this.unbind(),this.state=t,this._set.forEach(e=>e.bindToState(t));const e=t.subscribe(()=>{this.invalidateCache(),this.notifyListeners()});this.subscriptions.push(e)}unbind(){this.subscriptions.forEach(t=>t()),this.subscriptions=[],this._set.forEach(t=>t.unbind()),this.state=void 0,this.cachedResult=null}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}add(t){if("string"!=typeof t)throw new Error("Qualities must be strings!");if(!this.has(t)){const e=new c(t,this.state);e.subscribe(()=>{this.invalidateCache(),this.notifyListeners()}),this._set.push(e),this.invalidateCache(),this.notifyListeners()}}has(t){if("string"!=typeof t)throw new Error("Can only check string values!");return this._set.some(e=>e.expressionString===t)}remove(t){if("string"!=typeof t)throw new Error("Must pass string values to remove!");const e=this._set.length,s=this._set.find(e=>e.expressionString===t);s&&(s.dispose(),this._set=this._set.filter(e=>e.expressionString!==t),this._set.length!==e&&(this.invalidateCache(),this.notifyListeners()))}get result(){if(!this.state)throw new Error("ReactiveQualitySet must be bound to a state");return null===this.cachedResult&&(this.cachedResult=this._set.every(t=>t.result)),this.cachedResult}check(t){if(t instanceof l)return this._set.every(e=>e.check(t));throw new Error("Must have ReactiveState to check() against!")}size(){return this._set.length}listenerCount(){return this.listeners.size}clearListeners(){this.listeners.clear()}dispose(){this.unbind(),this._set.forEach(t=>t.dispose()),this._set=[],this.clearListeners()}invalidateCache(){this.cachedResult=null}notifyListeners(){if(!this.state)return;const t=this.result;this.listeners.forEach(e=>{try{e(t)}catch(t){console.error("Error in ReactiveQualitySet listener:",t)}})}}class d{constructor(){this._set=[]}add(t){if("string"!=typeof t)throw new Error("Qualities must be strings!");if(!this.has(t)){const e=new o(t);this._set.push(e)}}has(t){if("string"!=typeof t)throw new Error("Can only check string values!");return this._set.some(e=>e.expression===t)}remove(t){if("string"!=typeof t)throw new Error("Must pass string values to remove!");this._set=this._set.filter(e=>e.expression!==t)}check(t){if(t instanceof h)return this._set.every(e=>e.check(t));throw new Error("Must have State to check() against!")}size(){return this._set.length}}const f={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let p;const b=new Uint8Array(16),g=[];for(let t=0;t<256;++t)g.push((t+256).toString(16).slice(1));function y(t,e,s){const i=(t=t||{}).random??t.rng?.()??function(){if(!p){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");p=crypto.getRandomValues.bind(crypto)}return p(b)}();if(i.length<16)throw new Error("Random bytes length must be >= 16");if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,e){if((s=s||0)<0||s+16>e.length)throw new RangeError(`UUID byte range ${s}:${s+15} is out of buffer bounds`);for(let t=0;t<16;++t)e[s+t]=i[t];return e}return function(t,e=0){return(g[t[e+0]]+g[t[e+1]]+g[t[e+2]]+g[t[e+3]]+"-"+g[t[e+4]]+g[t[e+5]]+"-"+g[t[e+6]]+g[t[e+7]]+"-"+g[t[e+8]]+g[t[e+9]]+"-"+g[t[e+10]]+g[t[e+11]]+g[t[e+12]]+g[t[e+13]]+g[t[e+14]]+g[t[e+15]]).toLowerCase()}(i)}const v=function(t,e,s){return!f.randomUUID||e||t?y(t,e,s):f.randomUUID()};class _{constructor(t="",e=[]){this._content="",this._qualities=new d,this.content=t,this.qualities=e,this._hash=v()}get content(){return this._content}set content(t){if("string"!=typeof t)throw new Error("Content must be expressed as a string!");this._content=t}get qualities(){return this._qualities}set qualities(t){this._qualities=new d,t.forEach(t=>this.addQuality(t))}get hash(){return this._hash}isAvailable(t){if(t instanceof h)return this._qualities.check(t);throw new Error("Must be passed State to check if available")}addQuality(t){this._qualities.add(t)}removeQuality(t){this._qualities.remove(t)}}class w{constructor(t="",e=[],s){this.state=s,this.cachedAvailability=null,this.subscriptions=[],this.listeners=new Set,this._content="",this._qualities=new u(this.state),this.content=t,this.qualities=e,this._hash=v(),this.state&&this.bindToState(this.state)}bindToState(t){this.unbind(),this.state=t,this._qualities.bindToState(t);const e=this._qualities.subscribe(()=>{this.invalidateCache(),this.notifyListeners()}),s=t.subscribe(()=>{this.invalidateCache(),this.notifyListeners()});this.subscriptions.push(e,s)}unbind(){this.subscriptions.forEach(t=>t()),this.subscriptions=[],this._qualities.unbind(),this.state=void 0,this.cachedAvailability=null}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}get content(){return this._content}set content(t){if("string"!=typeof t)throw new Error("Content must be expressed as a string!");this._content!==t&&(this._content=t)}get qualities(){return this._qualities}set qualities(t){if(this._qualities.dispose(),this._qualities=new u(this.state),t.forEach(t=>this.addQuality(t)),this.state){this._qualities.bindToState(this.state);const t=this._qualities.subscribe(()=>{this.invalidateCache(),this.notifyListeners()});this.subscriptions.push(t)}}get hash(){return this._hash}get available(){if(!this.state)throw new Error("ReactiveCard must be bound to a state");return null===this.cachedAvailability&&(this.cachedAvailability=this._qualities.result),this.cachedAvailability}isAvailable(t){if(t instanceof l)return this._qualities.check(t);throw new Error("Must be passed ReactiveState to check if available")}addQuality(t){this._qualities.add(t)}removeQuality(t){this._qualities.remove(t)}toCard(){for(let t=0;t<this._qualities.size();t++);return new _(this.content,[])}listenerCount(){return this.listeners.size}clearListeners(){this.listeners.clear()}dispose(){this.unbind(),this._qualities.dispose(),this.clearListeners()}invalidateCache(){this.cachedAvailability=null}notifyListeners(){if(!this.state)return;const t=this.available;this.listeners.forEach(e=>{try{e(t)}catch(t){console.error("Error in ReactiveCard listener:",t)}})}}class m{constructor(){this.cards=[],this._state=new h}get state(){return this._state}set state(t){if(!(t instanceof h))throw new Error("Passed value is not an instance of State");this._state=t}getCard(t=-1){let e=null;return t>=0&&t<this.cards.length&&(e=this.cards[t]),e}updateCard(t){if(!(t instanceof _))throw new Error("Updated card must be Card!");this.cards.forEach((e,s)=>{e.hash===t.hash&&(this.cards[s]=t)})}size(){return this.cards.length}addCard(t,e=[]){if("string"!=typeof t)throw new Error("Card content must be string!");if(!Array.isArray(e))throw new Error("Qualities must be passed as array!");const s=new _(t,e);this.cards.push(s)}removeCard(t){this.cards=this.cards.filter(e=>e!==t)}shuffle(){for(let t=this.cards.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[this.cards[t],this.cards[e]]=[this.cards[e],this.cards[t]]}}draw(t=1){let e=[];return t>0&&(e=this.cards.filter(t=>t.isAvailable(this.state)),e=e.slice(0,t)),e}}class E{get cards(){return this._cards}set cards(t){this._cards.forEach(t=>t.unbind()),this._cards=t,this._state&&this._cards.forEach(t=>t.bindToState(this._state)),this.notifyListeners()}constructor(t=[],e){this._cards=[],this.subscriptions=[],this.listeners=new Set,this._cards=t,e&&(this._state=e,this.bindToState(e))}bindToState(t){this.unbind(),this._state=t,this._cards.forEach(e=>e.bindToState(t));const e=t.subscribe(()=>{this.notifyListeners()});this.subscriptions.push(e)}unbind(){this.subscriptions.forEach(t=>t()),this.subscriptions=[],this._cards.forEach(t=>t.unbind()),this._state=void 0}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}get state(){if(!this._state)throw new Error("ReactiveDeck must be bound to a state");return this._state}set state(t){if(!(t instanceof l))throw new Error("Passed value is not an instance of ReactiveState");this.bindToState(t),this.notifyListeners()}getCard(t=-1){let e=null;return t>=0&&t<this._cards.length&&(e=this._cards[t]),e}updateCard(t){if(!(t instanceof w))throw new Error("Updated card must be ReactiveCard!");this._cards.forEach((e,s)=>{e.hash===t.hash&&(this._cards[s].dispose(),this._cards[s]=t,this._state&&t.bindToState(this._state),this.notifyListeners())})}size(){return this._cards.length}addCard(t){if(!(t instanceof w))throw new Error("Must be passed ReactiveCard to add to deck");this._state&&t.bindToState(this._state),this._cards.push(t),this.notifyListeners()}removeCard(t){const e=this._cards.length,s=this._cards.find(e=>e===t);s&&s.unbind(),this._cards=this._cards.filter(e=>e!==t),this._cards.length!==e&&this.notifyListeners()}shuffle(){for(let t=this._cards.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[this._cards[t],this._cards[e]]=[this._cards[e],this._cards[t]]}this.notifyListeners()}get availableCards(){if(!this._state)throw new Error("ReactiveDeck must be bound to a state");return this._cards.filter(t=>t.available)}draw(){if(!this._state)throw new Error("ReactiveDeck must be bound to a state");const t=this.availableCards;return 0===t.length?null:t[Math.floor(Math.random()*t.length)]}getAvailableCards(t){if(!(t instanceof l))throw new Error("Must be passed ReactiveState to check available cards");return this._cards.filter(e=>e.isAvailable(t))}drawFromState(t){const e=this.getAvailableCards(t);return 0===e.length?null:e[Math.floor(Math.random()*e.length)]}isCardAvailable(t){if(!this._state)throw new Error("ReactiveDeck must be bound to a state");return t.isAvailable(this._state)}toDeck(){return new m}listenerCount(){return this.listeners.size}clearListeners(){this.listeners.clear()}dispose(){this.unbind(),this._cards.forEach(t=>t.dispose()),this._cards=[],this.clearListeners(),this._state=void 0}notifyListeners(){this.listeners.forEach(t=>{try{this._state&&t(this.availableCards)}catch(t){console.error("Error in ReactiveDeck listener:",t)}})}}"undefined"!=typeof window&&(window.ReactiveSimpleQBN={ReactiveCard:w,ReactiveDeck:E,ReactiveExpression:c,ReactiveQualitySet:u,ReactiveState:l});const x={ReactiveCard:w,ReactiveDeck:E,ReactiveExpression:c,ReactiveQualitySet:u,ReactiveState:l};return i})());