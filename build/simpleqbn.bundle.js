(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{$and:()=>ft,$not:()=>ht,$or:()=>pt});var n={};t.r(n),t.d(n,{$cmp:()=>dt,$eq:()=>Wt,$gt:()=>Kt,$gte:()=>Bt,$lt:()=>Jt,$lte:()=>Xt,$ne:()=>Zt});var r={};t.r(r),t.d(r,{$elemMatch:()=>oe,$slice:()=>ie});var o={};t.r(o),t.d(o,{$all:()=>se,$and:()=>Ae,$bitsAllClear:()=>le,$bitsAllSet:()=>fe,$bitsAnyClear:()=>he,$bitsAnySet:()=>pe,$elemMatch:()=>ae,$eq:()=>de,$exists:()=>Oe,$expr:()=>ke,$gt:()=>ye,$gte:()=>be,$in:()=>ge,$jsonSchema:()=>xe,$lt:()=>me,$lte:()=>ve,$mod:()=>Ee,$ne:()=>$e,$nin:()=>we,$nor:()=>_e,$not:()=>Ie,$or:()=>Pe,$regex:()=>Se,$size:()=>ue,$type:()=>je,$where:()=>Me});var i={};t.r(i),t.d(i,{$addToSet:()=>qe,$bit:()=>Le,$currentDate:()=>De,$inc:()=>Ge,$max:()=>Ve,$min:()=>Qe,$mul:()=>We,$pop:()=>Ke,$pull:()=>Be,$pullAll:()=>Je,$push:()=>Ze,$rename:()=>Ye,$set:()=>He,$unset:()=>tn});class s extends Error{}const a=Symbol("missing"),u=Object.freeze(new Error("mingo: cycle detected while processing object/array")),c=t=>{const e=q(t);let n=0,r=e.length;for(;r;)n=(n<<5)-n^e.charCodeAt(--r);return n>>>0},l=t=>"object"!=typeof t&&"function"!=typeof t||null===t,f=t=>l(t)||k(t)||x(t),h={undefined:1,null:2,number:3,string:4,symbol:5,object:6,array:7,arraybuffer:8,boolean:9,date:10,regexp:11,function:12},p=(t,e)=>{t===a&&(t=void 0),e===a&&(e=void 0);const[n,r]=[t,e].map((t=>h[g(t)]||0));return n!==r?n-r:z(t,e)?0:t<e?-1:t>e?1:0};class d extends Map{#t=c;#e=new Map;#n=t=>{const e=this.#t(t);return[(this.#e.get(e)||[]).find((e=>z(e,t))),e]};constructor(){super()}static init(t){const e=new d;return t&&(e.#t=t),e}clear(){super.clear(),this.#e.clear()}delete(t){if(l(t))return super.delete(t);const[e,n]=this.#n(t);return!!super.delete(e)&&(this.#e.set(n,this.#e.get(n).filter((t=>!z(t,e)))),!0)}get(t){if(l(t))return super.get(t);const[e,n]=this.#n(t);return super.get(e)}has(t){if(l(t))return super.has(t);const[e,n]=this.#n(t);return super.has(e)}set(t,e){if(l(t))return super.set(t,e);const[n,r]=this.#n(t);if(super.has(n))super.set(n,e);else{super.set(t,e);const n=this.#e.get(r)||[];n.push(t),this.#e.set(r,n)}return this}get size(){return super.size}}function y(t,e){if(!t)throw new s(e)}const b=Object.keys(h).reduce(((t,e)=>(t["[object "+e[0].toUpperCase()+e.substring(1)+"]"]=e,t)),{});function g(t){const e=Object.prototype.toString.call(t);return"[object Object]"===e?t?.constructor?.name?.toLowerCase()||"object":b[e]||e.substring(8,e.length-1).toLowerCase()}const m=t=>"boolean"==typeof t,v=t=>"string"==typeof t,$=t=>!isNaN(t)&&"number"==typeof t,w=Array.isArray;function O(t){if(!t)return!1;const e=Object.getPrototypeOf(t);return(e===Object.prototype||null===e)&&"object"===g(t)}const j=t=>!l(t),k=t=>t instanceof Date,x=t=>t instanceof RegExp,E=t=>"function"==typeof t,S=t=>null==t,M=(t,e=!0)=>!!t||e&&""===t,A=t=>S(t)||v(t)&&!t||w(t)&&0===t.length||O(t)&&0===Object.keys(t).length,P=t=>w(t)?t:[t],_=(t,e)=>!!t&&Object.prototype.hasOwnProperty.call(t,e),I=(t,e)=>{if(S(t)||m(t)||$(t)||v(t))return t;if(k(t))return new Date(t);if(x(t))return new RegExp(t);if((t=>"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView(t))(t))return new(0,t.constructor)(t);if(e instanceof Set||(e=new Set),e.has(t))throw u;e.add(t);try{if(w(t)){const n=new Array(t.length);for(let r=0;r<t.length;r++)n[r]=I(t[r],e);return n}if(O(t)){const n={};for(const r of Object.keys(t))n[r]=I(t[r],e);return n}}finally{e.delete(t)}return t},N=t=>t===a;function C(t,e){if(N(t)||S(t))return e;if(N(e)||S(e))return t;if(l(t)||l(e))return e;w(t)&&w(e)&&y(t.length===e.length,"arrays must be of equal length to merge.");for(const n of Object.keys(e))t[n]=C(t[n],e[n]);return t}function T(t,e=c){const n=[d.init(e),d.init(e)];if(0===t.length)return[];if(t.some((t=>0===t.length)))return[];if(1===t.length)return[...t];t[t.length-1].forEach((t=>n[0].set(t,!0)));for(let e=t.length-2;e>-1;e--){if(t[e].forEach((t=>{n[0].has(t)&&n[1].set(t,!0)})),0===n[1].size)return[];n.reverse(),n[1].clear()}return Array.from(n[0].keys())}function U(t,e=1){const n=new Array;return function t(e,r){for(let o=0,i=e.length;o<i;o++)w(e[o])&&(r>0||r<0)?t(e[o],Math.max(-1,r-1)):n.push(e[o])}(t,e),n}function R(t){for(;t;){if(Object.getOwnPropertyNames(t).includes("toString"))return t.toString!==Object.prototype.toString;t=Object.getPrototypeOf(t)}return!1}function z(t,e){if(t===e||Object.is(t,e))return!0;if(null===t||null===e)return!1;if(typeof t!=typeof e)return!1;if("object"!=typeof t)return!1;if(t.constructor!==e.constructor)return!1;if(t instanceof Date)return+t==+e;if(t instanceof RegExp)return t.toString()===e.toString();const n=t.constructor;if(n===Array||n===Object){const n=Object.keys(t).sort(),r=Object.keys(e).sort();if(n.length!==r.length)return!1;for(let o=0,i=n[o];o<n.length;i=n[++o])if(i!==r[o]||!z(t[i],e[i]))return!1;return!0}return R(t)&&t.toString()===e.toString()}const q=(t,e)=>{if(null===t)return"null";if(void 0===t)return"undefined";if(v(t)||$(t)||m(t))return JSON.stringify(t);if(k(t))return t.toISOString();if(x(t)||(t=>"symbol"==typeof t)(t)||E(t))return t.toString();if(e instanceof Set||(e=new Set),e.has(t))throw u;try{if(e.add(t),w(t))return"["+t.map((t=>q(t,e))).join(",")+"]";if(O(t))return"{"+Object.keys(t).sort().map((n=>`${n}:${q(t[n],e)}`)).join()+"}";const n=R(t)?t.toString():q(function(t){const e={};for(;t;){for(const n of Object.getOwnPropertyNames(t))n in e||(e[n]=t[n]);t=Object.getPrototypeOf(t)}return e}(t),e);return g(t)+"("+n+")"}finally{e.delete(t)}};function F(t,e){return S(t)?null:(e=e||c)(t)}function L(t,e,n=c){if(t.length<1)return new Map;const r=new Map,o=new Map;for(let i=0;i<t.length;i++){const s=t[i],a=e(s,i),u=F(a,n);if(null===u)o.has(null)?o.get(null).push(s):o.set(null,[s]);else{const t=r.has(u)?r.get(u).find((t=>z(t,a))):null;S(t)?(o.set(a,[s]),r.has(u)?r.get(u).push(a):r.set(u,[a])):o.get(t).push(s)}}return o}function D(t,e){return j(t)?t[e]:void 0}function G(t,e,n){let r=0;const o=f(t)?t:function t(e,n){let o=e;for(let e=0;e<n.length;e++){const i=n[e];if(null===/^\d+$/.exec(i)&&w(o)){if(0===e&&r>0)break;r+=1;const i=n.slice(e);o=o.reduce(((e,n)=>{const r=t(n,i);return void 0!==r&&e.push(r),e}),[]);break}if(o=D(o,i),void 0===o)break}return o}(t,e.split("."));return w(o)&&n?.unwrapArray?function(t,e){if(e<1)return t;for(;e--&&1===t.length;)t=t[0];return t}(o,r):o}function V(t,e,n){const r=e.indexOf("."),o=-1==r?e:e.substring(0,r),i=e.substring(r+1),s=-1!=r;if(w(t)){const r=/^\d+$/.test(o),u=r&&n?.preserveIndex?[...t]:[];if(r){const e=parseInt(o);let r=D(t,e);s&&(r=V(r,i,n)),n?.preserveIndex?u[e]=r:u.push(r)}else for(const r of t){const t=V(r,e,n);n?.preserveMissing?u.push(null==t?a:t):(null!=t||n?.preserveIndex)&&u.push(t)}return u}const u=n?.preserveKeys?{...t}:{};let c=D(t,o);if(s&&(c=V(c,i,n)),void 0!==c)return u[o]=c,u}function Q(t){if(w(t))for(let e=t.length-1;e>=0;e--)t[e]===a?t.splice(e,1):Q(t[e]);else if(O(t))for(const e in t)_(t,e)&&Q(t[e])}const W=/^\d+$/;function K(t,e,n,r){const o=e.split("."),i=o[0],s=o.slice(1).join(".");if(1===o.length)(O(t)||w(t)&&W.test(i))&&n(t,i);else{r?.buildGraph&&S(t[i])&&(t[i]={});const e=t[i];if(!e)return;const a=!!(o.length>1&&W.test(o[1]));w(e)&&r?.descendArray&&!a?e.forEach((t=>K(t,s,n,r))):K(e,s,n,r)}}function B(t,e,n){K(t,e,((t,e)=>{t[e]=E(n)?n(t[e]):n}),{buildGraph:!0})}function J(t,e,n){K(t,e,((t,e)=>{if(w(t)){if(/^\d+$/.test(e))t.splice(parseInt(e),1);else if(n&&n.descendArray)for(const n of t)O(n)&&delete n[e]}else O(t)&&delete t[e]}),n)}const X=/^\$[a-zA-Z0-9_]+$/;function Z(t){return X.test(t)}function H(t){if(f(t))return x(t)?{$regex:t}:{$eq:t};if(j(t)){if(!Object.keys(t).some(Z))return{$eq:t};if(_(t,"$regex")){const e={...t};return e.$regex=new RegExp(t.$regex,t.$options),delete e.$options,e}}return t}var Y=(t=>(t[t.CLONE_OFF=0]="CLONE_OFF",t[t.CLONE_INPUT=1]="CLONE_INPUT",t[t.CLONE_OUTPUT=2]="CLONE_OUTPUT",t[t.CLONE_ALL=3]="CLONE_ALL",t))(Y||{});class tt{#r;#o;#i;constructor(t,e,n){this.#r=t,this.update(e,n)}static init(t,e,n){return t instanceof tt?new tt(t.#r,t.root??e,{...t.#i,...n,variables:Object.assign({},t.#i?.variables,n?.variables)}):new tt(t,e,n)}update(t,e){this.#o=t;const n=Object.assign({},this.#i?.variables,e?.variables);return Object.keys(n).length?this.#i={...e,variables:n}:this.#i=e??{},this}getOptions(){return Object.freeze({...this.#r,context:nt.from(this.#r.context)})}get root(){return this.#o}get local(){return this.#i}get idKey(){return this.#r.idKey}get collation(){return this.#r?.collation}get processingMode(){return this.#r?.processingMode||0}get useStrictMode(){return this.#r?.useStrictMode}get scriptEnabled(){return this.#r?.scriptEnabled}get useGlobalContext(){return this.#r?.useGlobalContext}get hashFunction(){return this.#r?.hashFunction}get collectionResolver(){return this.#r?.collectionResolver}get jsonSchemaValidator(){return this.#r?.jsonSchemaValidator}get variables(){return this.#r?.variables}get context(){return this.#r?.context}}function et(t){return t instanceof tt?t.getOptions():Object.freeze({idKey:"_id",scriptEnabled:!0,useStrictMode:!0,useGlobalContext:!0,processingMode:0,...t,context:t?.context?nt.from(t?.context):nt.init()})}class nt{#s=new Map;constructor(){}static init(){return new nt}static from(t){const e=nt.init();return S(t)||t.#s.forEach(((t,n)=>e.addOperators(n,t))),e}addOperators(t,e){this.#s.has(t)||this.#s.set(t,{});for(const[n,r]of Object.entries(e))this.getOperator(t,n)||(this.#s.get(t)[n]=r);return this}getOperator(t,e){return(this.#s.get(t)??{})[e]??null}addAccumulatorOps(t){return this.addOperators("accumulator",t)}addExpressionOps(t){return this.addOperators("expression",t)}addQueryOps(t){return this.addOperators("query",t)}addPipelineOps(t){return this.addOperators("pipeline",t)}addProjectionOps(t){return this.addOperators("projection",t)}addWindowOps(t){return this.addOperators("window",t)}}const rt=nt.init();function ot(t,e){for(const[n,r]of Object.entries(e)){y(E(r)&&Z(n),`'${n}' is not a valid operator`);const e=it(t,n,null);y(!e||r===e,`${n} already exists for '${t}' operators. Cannot change operator function once registered.`)}switch(t){case"accumulator":rt.addAccumulatorOps(e);break;case"expression":rt.addExpressionOps(e);break;case"pipeline":rt.addPipelineOps(e);break;case"projection":rt.addProjectionOps(e);break;case"query":rt.addQueryOps(e);break;case"window":rt.addWindowOps(e)}}function it(t,e,n){const{context:r,useGlobalContext:o}=n||{},i=r?r.getOperator(t,e):null;return!i&&o?rt.getOperator(t,e):i}function st(t,e,n,r){const o=tt.init(r,t);return n&&Z(n)?ct(t,e,n,o):ut(t,e,o)}const at=["$$ROOT","$$CURRENT","$$REMOVE","$$NOW"];function ut(t,e,n){if(v(e)&&e.length>0&&"$"===e[0]){if(lt.includes(e))return e;let r=n.root;const o=e.split(".");if(at.includes(o[0])){switch(o[0]){case"$$ROOT":break;case"$$CURRENT":r=t;break;case"$$REMOVE":r=void 0;break;case"$$NOW":r=new Date}e=e.slice(o[0].length+1)}else if("$$"===o[0].slice(0,2)){r=Object.assign({},n.variables,{this:t},n?.local?.variables);const i=o[0].slice(2);y(_(r,i),`Use of undefined variable: ${i}`),e=e.slice(2)}else e=e.slice(1);return""===e?r:G(r,e)}if(w(e))return e.map((e=>ut(t,e,n)));if(O(e)){const r={},o=Object.entries(e);for(const[e,i]of o){if(Z(e))return y(1==o.length,"expression must have single operator."),ct(t,i,e,n);r[e]=ut(t,i,n)}return r}return e}function ct(t,e,n,r){const o=it("expression",n,r);if(o)return o(t,e,r);const i=it("accumulator",n,r);return y(!!i,`accumulator '${n}' is not registered.`),w(t)||(t=ut(t,e,r),e=null),y(w(t),`arguments must resolve to array for ${n}.`),i(t,e,r)}const lt=["$$KEEP","$$PRUNE","$$DESCEND"],ft=(t,e,n)=>{const r=st(t,e,null,n);return M(r,n.useStrictMode)&&r.every((t=>M(t,n.useStrictMode)))},ht=(t,e,n)=>{const r=P(e);return 0!=r.length&&(y(1==r.length,"Expression $not takes exactly 1 argument"),!st(t,r[0],null,n))},pt=(t,e,n)=>{const r=st(t,e,null,n),o=n.useStrictMode;return M(r,o)&&r.some((t=>M(t,o)))},dt=(t,e,n)=>{const r=st(t,e,null,n);return y(w(r)&&2==r.length,"$cmp: expression must resolve to array of size 2."),p(r[0],r[1])};function yt(t){return t instanceof mt?t:new mt(t)}function bt(t,e){const n=t.slice(e+1);t.splice(e),Array.prototype.push.apply(t,n)}const gt=new Error;class mt{constructor(t){let e;if(this.#a=[],this.#u=[],this.isDone=!1,t instanceof Function&&(t={next:t}),(n=t)&&"object"==typeof n&&n?.next instanceof Function){const n=t;e=()=>{const t=n.next();if(t.done)throw gt;return t.value}}else if(w(t)){const n=t,r=n.length;let o=0;e=()=>{if(o<r)return n[o++];throw gt}}else if(!(t instanceof Function))throw new s("Lazy must be initialized with an array, generator, or function.");var n;this.#c=function(t,e,n){let r=!1,o=-1,i=0;return function(s){try{t:for(;!r;){let a=t();o++;let u=-1;const c=e.length;let l=!1;for(;++u<c;){const t=e[u];switch(t.action){case 0:a=t.func(a,o);break;case 1:if(!t.func(a,o))continue t;break;case 2:--t.count,t.count||(l=!0);break;case 3:--t.count,t.count||bt(e,u);continue t;default:break t}}if(r=l,!s)return{value:a,done:!1};n[i++]=a}}catch(t){if(t!==gt)throw t}return r=!0,{done:r}}}(e,this.#a,this.#u)}#a;#u;#c;push(t,e){return"function"==typeof e?this.#a.push({action:t,func:e}):"number"==typeof e&&this.#a.push({action:t,count:e}),this}next(){return this.#c()}map(t){return this.push(0,t)}filter(t){return this.push(1,t)}take(t){return t>0?this.push(2,t):this}drop(t){return t>0?this.push(3,t):this}transform(t){const e=this;let n;return yt((()=>(n||(n=yt(t(e.value()))),n.next())))}value(){return this.isDone||(this.isDone=this.#c(!0).done),this.#u}each(t){for(;;){const e=this.next();if(e.done)break;if(!1===t(e.value))return!1}return!0}reduce(t,e){let n=this.next();for(void 0!==e||n.done||(e=n.value,n=this.next());!n.done;)e=t(e,n.value),n=this.next();return e}size(){return this.reduce(((t,e)=>++t),0)}[Symbol.iterator](){return this}}const vt=(t,e,n)=>t.take(e),$t=(t,e,n)=>A(e)?t:(Ot(e,n),t.map(wt(e,tt.init(n))));function wt(t,e,n=!0){const r=e.idKey,o=Object.keys(t),i=new Array,s=new Array,a={};for(const r of o){const o=t[r];if($(o)||m(o))o?s.push(r):i.push(r);else if(w(o))a[r]=t=>o.map((n=>st(t,n,null,e.update(t))??null));else if(O(o)){const t=Object.keys(o),i=1==t.length?t[0]:"",s=it("projection",i,e);s?"$slice"!==i||P(o[i]).every($)?a[r]=t=>s(t,o[i],r,e.update(t)):a[r]=t=>st(t,o,r,e.update(t)):Z(i)?a[r]=t=>st(t,o[i],i,e):(Ot(o,e),a[r]=t=>{if(!_(t,r))return st(t,o,null,e);n&&e.update(t);const i=G(t,r),s=wt(o,e,!1);return w(i)?i.map(s):O(i)?s(i):s(t)})}else a[r]=v(o)&&"$"===o[0]?t=>st(t,o,r,e):t=>o}const u=Object.keys(a),c=i.includes(r);if(n&&c&&1===i.length&&!s.length&&!u.length)return t=>{const e={...t};return delete e[r],e};const l=n&&!c&&!s.includes(r),f={preserveMissing:!0};return t=>{const e={};if(i.length&&!s.length){C(e,t);for(const t of i)J(e,t,{descendArray:!0})}for(const n of s)C(e,V(t,n,f)??{});s.length&&Q(e);for(const n of u){const r=a[n](t);void 0===r?J(e,n,{descendArray:!0}):B(e,n,r)}return l&&_(t,r)&&(e[r]=G(t,r)),e}}function Ot(t,e){let n=!1,r=!1;for(const[o,i]of Object.entries(t))y(!o.startsWith("$"),"Field names may not start with '$'."),y(!o.endsWith(".$"),"Positional projection operator '$' is not supported."),o!==e?.idKey&&(0===i||!1===i?n=!0:1!==i&&!0!==i||(r=!0),y(!(n&&r),"Projection cannot have a mix of inclusion and exclusion."))}const jt=(t,e,n)=>t.drop(e),kt=(t,e,n)=>{if(A(e)||!O(e))return t;let r=p;const o=n.collation;return O(o)&&v(o.locale)&&(r=function(t){const e={sensitivity:xt[t.strength||3],caseFirst:"off"===t.caseFirst?"false":t.caseFirst||"false",numeric:t.numericOrdering||!1,ignorePunctuation:"shifted"===t.alternate};!0===(t.caseLevel||!1)&&("base"===e.sensitivity&&(e.sensitivity="case"),"accent"===e.sensitivity&&(e.sensitivity="variant"));const n=new Intl.Collator(t.locale,e);return(t,e)=>{if(!v(t)||!v(e))return p(t,e);const r=n.compare(t,e);return r<0?-1:r>0?1:0}}(o)),t.transform((t=>{const o=Object.keys(e);for(const i of o.reverse()){const o=L(t,(t=>G(t,i)),n.hashFunction),s=Array.from(o.keys()).sort(r);-1===e[i]&&s.reverse();let a=0;for(const e of s)for(const n of o.get(e))t[a++]=n;y(a==t.length,"bug: counter must match collection size.")}return t}))},xt={1:"base",2:"accent",3:"variant"},Et={$sort:kt,$skip:jt,$limit:vt};class St{#l;#f;#h;#r;#s={};#p=null;#d=[];constructor(t,e,n,r){this.#l=t,this.#f=e,this.#h=n,this.#r=r}fetch(){if(this.#p)return this.#p;this.#p=yt(this.#l).filter(this.#f);const t=this.#r.processingMode;t&Y.CLONE_INPUT&&this.#p.map(I);for(const t of["$sort","$skip","$limit"])_(this.#s,t)&&(this.#p=Et[t](this.#p,this.#s[t],this.#r));return Object.keys(this.#h).length&&(this.#p=$t(this.#p,this.#h,this.#r)),t&Y.CLONE_OUTPUT&&this.#p.map(I),this.#p}fetchAll(){const t=yt([...this.#d]);return this.#d=[],function(...t){let e=0;return yt((()=>{for(;e<t.length;){const n=t[e].next();if(!n.done)return n;e++}return{done:!0}}))}(t,this.fetch())}all(){return this.fetchAll().value()}count(){return this.all().length}skip(t){return this.#s.$skip=t,this}limit(t){return this.#s.$limit=t,this}sort(t){return this.#s.$sort=t,this}collation(t){return this.#r={...this.#r,collation:t},this}next(){if(this.#d.length>0)return this.#d.pop();const t=this.fetch().next();return t.done?void 0:t.value}hasNext(){if(this.#d.length>0)return!0;const t=this.fetch().next();return!t.done&&(this.#d.push(t.value),!0)}map(t){return this.all().map(t)}forEach(t){this.all().forEach(t)}[Symbol.iterator](){return this.fetchAll()}}const Mt=new Set(Array.from(["$and","$or","$nor","$expr","$jsonSchema"]));class At{#y;#r;#b;constructor(t,e){this.#b=I(t),this.#r=et(e),this.#y=[],this.compile()}compile(){y(O(this.#b),`query criteria must be an object: ${JSON.stringify(this.#b)}`);const t={};for(const[e,n]of Object.entries(this.#b)){if("$where"===e)y(this.#r.scriptEnabled,"$where operator requires 'scriptEnabled' option to be true."),Object.assign(t,{field:e,expr:n});else if(Mt.has(e))this.processOperator(e,e,n);else{y(!Z(e),`unknown top level operator: ${e}`);for(const[t,r]of Object.entries(H(n)))this.processOperator(e,t,r)}t.field&&this.processOperator(t.field,t.field,t.expr)}}processOperator(t,e,n){const r=it("query",e,this.#r);y(!!r,`unknown query operator ${e}`),this.#y.push(r(t,n,this.#r))}test(t){return this.#y.every((e=>e(t)))}find(t,e){return new St(t,(t=>this.test(t)),e||{},this.#r)}remove(t){return t.reduce(((t,e)=>(this.test(e)||t.push(e),t)),[])}}function Pt(t){return(e,n,r)=>{const o={unwrapArray:!0},i=Math.max(1,e.split(".").length-1);return s=>{const a=G(s,e,o);return t(a,n,{...r,depth:i})}}}function _t(t){return(e,n,r)=>{const o=st(e,n,null,r);return t(...o)}}function It(t,e,n){return!!z(t,e)||!(!S(t)||!S(e))||!!w(t)&&(t.some((t=>z(t,e)))||U(t,n?.depth).some((t=>z(t,e))))}function Nt(t,e,n){return!It(t,e,n)}function Ct(t,e,n){return S(t)?e.some((t=>null===t)):T([P(t),e],n?.hashFunction).length>0}function Tt(t,e,n){return!Ct(t,e,n)}function Ut(t,e,n){return Qt(t,e,((t,e)=>p(t,e)<0))}function Rt(t,e,n){return Qt(t,e,((t,e)=>p(t,e)<=0))}function zt(t,e,n){return Qt(t,e,((t,e)=>p(t,e)>0))}function qt(t,e,n){return Qt(t,e,((t,e)=>p(t,e)>=0))}function Ft(t){return Z(t)&&-1===["$and","$or","$nor"].indexOf(t)}function Lt(t,e,n){if(w(t)&&!A(t)){let r=t=>t,o=e;Object.keys(e).every(Ft)&&(o={temp:e},r=t=>({temp:t}));const i=new At(o,n);for(let e=0,n=t.length;e<n;e++)if(i.test(r(t[e])))return!0}return!1}const Dt=t=>null===t,Gt={array:w,boolean:m,bool:m,date:k,number:$,int:$,long:$,double:$,decimal:$,null:Dt,object:O,regexp:x,regex:x,string:v,undefined:S,function:t=>{throw new s("unsupported type key `function`.")},1:$,2:v,3:O,4:w,6:S,8:m,9:k,10:Dt,11:x,16:$,18:$,19:$};function Vt(t,e,n){const r=Gt[e];return!!r&&r(t)}function Qt(t,e,n){return P(t).some((t=>g(t)===g(e)&&n(t,e)))}const Wt=_t(It),Kt=_t(zt),Bt=_t(qt),Jt=_t(Ut),Xt=_t(Rt),Zt=_t(Nt);Object.freeze({R5:[10,16,25,40,63],R10:[100,125,160,200,250,315,400,500,630,800],R20:[100,112,125,140,160,180,200,224,250,280,315,355,400,450,500,560,630,710,800,900],R40:[100,106,112,118,125,132,140,150,160,170,180,190,200,212,224,236,250,265,280,300,315,355,375,400,425,450,475,500,530,560,600,630,670,710,750,800,850,900,950],R80:[103,109,115,122,128,136,145,155,165,175,185,195,206,218,230,243,258,272,290,307,325,345,365,387,412,437,462,487,515,545,575,615,650,690,730,775,825,875,925,975],"1-2-5":[10,20,50],E6:[10,15,22,33,47,68],E12:[10,12,15,18,22,27,33,39,47,56,68,82],E24:[10,11,12,13,15,16,18,20,22,24,27,30,33,36,39,43,47,51,56,62,68,75,82,91],E48:[100,105,110,115,121,127,133,140,147,154,162,169,178,187,196,205,215,226,237,249,261,274,287,301,316,332,348,365,383,402,422,442,464,487,511,536,562,590,619,649,681,715,750,787,825,866,909,953],E96:[100,102,105,107,110,113,115,118,121,124,127,130,133,137,140,143,147,150,154,158,162,165,169,174,178,182,187,191,196,200,205,210,215,221,226,232,237,243,249,255,261,267,274,280,287,294,301,309,316,324,332,340,348,357,365,374,383,392,402,412,422,432,442,453,464,475,487,499,511,523,536,549,562,576,590,604,619,634,649,665,681,698,715,732,750,768,787,806,825,845,866,887,909,931,953,976],E192:[100,101,102,104,105,106,107,109,110,111,113,114,115,117,118,120,121,123,124,126,127,129,130,132,133,135,137,138,140,142,143,145,147,149,150,152,154,156,158,160,162,164,165,167,169,172,174,176,178,180,182,184,187,189,191,193,196,198,200,203,205,208,210,213,215,218,221,223,226,229,232,234,237,240,243,246,249,252,255,258,261,264,267,271,274,277,280,284,287,291,294,298,301,305,309,312,316,320,324,328,332,336,340,344,348,352,357,361,365,370,374,379,383,388,392,397,402,407,412,417,422,427,432,437,442,448,453,459,464,470,475,481,487,493,499,505,511,517,523,530,536,542,549,556,562,569,576,583,590,597,604,612,619,626,634,642,649,657,665,673,681,690,698,706,715,723,732,741,750,759,768,777,787,796,806,816,825,835,845,856,866,876,887,898,909,920,931,942,953,965,976,988]}),new Set(["monday","mon","tuesday","tue","wednesday","wed","thursday","thu","friday","fri","saturday","sat","sunday","sun"]),Object.freeze({mon:1,tue:2,wed:3,thu:4,fri:5,sat:6,sun:7}),Object.freeze({"%Y":{name:"year",padding:4,re:/([0-9]{4})/},"%G":{name:"year",padding:4,re:/([0-9]{4})/},"%m":{name:"month",padding:2,re:/(0[1-9]|1[012])/},"%d":{name:"day",padding:2,re:/(0[1-9]|[12][0-9]|3[01])/},"%H":{name:"hour",padding:2,re:/([01][0-9]|2[0-3])/},"%M":{name:"minute",padding:2,re:/([0-5][0-9])/},"%S":{name:"second",padding:2,re:/([0-5][0-9]|60)/},"%L":{name:"millisecond",padding:3,re:/([0-9]{3})/},"%u":{name:"weekday",padding:1,re:/([1-7])/},"%U":{name:"week",padding:2,re:/([1-4][0-9]?|5[0-3]?)/},"%V":{name:"isoWeek",padding:2,re:/([1-4][0-9]?|5[0-3]?)/},"%z":{name:"timezone",padding:2,re:/(([+-][01][0-9]|2[0-3]):?([0-5][0-9])?)/},"%Z":{name:"minuteOffset",padding:3,re:/([+-][0-9]{3})/}}),Object.freeze({}),_t(Tt);const Ht=(t,e)=>(n,r,o)=>{y(w(r),`${t}: expression must be an array.`);const i=st(n,r,null,o);return i.some(S)?null:(y(i.every($),`${t}: expression must evalue to array of numbers.`),e(i))},Yt=(Ht("$bitAnd",(t=>t.reduce(((t,e)=>t&e),-1))),Ht("$bitOr",(t=>t.reduce(((t,e)=>t|e),0))),Ht("$bitXor",(t=>t.reduce(((t,e)=>t^e),0))),(t,e)=>{const n={};return t.split("").forEach(((t,r)=>n[t]=e*(r+1))),n});Yt("ABCDEFGHIKLM",1),Yt("NOPQRSTUVWXY",-1);const te={undefined:null,null:null,NaN:NaN,Infinity:new Error,"-Infinity":new Error};function ee(t,e=te){const n=Object.assign({},te,e),r=new Set(Object.keys(n));return(e,o,i)=>{const a=st(e,o,null,i);if(r.has(`${a}`)){const e=n[`${a}`];if(e instanceof Error)throw new s(`cannot apply $${t.name} to -inf, value must in (-inf,inf)`);return e}return t(a)}}ee(Math.acos,{Infinity:1/0,0:new Error}),ee(Math.acosh,{Infinity:1/0,0:new Error}),ee(Math.asin),ee(Math.asinh,{Infinity:1/0,"-Infinity":-1/0}),ee(Math.atan),ee(Math.atanh,{1:1/0,"-1":-1/0}),ee(Math.cos),ee(Math.cosh,{"-Infinity":1/0,Infinity:1/0});const ne=Math.PI/180,re=(ee((t=>t*ne),{Infinity:1/0,"-Infinity":1/0}),180/Math.PI);ee((t=>t*re),{Infinity:1/0,"-Infinity":-1/0}),ee(Math.sin),ee(Math.sinh,{"-Infinity":-1/0,Infinity:1/0}),ee(Math.tan),Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Error;const oe=(t,e,n,r)=>{const o=G(t,n),i=new At(e,r);y(w(o),"$elemMatch: argument must resolve to array");const s=[];for(let t=0;t<o.length;t++)if(i.test(o[t])){if(r.useStrictMode)return[o[t]];s.push(o[t])}return s.length>0?s:void 0},ie=(t,e,n,r)=>{const o=G(t,n),i=e;return w(o)?((t,e,n)=>{const r=st(t,e,null,n),o=r[0];let i=r[1],s=r[2];return S(s)?i<0?i=Math.max(0,o.length+i):(s=i,i=0):(i<0&&(i=Math.max(0,o.length+i)),y(s>0,"Invalid argument for $slice operator. Limit must be a positive number"),s+=i),o.slice(i,s)})(t,w(e)?[o,...i]:[o,e],r):o},se=Pt((function(t,e,n){if(!(w(t)&&w(e)&&t.length&&e.length))return!1;let r=!0;for(const o of e){if(!r)break;r=O(o)&&Object.keys(o).includes("$elemMatch")?Lt(t,o.$elemMatch,n):x(o)?t.some((t=>"string"==typeof t&&o.test(t))):t.some((t=>z(o,t)))}return r})),ae=Pt(Lt),ue=Pt((function(t,e,n){return Array.isArray(t)&&t.length===e})),ce=t=>Pt(((e,n,r)=>{let o=0;if(w(n))for(const t of n)o|=1<<t;else o=n;return t(e&o,o)})),le=ce(((t,e)=>0==t)),fe=ce(((t,e)=>t==e)),he=ce(((t,e)=>t<e)),pe=ce(((t,e)=>t>0)),de=Pt(It),ye=Pt(zt),be=Pt(qt),ge=Pt(Ct),me=Pt(Ut),ve=Pt(Rt),$e=Pt(Nt),we=Pt(Tt),Oe=(t,e,n)=>{const r=t.includes("."),o=!!e;return!r||t.match(/\.\d+$/)?e=>void 0!==G(e,t)===o:e=>{const n=G(V(e,t,{preserveIndex:!0}),t.substring(0,t.lastIndexOf(".")));return w(n)?n.some((t=>void 0!==t))===o:void 0!==n===o}},je=Pt((function(t,e,n){return w(e)?e.findIndex((e=>Vt(t,e)))>=0:Vt(t,e)}));function ke(t,e,n){return t=>st(t,e,null,n)}function xe(t,e,n){if(!n?.jsonSchemaValidator)throw new s("Missing option 'jsonSchemaValidator'. Configure to use '$jsonSchema' operator.");const r=n?.jsonSchemaValidator(e);return t=>r(t)}const Ee=Pt((function(t,e,n){return P(t).some((t=>2===e.length&&t%e[0]===e[1]))})),Se=Pt((function(t,e,n){const r=P(t),o=t=>v(t)&&M(e.exec(t),n?.useStrictMode);return r.some(o)||U(r,1).some(o)}));function Me(t,e,n){y(n.scriptEnabled,"$where operator requires 'scriptEnabled' option to be true");const r=e;return y(E(r),"$where only accepts a Function object"),t=>M(r.call(t),n?.useStrictMode)}const Ae=(t,e,n)=>{y(w(e),"Invalid expression: $and expects value to be an Array.");const r=e.map((t=>new At(t,n)));return t=>r.every((e=>e.test(t)))},Pe=(t,e,n)=>{y(w(e),"Invalid expression. $or expects value to be an Array");const r=e.map((t=>new At(t,n)));return t=>r.some((e=>e.test(t)))},_e=(t,e,n)=>{y(w(e),"Invalid expression. $nor expects value to be an array.");const r=Pe("$or",e,n);return t=>!r(t)},Ie=(t,e,n)=>{const r={};r[t]=H(e);const o=new At(r,n);return t=>!o.test(t)};ot("expression",{...e,...n}),ot("pipeline",{$project:$t,$skip:jt,$limit:vt,$sort:kt}),ot("projection",r),ot("query",o);const Ne={cloneMode:"copy",queryOptions:et({context:nt.init().addQueryOps(o).addExpressionOps(e).addExpressionOps(n)})},Ce=(t,e)=>{switch(t){case"deep":return I(e);case"copy":return k(e)?new Date(e):w(e)?[...e]:O(e)?{...e}:x(e)?new RegExp(e):e;default:return e}},Te=/^[a-z]+[a-zA-Z0-9]*$/;function Ue(t){if(!t.includes(".$"))return[{parent:t,selector:t},[]];const e=t.indexOf(".$"),n=t.indexOf("]"),r=t.substring(0,e),o=t.substring(e+3,n);y(""===o||Te.test(o),"The filter <identifier> must begin with a lowercase letter and contain only alphanumeric characters.");const i=t.substring(n+2),[s,a]=i?Ue(i):[];return[{selector:t,parent:r,child:o||"$",next:s},[o,...a||[]].filter(Boolean)]}const Re=(t,e,n,r,o)=>{const{parent:i,child:s,next:a}=e;if(!s){let e=!1;return K(t,i,((t,n)=>e=Boolean(r(t,n))||e),o),e}const u=G(t,i);return!!w(u)&&u.map(((t,e)=>!(n[s]&&!n[s].test({[s]:t}))&&(a?Re(t,a,n,r,o):r(u,e)))).some(Boolean)};function ze(t,e,n,r){const o=[];for(const[i,s]of Object.entries(t)){const[t,a]=Ue(i);if(a.length){const i={};e.forEach((t=>{Object.keys(t).forEach((e=>{a.forEach((n=>{(e===n||e.startsWith(n+"."))&&(i[n]=i[n]||{},Object.assign(i[n],{[e]:t[e]}))}))}))}));const u={};for(const[t,e]of Object.entries(i))u[t]=new At(e,n.queryOptions);r(s,t,u)&&o.push(t.parent)}else r(s,t,{})&&o.push(t.parent)}return o}const qe=(t,e,n=[],r=Ne)=>ze(e,n,r,((e,n,o)=>{const i={$each:[e]};return O(e)&&_(e,"$each")&&Object.assign(i,e),Re(t,n,o,((t,e)=>{const n=t[e]||=[];return T([n,i.$each]).length!==i.$each.length&&(t[e]=Ce(r.cloneMode,function(t,e=c){const n=d.init(e);return t.forEach((t=>n.set(t,!0))),Array.from(n.keys())}(n.concat(i.$each))),!0)}),{buildGraph:!0})})),Fe=new Set(["and","or","xor"]),Le=(t,e,n=[],r=Ne)=>ze(e,n,r,((e,n,r)=>{const o=Object.keys(e);return y(1===o.length&&Fe.has(o[0]),`Invalid bit operator '${o[0]}'. Must be one of 'and', 'or', or 'xor'.`),Re(t,n,r,((t,n)=>{let r=t[n];const i=e[o[0]];if(!(void 0===r||$(r)&&$(i)))return!1;switch(r=r||0,o[0]){case"and":t[n]=r&i;break;case"or":t[n]=r|i;break;case"xor":t[n]=r^i}return t[n]!==r}),{buildGraph:!0})})),De=(t,e,n=[],r=Ne)=>{const o=Date.now();return ze(e,n,r,((e,n,r)=>Re(t,n,r,((t,e)=>(t[e]=o,!0)),{buildGraph:!0})))},Ge=(t,e,n=[],r=Ne)=>ze(e,n,r,((e,n,r)=>{if(!n.child){const e=G(t,n.parent);y(void 0===e||$(e),"cannot apply $inc to a value of non-numeric type")}return Re(t,n,r,((t,n)=>(t[n]=(t[n]||=0)+e,!0)),{buildGraph:!0})})),Ve=(t,e,n=[],r=Ne)=>ze(e,n,r,((e,n,r)=>Re(t,n,r,((t,n)=>!(void 0!==t[n]&&p(t[n],e)>-1||(t[n]=e,0))),{buildGraph:!0}))),Qe=(t,e,n=[],r=Ne)=>ze(e,n,r,((e,n,r)=>Re(t,n,r,((t,n)=>!(void 0!==t[n]&&p(t[n],e)<1||(t[n]=e,0))),{buildGraph:!0}))),We=(t,e,n=[],r=Ne)=>ze(e,n,r,((e,n,r)=>Re(t,n,r,((t,n)=>{const r=t[n];return t[n]=void 0===t[n]?0:t[n]*e,t[n]!==r}),{buildGraph:!0}))),Ke=(t,e,n=[],r=Ne)=>ze(e,n,r,((e,n,r)=>Re(t,n,r,((t,r)=>{const o=t[r];return y(w(o),`path '${n.selector}' contains an element of non-array type.`),!!o.length&&(-1===e?o.splice(0,1):o.pop(),!0)})))),Be=(t,e,n=[],r=Ne)=>ze(e,n,r,((e,n,o)=>{const i=!O(e)||Object.keys(e).some(Z),s=new At(i?{k:e}:e,r.queryOptions),a=i?t=>s.test({k:t}):t=>s.test(t);return Re(t,n,o,((t,e)=>{const n=t[e],r=new Array;return!!n.map((t=>{const e=a(t);return e||r.push(t),e})).some(Boolean)&&(t[e]=r,!0)}))})),Je=(t,e,n=[],r=Ne)=>{const o={};return Object.entries(e).forEach((([t,e])=>{o[t]={$in:e}})),Be(t,o,n,r)},Xe=Object.freeze(["$each","$slice","$sort","$position"]),Ze=(t,e,n=[],r=Ne)=>ze(e,n,r,((e,n,o)=>{const i={$each:[e]};return O(e)&&Xe.some((t=>_(e,t)))&&Object.assign(i,e),Re(t,n,o,((t,e)=>{const n=t[e]||=[],o=n.slice(0,i.$slice||n.length),s=n.length,a=$(i.$position)?i.$position:n.length;if(n.splice(a,0,...Ce(r.cloneMode,i.$each)),i.$sort){const t=O(i.$sort)?Object.keys(i.$sort||{}).pop():"",e=t?i.$sort[t]:i.$sort,r=t?e=>G(e,t):t=>t;n.sort(((t,n)=>e*p(r(t),r(n))))}return $(i.$slice)&&(i.$slice<0?n.splice(0,n.length+i.$slice):n.splice(i.$slice)),s!=n.length||!z(o,n)}),{descendArray:!0,buildGraph:!0})})),He=(t,e,n=[],r=Ne)=>ze(e,n,r,((e,n,o)=>Re(t,n,o,((t,n)=>!z(t[n],e)&&(t[n]=Ce(r.cloneMode,e),!0)),{buildGraph:!0}))),Ye=(t,e,n=[],r=Ne)=>{const o=[],i=ze(e,n,r,((e,i,s)=>Re(t,i,s,((i,s)=>!!_(i,s)&&(o.push(...He(t,{[e]:i[s]},n,r)),delete i[s],!0)))));return Array.from(new Set(i.concat(o)))},tn=(t,e,n=[],r=Ne)=>ze(e,n,r,((e,n,r)=>Re(t,n,r,((t,e)=>!!_(t,e)&&(w(t)?t[e]=null:delete t[e],!0)))));var en;en=en??Ne;var nn=At;function rn(t){return rn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rn(t)}function on(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,sn(r.key),r)}}function sn(t){var e=function(t){if("object"!=rn(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=rn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==rn(e)?e:e+""}var an=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._expression={},this.change(e)},(e=[{key:"expression",get:function(){return this._expression}},{key:"change",value:function(t){if("object"!==rn(t)||null===t)throw new Error("Expressions can only be objects!");this._expression=t}},{key:"check",value:function(t){var e=!1;try{e=new nn(this._expression).test(t.keys)}catch(t){console.warn("Expression check failed:",t),e=!1}return e}}])&&on(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function un(t){return un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},un(t)}function cn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ln(r.key),r)}}function ln(t){var e=function(t){if("object"!=un(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=un(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==un(e)?e:e+""}var fn=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._values={}},e=[{key:"keys",get:function(){return this._values}},{key:"set",value:function(t,e){this._values[t]=e}},{key:"get",value:function(t){var e=null;return this.exists(t)&&(e=this._values[t]),e}},{key:"delete",value:function(t){var e=null;return this.exists(t)&&(e=this.get(t),delete this._values[t]),e}},{key:"exists",value:function(t){var e,n,r;return new nn((e={},r={$exists:!0},(n=ln(n=t))in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e)).test(this._values)}},{key:"size",value:function(){return Object.keys(this._values).length}}],e&&cn(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function hn(t){return hn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hn(t)}function pn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,dn(r.key),r)}}function dn(t){var e=function(t){if("object"!=hn(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=hn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==hn(e)?e:e+""}var yn=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._set=[]},e=[{key:"add",value:function(t){if("object"!==hn(t)||null===t)throw new Error("Qualities must be objects!");if(!this.has(t)){var e=new an(t);this._set.push(e)}}},{key:"has",value:function(t){if("object"===hn(t)&&null!==t)return this._set.some((function(e){return JSON.stringify(e.expression)===JSON.stringify(t)}));throw new Error("Can only check object values!")}},{key:"remove",value:function(t){if("object"!==hn(t)||null===t)throw new Error("Must pass object values to remove!");this._set=this._set.filter((function(e){return JSON.stringify(e.expression)!==JSON.stringify(t)}))}},{key:"check",value:function(t){if(t instanceof fn)return this._set.every((function(e){return e.check(t)}));throw new Error("Must have State to check() against!")}},{key:"size",value:function(){return this._set.length}}],e&&pn(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();const bn={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let gn;const mn=new Uint8Array(16),vn=[];for(let t=0;t<256;++t)vn.push((t+256).toString(16).slice(1));const $n=function(t,e,n){if(bn.randomUUID&&!e&&!t)return bn.randomUUID();const r=(t=t||{}).random??t.rng?.()??function(){if(!gn){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");gn=crypto.getRandomValues.bind(crypto)}return gn(mn)}();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,e){if((n=n||0)<0||n+16>e.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let t=0;t<16;++t)e[n+t]=r[t];return e}return function(t,e=0){return(vn[t[e+0]]+vn[t[e+1]]+vn[t[e+2]]+vn[t[e+3]]+"-"+vn[t[e+4]]+vn[t[e+5]]+"-"+vn[t[e+6]]+vn[t[e+7]]+"-"+vn[t[e+8]]+vn[t[e+9]]+"-"+vn[t[e+10]]+vn[t[e+11]]+vn[t[e+12]]+vn[t[e+13]]+vn[t[e+14]]+vn[t[e+15]]).toLowerCase()}(r)};function wn(t){return wn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wn(t)}function On(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,jn(r.key),r)}}function jn(t){var e=function(t){if("object"!=wn(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=wn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==wn(e)?e:e+""}var kn=function(){return t=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.content=e,this.qualities=n,this._hash=$n()},(e=[{key:"content",get:function(){return this._content},set:function(t){if("string"!=typeof t)throw new Error("Content must be expressed as a string!");this._content=t}},{key:"qualities",get:function(){return this._qualities},set:function(t){var e=this;if(!Array.isArray(t))throw new Error("Qualities must be expressed as an array!");this._qualities=new yn(this.state),t.forEach((function(t){return e.addQuality(t)}))}},{key:"hash",get:function(){return this._hash}},{key:"isAvailable",value:function(t){if(t instanceof fn)return this._qualities.check(t);throw new Error("Must be passed State to check if available")}},{key:"addQuality",value:function(t){this._qualities.add(t)}},{key:"removeQuality",value:function(t){this._qualities.remove(t)}}])&&On(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function xn(t){return xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xn(t)}function En(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Sn(r.key),r)}}function Sn(t){var e=function(t){if("object"!=xn(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=xn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==xn(e)?e:e+""}var Mn=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cards=[],this._state=new fn},e=[{key:"state",get:function(){return this._state},set:function(t){if(!(t instanceof fn))throw new Error("Passed value is not an instance of State");this._state=t}},{key:"getCard",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,e=null;return t>=0&&t<this.cards.length&&(e=this.cards[t]),e}},{key:"updateCard",value:function(t){if(!(t instanceof kn))throw new Error("Updated card must be Card!");this.cards.forEach((function(e){e.hash===t.hash&&(e=t)}))}},{key:"size",value:function(){return this.cards.length}},{key:"addCard",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if("string"!=typeof t)throw new Error("Card content must be string!");if(!Array.isArray(e))throw new Error("Qualities must be passed as array!");var n=new kn(t,e);this.cards.push(n)}},{key:"removeCard",value:function(t){this.cards=this.cards.filter((function(e){return e!==t}))}},{key:"shuffle",value:function(){for(var t=this.cards.length-1;t>0;t--){var e=Math.floor(Math.random()*(t+1)),n=[this.cards[e],this.cards[t]];this.cards[t]=n[0],this.cards[e]=n[1]}}},{key:"draw",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=[];return e>0&&(n=(n=this.cards.filter((function(e){return e.isAvailable(t.state)}))).slice(0,e)),n}}],e&&En(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();window.Card=kn,window.Deck=Mn,window.Expression=an,window.QualitySet=yn,window.State=fn})();