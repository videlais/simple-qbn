(()=>{"use strict";var e={8221:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Aggregator=void 0;var n=r(7424),o=r(1088),i=r(6588),u=function(){function e(e,t){this.__pipeline=e,this.__options=n.makeOptions(t)}return e.prototype.stream=function(e){var t=o.Lazy(e);if(!i.isEmpty(this.__pipeline))for(var r=0,u=this.__pipeline;r<u.length;r++){var a=u[r],s=Object.keys(a),c=s[0],l=n.getOperator(n.OperatorType.PIPELINE,c);i.assert(1===s.length&&!!l,"invalid aggregation operator "+c),t=l(t,a[c],this.__options)}return t},e.prototype.run=function(e){return this.stream(e).value()},e}();t.Aggregator=u},7424:(e,t,r)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.redact=t.computeValue=t.addOperators=t.getOperator=t.useOperators=t.OperatorType=t.makeOptions=void 0;var o,i=r(6588);function u(e){return Object.assign({idKey:"_id"},e||{})}t.makeOptions=u,function(e){e.ACCUMULATOR="accumulator",e.EXPRESSION="expression",e.PIPELINE="pipeline",e.PROJECTION="projection",e.QUERY="query"}(o=t.OperatorType||(t.OperatorType={}));var a=((n={})[o.ACCUMULATOR]={},n[o.EXPRESSION]={},n[o.PIPELINE]={},n[o.PROJECTION]={},n[o.QUERY]={},n);function s(e){for(var t=0,r=Object.entries(e);t<r.length;t++){var n=r[t],o=n[0],u=n[1];i.assert(u instanceof Function&&i.isOperator(o),"invalid operator specified")}}function c(e,t){s(t),i.into(a[e],t)}function l(e,t){return i.has(a[e],t)?a[e][t]:null}t.useOperators=c,t.getOperator=l,t.addOperators=function(e,t){var r=t({computeValue:v,resolve:i.resolve});s(r);for(var n=0,u=Object.entries(r);n<u.length;n++){var a=u[n],f=a[0],p=(a[1],l(e,f));i.assert(!p,f+" already exists for '"+e+"' operators")}var h={};switch(e){case o.QUERY:for(var y=function(e,t){var n=t.bind(r);h[e]=function(e,t,r){return function(o){var u=i.resolve(o,e,{unwrapArray:!0});return n(e,u,t,r)}}},d=0,_=Object.entries(r);d<_.length;d++){var g=_[d];y(f=g[0],g[1])}break;case o.PROJECTION:for(var b=function(e,t){var n=t.bind(r);h[e]=function(e,t,r,o){var u=i.resolve(e,r);return n(r,u,t,o)}},O=0,m=Object.entries(r);O<m.length;O++){var $=m[O];b(f=$[0],$[1])}break;default:for(var j=function(e,t){h[e]=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.apply(r,e)}},E=0,A=Object.entries(r);E<A.length;E++){var w=A[E];j(f=w[0],w[1])}}c(e,h)};var f={$$ROOT:function(e,t,r){return r.root},$$CURRENT:function(e,t,r){return e},$$REMOVE:function(e,t,r){}},p={$$KEEP:function(e,t,r){return e},$$PRUNE:function(e,t,r){},$$DESCEND:function(e,t,r){if(!i.has(t,"$cond"))return e;for(var n,o=i.cloneDeep(e),u=0,a=Object.entries(o);u<a.length;u++){var s=a[u],c=s[0],l=s[1];if(i.isObjectLike(l)){if(l instanceof Array){for(var f=[],p=0,v=l;p<v.length;p++){var y=v[p];i.isObject(y)&&(y=h(y,t,r)),i.isNil(y)||f.push(y)}n=f}else n=h(l,t,r);i.isNil(n)?delete o[c]:o[c]=n}}return o}};function v(e,t,r,n){if(n=n||u(),i.isOperator(r)){var s=l(o.EXPRESSION,r);if(s)return s(e,t,n);if(s=l(o.ACCUMULATOR,r))return e instanceof Array||(e=v(e,t,null,n),t=null),i.assert(e instanceof Array,"'"+r+"' target must be an array."),s(e,t,n);throw new Error("operator '"+r+"' is not registered")}if(i.isString(t)&&t.length>0&&"$"===t[0]){if(i.has(p,t))return t;var c=t.split(".");if(i.has(f,c[0])){if(e=f[c[0]](e,null,i.into({root:e},n)),1==c.length)return e;t=t.substr(c[0].length)}return i.resolve(e,t.slice(1))}if(t instanceof Array)return t.map((function(t){return v(e,t,null,n)}));if(i.isObject(t)){for(var h={},y=function(r,u){if(h[r]=v(e,u,r,n),[o.EXPRESSION,o.ACCUMULATOR].some((function(e){return i.has(a[e],r)})))return i.assert(1===Object.keys(t).length,"Invalid aggregation expression '"+JSON.stringify(t)+"'"),{value:h[r]}},d=0,_=Object.entries(t);d<_.length;d++){var g=_[d],b=y(g[0],g[1]);if("object"==typeof b)return b.value}return h}return t}function h(e,t,r){var n=v(e,t,null,r);return i.has(p,n)?p[n](e,t,i.into({root:e},r)):n}t.computeValue=v,t.redact=h},9537:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Cursor=void 0;var n=r(8221),o=r(1088),i=r(6588),u=function(){function e(e,t,r,n){this.__predicateFn=t,this.__source=e,this.__projection=r,this.__operators=[],this.__result=null,this.__stack=[],this.__options=n}return e.prototype._fetch=function(){return this.__result||(i.isObject(this.__projection)&&this.__operators.push({$project:this.__projection}),this.__result=o.Lazy(this.__source).filter(this.__predicateFn),this.__operators.length>0&&(this.__result=new n.Aggregator(this.__operators,this.__options).stream(this.__result))),this.__result},e.prototype.all=function(){return this._fetch().value()},e.prototype.count=function(){return this.all().length},e.prototype.skip=function(e){return this.__operators.push({$skip:e}),this},e.prototype.limit=function(e){return this.__operators.push({$limit:e}),this},e.prototype.sort=function(e){return this.__operators.push({$sort:e}),this},e.prototype.collation=function(e){return i.into(this.__options,{collation:e}),this},e.prototype.next=function(){if(this.__stack){if(this.__stack.length>0)return this.__stack.pop();var e=this._fetch().next();if(!e.done)return e.value;this.__stack=null}},e.prototype.hasNext=function(){if(!this.__stack)return!1;if(this.__stack.length>0)return!0;var e=this._fetch().next();return e.done?this.__stack=null:this.__stack.push(e.value),!!this.__stack},e.prototype.map=function(e){return this._fetch().map(e).value()},e.prototype.forEach=function(e){this._fetch().each(e)},e}();t.Cursor=u,"function"==typeof Symbol&&(u.prototype[Symbol.iterator]=function(){return this._fetch()})},4406:(e,t,r)=>{t.AE=void 0,r(7532);var n=r(8221),o=r(7732),i=(r(8221),r(7732));Object.defineProperty(t,"AE",{enumerable:!0,get:function(){return i.Query}}),n.Aggregator,o.Query},7532:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=r(7424),o=r(5039),i=r(4543),u=r(1091),a=r(7086),s=r(581),c=r(6588);n.useOperators(n.OperatorType.EXPRESSION,c.into({},o,i)),n.useOperators(n.OperatorType.PIPELINE,{$project:u.$project,$skip:u.$skip,$limit:u.$limit,$sort:u.$sort}),n.useOperators(n.OperatorType.PROJECTION,a),n.useOperators(n.OperatorType.QUERY,s)},1088:(e,t)=>{function r(e){return e instanceof u?e:new u(e)}function n(e,t){var r=e.slice(t+1);e.splice(t),Array.prototype.push.apply(e,r)}Object.defineProperty(t,"__esModule",{value:!0}),t.Iterator=t.Lazy=void 0,t.Lazy=r;var o,i=new Error;!function(e){e[e.MAP=0]="MAP",e[e.FILTER=1]="FILTER",e[e.TAKE=2]="TAKE",e[e.DROP=3]="DROP"}(o||(o={}));var u=function(){function e(e){var t,r,u,a,s,c,l,f,p;if(this.__iteratees=[],this.__first=!1,this.__done=!1,this.__buf=[],e instanceof Function&&(e={next:e}),(r=e)&&"object"==typeof r&&(null===(u=r)||void 0===u?void 0:u.next)instanceof Function){var v=e;t=function(){var e=v.next();if(e.done)throw i;return e.value}}else if(e instanceof Array){var h=e,y=h.length,d=0;t=function(){if(d<y)return h[d++];throw i}}else if(!(e instanceof Function))throw new Error("Source is not iterable. Must be Array, Function, or Generator");this.__next=(a=t,s=this.__iteratees,c=this.__buf,l=!1,f=-1,p=0,function(e){try{e:for(;!l;){var t=a();f++;for(var r=-1,u=s.length,v=!1;++r<u;){var h=s[r];switch(h.action){case o.MAP:t=h.func(t,f);break;case o.FILTER:if(!h.func(t,f))continue e;break;case o.TAKE:--h.count,h.count||(v=!0);break;case o.DROP:--h.count,h.count||n(s,r);continue e;default:break e}}if(l=v,!e)return{value:t,done:!1};c[p++]=t}}catch(e){if(e!==i)throw e}return{done:l=!0}})}return e.prototype._validate=function(){if(this.__first)throw new Error("Cannot add iteratee/transform after `first()`")},e.prototype._push=function(e,t){if(this._validate(),"function"==typeof t)this.__iteratees.push({action:e,func:t});else{if("number"!=typeof t)throw Error("invalid value");this.__iteratees.push({action:e,count:t})}return this},e.prototype.next=function(){return this.__next()},e.prototype.map=function(e){return this._push(o.MAP,e)},e.prototype.filter=function(e){return this._push(o.FILTER,e)},e.prototype.take=function(e){return e>0?this._push(o.TAKE,e):this},e.prototype.drop=function(e){return e>0?this._push(o.DROP,e):this},e.prototype.transform=function(e){this._validate();var t,n=this;return r((function(){return t||(t=r(e(n.value()))),t.next()}))},e.prototype.first=function(){return this.take(1),this.__first=!0,this},e.prototype.value=function(){return this.__done||(this.__done=this.__next(!0).done),this.__first?this.__buf[0]:this.__buf},e.prototype.each=function(e){for(;;){var t=this.next();if(t.done)break;if(!1===e(t.value))return!1}return!0},e.prototype.reduce=function(e,t){var r=this.next(),n=0;for(void 0!==t||r.done||(t=r.value,r=this.next(),n++);!r.done;)t=e(t,r.value,n++),r=this.next();return t},e.prototype.size=function(){return this.reduce((function(e,t){return++e}),0)},e}();t.Iterator=u,"function"==typeof Symbol&&(u.prototype[Symbol.iterator]=function(){return this})},2344:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$type=t.$elemMatch=t.$size=t.$all=t.$exists=t.$regex=t.$mod=t.$gte=t.$gt=t.$lte=t.$lt=t.$nin=t.$in=t.$ne=t.$eq=t.createExpressionOperator=t.createQueryOperator=void 0;var n=r(7424),o=r(7732),i=r(6588);function u(e,t,r){if(i.isEqual(e,t))return!0;if(i.isNil(e)&&i.isNil(t))return!0;if(e instanceof Array){var n=i.isEqual.bind(null,t);return e.some(n)||i.flatten(e,1).some(n)}return!1}function a(e,t,r){return i.isNil(e)?t.some(i.isNull):i.intersection(i.ensureArray(e),t,null==r?void 0:r.hashFunction).length>0}function s(e){return i.isOperator(e)&&-1===["$and","$or","$nor"].indexOf(e)}function c(e,t,r){if(i.isArray(e)&&!i.isEmpty(e)){var n=function(e){return e},u=t;Object.keys(t).every(s)&&(u={temp:t},n=function(e){return{temp:e}});for(var a=new o.Query(u,r),c=0,l=e.length;c<l;c++)if(a.test(n(e[c])))return!0}return!1}function l(e,t,r){return i.ensureArray(e).some((function(e){return i.getType(e)===i.getType(t)&&r(e,t)}))}t.createQueryOperator=function(e){return function(t,r,n){var o={unwrapArray:!0};return function(u){var a=i.resolve(u,t,o);return e(a,r,n)}}},t.createExpressionOperator=function(e){return function(t,r,o){var i=n.computeValue(t,r,null,o);return e.apply(void 0,i)}},t.$eq=u,t.$ne=function(e,t,r){return!u(e,t)},t.$in=a,t.$nin=function(e,t,r){return!a(e,t,r)},t.$lt=function(e,t,r){return l(e,t,(function(e,t){return e<t}))},t.$lte=function(e,t,r){return l(e,t,(function(e,t){return e<=t}))},t.$gt=function(e,t,r){return l(e,t,(function(e,t){return e>t}))},t.$gte=function(e,t,r){return l(e,t,(function(e,t){return e>=t}))},t.$mod=function(e,t,r){return i.ensureArray(e).some((function(e){return 2===t.length&&e%t[0]===t[1]}))},t.$regex=function(e,t,r){var n=i.ensureArray(e),o=function(e){return i.isString(e)&&!!t.exec(e)};return n.some(o)||i.flatten(n,1).some(o)},t.$exists=function(e,t,r){return(!1===t||0===t)&&void 0===e||(!0===t||1===t)&&void 0!==e},t.$all=function(e,t,r){var n=!1;if(i.isArray(e)&&i.isArray(t))for(var o=0,u=t.length;o<u;o++){if(!i.isObject(t[o])||!i.inArray(Object.keys(t[o]),"$elemMatch"))return i.intersection(t,e,null==r?void 0:r.hashFunction).length===u;n=n||c(e,t[o].$elemMatch,r)}return n},t.$size=function(e,t,r){return e.length===t},t.$elemMatch=c,t.$type=function(e,t,r){switch(t){case 1:case 19:case i.BsonType.DOUBLE:case i.BsonType.DECIMAL:return i.isNumber(e);case 2:case i.JsType.STRING:return i.isString(e);case 3:case i.JsType.OBJECT:return i.isObject(e);case 4:case i.JsType.ARRAY:return i.isArray(e);case 6:case i.JsType.UNDEFINED:return i.isNil(e);case 8:case i.JsType.BOOLEAN:case i.BsonType.BOOL:return i.isBoolean(e);case 9:case i.JsType.DATE:return i.isDate(e);case 10:case i.JsType.NULL:return i.isNull(e);case 11:case i.JsType.REGEXP:case i.BsonType.REGEX:return i.isRegExp(e);case 16:case i.BsonType.INT:return i.isNumber(e)&&e>=i.MIN_INT&&e<=i.MAX_INT&&-1===e.toString().indexOf(".");case 18:case i.BsonType.LONG:return i.isNumber(e)&&e>=i.MIN_LONG&&e<=i.MAX_LONG&&-1===e.toString().indexOf(".");default:return!1}}},78:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$slice=void 0;var n=r(7424),o=r(6588);t.$slice=function(e,t,r){var i=n.computeValue(e,t,null,r),u=i[0],a=i[1],s=i[2];return o.isNil(s)?a<0?(a=Math.max(0,u.length+a),s=u.length-a+1):(s=a,a=0):(a<0&&(a=Math.max(0,u.length+a)),o.assert(s>0,"Invalid argument for $slice operator. Limit must be a positive number"),s+=a),u.slice(a,s)}},510:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$and=void 0;var n=r(7424),o=r(6588);t.$and=function(e,t,r){var i=n.computeValue(e,t,null,r);return o.truthy(i)&&i.every(o.truthy)}},5039:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(510),t),o(r(7846),t),o(r(7405),t)},7846:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$not=void 0;var n=r(7424),o=r(6588);t.$not=function(e,t,r){var i=o.ensureArray(t);if(0==i.length)return!1;if(1==i.length)return!n.computeValue(e,i[0],null,r);throw"Expression $not takes exactly 1 argument"}},7405:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$or=void 0;var n=r(7424),o=r(6588);t.$or=function(e,t,r){var i=n.computeValue(e,t,null,r);return o.truthy(i)&&i.some(o.truthy)}},4543:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$cmp=t.$ne=t.$lte=t.$lt=t.$gte=t.$gt=t.$eq=void 0;var n=r(7424),o=r(2344);t.$eq=o.createExpressionOperator(o.$eq),t.$gt=o.createExpressionOperator(o.$gt),t.$gte=o.createExpressionOperator(o.$gte),t.$lt=o.createExpressionOperator(o.$lt),t.$lte=o.createExpressionOperator(o.$lte),t.$ne=o.createExpressionOperator(o.$ne),t.$cmp=function(e,t,r){var o=n.computeValue(e,t,null,r);return o[0]>o[1]?1:o[0]<o[1]?-1:0}},5292:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$addFields=void 0;var n=r(7424),o=r(6588);t.$addFields=function(e,t,r){var i=Object.keys(t);return 0===i.length?e:e.map((function(e){for(var u=o.cloneDeep(e),a=0,s=i;a<s.length;a++){var c=s[a],l=n.computeValue(e,t[c],null,r);void 0!==l?o.setValue(u,c,l):o.removeValue(u,c)}return u}))}},624:function(e,t,r){var n=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],u=0,a=i.length;u<a;u++,o++)n[o]=i[u];return n};Object.defineProperty(t,"__esModule",{value:!0}),t.$bucket=void 0;var o=r(7424),i=r(1088),u=r(6588);t.$bucket=function(e,t,r){var a=n(t.boundaries),s=t.default,c=a[0],l=a[a.length-1],f=t.output||{count:{$sum:1}};u.assert(t.boundaries.length>2,"$bucket 'boundaries' expression must have at least 3 elements");for(var p=u.getType(c),v=0,h=a.length-1;v<h;v++)u.assert(p===u.getType(a[v+1]),"$bucket 'boundaries' must all be of the same type"),u.assert(a[v]<a[v+1],"$bucket 'boundaries' must be sorted in ascending order");!u.isNil(s)&&u.getType(t.default)===u.getType(c)&&u.assert(t.default>=l||t.default<c,"$bucket 'default' expression must be out of boundaries range");for(var y={},d=0,_=a;d<_.length;d++){var g=_[d];y[g]=[]}u.isNil(s)||(y[s]=[]);var b=null;return i.Lazy((function(){return null===b&&(e.each((function(e){var n=o.computeValue(e,t.groupBy,null,r);if(u.isNil(n)||n<c||n>=l)u.assert(!u.isNil(s),"$bucket require a default for out of range values"),y[s].push(e);else{u.assert(n>=c&&n<l,"$bucket 'groupBy' expression must resolve to a value in range of boundaries");var i=function(e,t){for(var r=0,n=e.length-1;r<=n;){var o=Math.round(r+(n-r)/2);if(t<e[o])n=o-1;else{if(!(t>e[o]))return o;r=o+1}}return r}(a,n),f=a[Math.max(0,i-1)];y[f].push(e)}})),a.pop(),u.isNil(s)||a.push(s),b=i.Lazy(a).map((function(e){var t=o.computeValue(y[e],f,null,r);return u.into(t,{_id:e})}))),b.next()}))}},4943:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$bucketAuto=void 0;var n=r(7424),o=r(6588);t.$bucketAuto=function(e,t,r){var i=t.output||{count:{$sum:1}},u=t.groupBy,a=t.buckets;return o.assert(a>0,"The $bucketAuto 'buckets' field must be greater than 0, but found: "+a),e.transform((function(e){for(var t=Math.max(1,Math.round(e.length/a)),s=o.memoize(n.computeValue,null==r?void 0:r.hashFunction),c={},l=[],f=o.sortBy(e,(function(e){var t=s(e,u,null,r);return o.isNil(t)?l.push(e):(c[t]||(c[t]=[]),c[t].push(e)),t})),p=[],v=0,h=0,y=f.length;h<a&&v<y;h++){for(var d={},_=[],g=0;g<t&&v<y;g++){var b=s(f[v],u,null,r);o.isNil(b)&&(b=null),o.into(_,o.isNil(b)?l:c[b]),v+=o.isNil(b)?l.length:c[b].length,o.has(d,"min")||(d.min=b),p.length>0&&(p[p.length-1]._id.max=d.min)}h==a-1&&o.into(_,f.slice(v));var O=n.computeValue(_,i,null,r);p.push(o.into(O,{_id:d}))}return p.length>0&&(p[p.length-1]._id.max=s(f[f.length-1],u,null,r)),p}))}},1688:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$count=void 0;var n=r(1088),o=r(6588);t.$count=function(e,t,r){return o.assert(o.isString(t)&&""!==t.trim()&&-1===t.indexOf(".")&&"$"!==t.trim()[0],"Invalid expression value for $count"),n.Lazy((function(){var r={};return r[t]=e.size(),{value:r,done:!1}})).first()}},1129:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$facet=void 0;var n=r(8221),o=r(6588);t.$facet=function(e,t,r){return e.transform((function(e){return[o.objectMap(t,(function(t){return new n.Aggregator(t,r).run(e)}))]}))}},4285:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$group=void 0;var n=r(7424),o=r(6588);t.$group=function(e,t,r){var i=t._id;return e.transform((function(e){var u=o.groupBy(e,(function(e){return n.computeValue(e,i,null,r)}),null==r?void 0:r.hashFunction);delete(t=o.into({},t))._id;var a=-1,s=u.keys.length;return function(){if(++a===s)return{done:!0};var e=u.keys[a],o={};void 0!==e&&(o._id=e);for(var i=0,c=Object.entries(t);i<c.length;i++){var l=c[i],f=l[0],p=l[1];o[f]=n.computeValue(u.groups[a],p,f,r)}return{value:o,done:!1}}}))}},1091:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(5292),t),o(r(624),t),o(r(4943),t),o(r(1688),t),o(r(1129),t),o(r(4285),t),o(r(854),t),o(r(7672),t),o(r(7533),t),o(r(2250),t),o(r(8203),t),o(r(1229),t),o(r(9251),t),o(r(3042),t),o(r(6486),t),o(r(5702),t),o(r(7642),t),o(r(3469),t),o(r(8734),t),o(r(49),t),o(r(8105),t)},854:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$limit=void 0,t.$limit=function(e,t,r){return e.take(t)}},7672:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$lookup=void 0;var n=r(6588);t.$lookup=function(e,t,r){var o=n.isString(t.from)?null==r?void 0:r.collectionResolver(t.from):t.from;n.assert(o instanceof Array,"'from' field must resolve to an array");for(var i={},u=0,a=o;u<a.length;u++){var s=a[u],c=n.hashCode(n.resolve(s,t.foreignField),null==r?void 0:r.hashFunction);i[c]=i[c]||[],i[c].push(s)}return e.map((function(e){var o=n.hashCode(n.resolve(e,t.localField),null==r?void 0:r.hashFunction),u=n.into({},e);return u[t.as]=i[o]||[],u}))}},7533:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$match=void 0;var n=r(7732);t.$match=function(e,t,r){var o=new n.Query(t,r);return e.filter((function(e){return o.test(e)}))}},2250:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$out=void 0;var n=r(6588);t.$out=function(e,t,r){var o=n.isString(t)?null==r?void 0:r.collectionResolver(t):t;return n.assert(o instanceof Array,"expression must resolve to an array"),e.map((function(e){return o.push(e),e}))}},8203:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$project=void 0;var n=r(7424),o=r(6588);function i(e,t,r,a,s){var c={},l=!1,f=!1,p=[];s&&p.push(r.idKey);for(var v=function(a){var s=void 0,v=t[a];if(a!==r.idKey&&o.inArray([0,!1],v)&&(f=!0),a===r.idKey&&o.isEmpty(v))s=e[a];else if(o.isString(v))s=n.computeValue(e,v,a,r);else if(o.inArray([1,!0],v));else if(v instanceof Array)s=v.map((function(t){var i=n.computeValue(e,t,null,r);return o.isNil(i)?null:i}));else{if(!o.isObject(v))return p.push(a),"continue";var h=v,y=Object.keys(v),d=1==y.length?y[0]:null,_=n.getOperator(n.OperatorType.PROJECTION,d);if(_)"$slice"===d?o.ensureArray(h[d]).every(o.isNumber)?(s=_(e,h[d],a),l=!0):s=n.computeValue(e,h,a,r):s=_(e,h[d],a,r);else if(o.isOperator(d))s=n.computeValue(e,h[d],d,r);else if(o.has(e,a)){u(h,r);var g=e[a];s=g instanceof Array?g.map((function(e){return i(e,h,r,y,!1)})):i(g=o.isObject(g)?g:e,h,r,y,!1)}else s=n.computeValue(e,v,null,r)}var b=o.resolveGraph(e,a,{preserveMissing:!0});void 0!==b&&o.merge(c,b,{flatten:!0}),o.notInArray([0,1,!1,!0],v)&&(void 0===s?o.removeValue(c,a):o.setValue(c,a,s))},h=0,y=a;h<y.length;h++)v(y[h]);if(o.filterMissing(c),(l||f||s)&&(c=o.into({},e,c),p.length>0)){c=o.cloneDeep(c);for(var d=0,_=p;d<_.length;d++){var g=_[d];o.removeValue(c,g)}}return c}function u(e,t){for(var r=[!1,!1],n=0,i=Object.entries(e);n<i.length;n++){var u=i[n],a=u[0],s=u[1];if(a===t.idKey)return;0===s||!1===s?r[0]=!0:1!==s&&!0!==s||(r[1]=!0),o.assert(!(r[0]&&r[1]),"Projection cannot have a mix of inclusion and exclusion.")}}t.$project=function(e,t,r){if(o.isEmpty(t))return e;var n=Object.keys(t),a=!1;u(t,r);var s=r.idKey;if(o.inArray(n,s)){var c=t[s];0!==c&&!1!==c||(n=n.filter(o.notInArray.bind(null,[s])),a=0==n.length)}else n.push(s);return e.map((function(e){return i(e,t,r,n,a)}))}},1229:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$redact=void 0;var n=r(7424),o=r(6588);t.$redact=function(e,t,r){return e.map((function(e){return n.redact(o.cloneDeep(e),t,r)}))}},9251:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$replaceRoot=void 0;var n=r(7424),o=r(6588);t.$replaceRoot=function(e,t,r){return e.map((function(e){return e=n.computeValue(e,t.newRoot,null,r),o.assert(o.isObject(e),"$replaceRoot expression must return an object"),e}))}},3042:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$replaceWith=void 0;var n=r(9251);t.$replaceWith=n.$replaceRoot},6486:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$sample=void 0,t.$sample=function(e,t,r){return e.transform((function(e){var r=e.length,n=-1;return function(){if(++n===t.size)return{done:!0};var o=Math.floor(Math.random()*r);return{value:e[o],done:!1}}}))}},5702:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$set=void 0;var n=r(5292);t.$set=n.$addFields},7642:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$skip=void 0,t.$skip=function(e,t,r){return e.drop(t)}},3469:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$sort=void 0;var n=r(6588);t.$sort=function(e,t,r){if(n.isEmpty(t)||!n.isObject(t))return e;var i=n.compare,u=r.collation;return n.isObject(u)&&n.isString(u.locale)&&(i=function(e){var t={sensitivity:o[e.strength||3],caseFirst:"off"===e.caseFirst?"false":e.caseFirst||"false",numeric:e.numericOrdering||!1,ignorePunctuation:"shifted"===e.alternate};!0===(e.caseLevel||!1)&&("base"===t.sensitivity&&(t.sensitivity="case"),"accent"===t.sensitivity&&(t.sensitivity="variant"));var r=new Intl.Collator(e.locale,t);return function(e,t){if(!n.isString(e)||!n.isString(t))return n.compare(e,t);var o=r.compare(e,t);return o<0?-1:o>0?1:0}}(u)),e.transform((function(e){for(var o=function(o){var u=n.groupBy(e,(function(e){return n.resolve(e,o)}),null==r?void 0:r.hashFunction),a={},s=n.sortBy(u.keys,(function(e,t){return a[e]=t,e}),i);-1===t[o]&&s.reverse(),e=[];for(var c=0,l=s;c<l.length;c++){var f=l[c];n.into(e,u.groups[a[f]])}},u=0,a=Object.keys(t).reverse();u<a.length;u++)o(a[u]);return e}))};var o={1:"base",2:"accent",3:"variant"}},8734:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$sortByCount=void 0;var n=r(4285),o=r(3469);t.$sortByCount=function(e,t,r){var i={count:{$sum:1}};return i._id=t,o.$sort(n.$group(e,i,r),{count:-1},r)}},49:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$unset=void 0;var n=r(6588),o=r(8203);t.$unset=function(e,t,r){for(var i={},u=0,a=t=n.ensureArray(t);u<a.length;u++)i[a[u]]=0;return o.$project(e,i,r)}},8105:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$unwind=void 0;var n=r(1088),o=r(6588);t.$unwind=function(e,t,r){o.isString(t)&&(t={path:t});var i,u=t.path.substr(1),a=(null==t?void 0:t.includeArrayIndex)||!1,s=t.preserveNullAndEmptyArrays||!1,c=function(e,t){return!1!==a&&(e[a]=t),e};return n.Lazy((function(){for(var t=function(){if(i instanceof n.Iterator&&!(a=i.next()).done)return{value:a};var t=e.next();if(t.done)return{value:t};var r=t.value;if((i=o.resolve(r,u))instanceof Array){if(0===i.length&&!0===s){i=null;var a=o.cloneDeep(r);return o.removeValue(a,u),{value:{value:c(a,null),done:!1}}}i=n.Lazy(i).map((function(e,t){var n=o.cloneDeep(r);return o.setValue(n,u,e),c(n,t)}))}else if(!o.isEmpty(i)||!0===s)return a=o.cloneDeep(r),{value:{value:c(a,null),done:!1}}};;){var r=t();if("object"==typeof r)return r.value}}))}},6842:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$elemMatch=void 0;var n=r(7732),o=r(6588);t.$elemMatch=function(e,t,r,i){var u=o.resolve(e,r),a=new n.Query(t,i);o.assert(u instanceof Array,"$elemMatch: argument must resolve to array");for(var s=0;s<u.length;s++)if(a.test(u[s]))return[u[s]]}},7086:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(6842),t),o(r(3526),t)},3526:function(e,t,r){var n=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],u=0,a=i.length;u<a;u++,o++)n[o]=i[u];return n};Object.defineProperty(t,"__esModule",{value:!0}),t.$slice=void 0;var o=r(6588),i=r(78);t.$slice=function(e,t,r,u){var a=o.resolve(e,r),s=t;return o.isArray(a)?i.$slice(e,t instanceof Array?n([a],s):[a,t],u):a}},518:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$all=void 0;var n=r(2344);t.$all=n.createQueryOperator(n.$all)},9039:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$elemMatch=void 0;var n=r(2344);t.$elemMatch=n.createQueryOperator(n.$elemMatch)},844:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(518),t),o(r(9039),t),o(r(9159),t)},9159:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$size=void 0;var n=r(2344);t.$size=n.createQueryOperator(n.$size)},3406:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$nin=t.$ne=t.$lte=t.$lt=t.$in=t.$gte=t.$gt=t.$eq=void 0;var n=r(2344);t.$eq=n.createQueryOperator(n.$eq),t.$gt=n.createQueryOperator(n.$gt),t.$gte=n.createQueryOperator(n.$gte),t.$in=n.createQueryOperator(n.$in),t.$lt=n.createQueryOperator(n.$lt),t.$lte=n.createQueryOperator(n.$lte),t.$ne=n.createQueryOperator(n.$ne),t.$nin=n.createQueryOperator(n.$nin)},7402:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$exists=void 0;var n=r(2344);t.$exists=n.createQueryOperator(n.$exists)},8252:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(7402),t),o(r(442),t)},442:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$type=void 0;var n=r(2344);t.$type=n.createQueryOperator(n.$type)},3597:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$expr=void 0;var n=r(7424);t.$expr=function(e,t,r){return function(e){return n.computeValue(e,t,null,r)}}},5864:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(3597),t),o(r(5971),t),o(r(9789),t)},5971:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$mod=void 0;var n=r(2344);t.$mod=n.createQueryOperator(n.$mod)},9789:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$regex=void 0;var n=r(2344);t.$regex=n.createQueryOperator(n.$regex)},581:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(844),t),o(r(3406),t),o(r(8252),t),o(r(5864),t),o(r(7676),t)},7770:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$and=void 0;var n=r(7732),o=r(6588);t.$and=function(e,t,r){o.assert(o.isArray(t),"Invalid expression: $and expects value to be an Array");var i=new Array;return t.forEach((function(e){return i.push(new n.Query(e,r))})),function(e){for(var t=0;t<i.length;t++)if(!i[t].test(e))return!1;return!0}}},7676:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(7770),t),o(r(4538),t),o(r(5002),t),o(r(9967),t)},4538:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$nor=void 0;var n=r(6588),o=r(9967);t.$nor=function(e,t,r){n.assert(n.isArray(t),"Invalid expression. $nor expects value to be an Array");var i=o.$or("$or",t,r);return function(e){return!i(e)}}},5002:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$not=void 0;var n=r(7732),o=r(6588);t.$not=function(e,t,r){var i={};i[e]=o.normalize(t);var u=new n.Query(i,r);return function(e){return!u.test(e)}}},9967:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$or=void 0;var n=r(7732),o=r(6588);t.$or=function(e,t,r){o.assert(o.isArray(t),"Invalid expression. $or expects value to be an Array");var i=t.map((function(e){return new n.Query(e,r)}));return function(e){for(var t=0;t<i.length;t++)if(i[t].test(e))return!0;return!1}}},7732:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Query=void 0;var n=r(7424),o=r(9537),i=r(6588),u=function(){function e(e,t){this.__criteria=e,this.__options=n.makeOptions(t),this.__compiled=[],this._compile()}return e.prototype._compile=function(){var e;i.assert(i.isObject(this.__criteria),"query criteria must be an object");for(var t=0,r=Object.entries(this.__criteria);t<r.length;t++){var n=r[t],o=n[0],u=n[1];if("$where"===o)e={field:o,expr:u};else if("$expr"===o)this._processOperator(o,o,u);else if(i.inArray(["$and","$or","$nor"],o))this._processOperator(o,o,u);else{i.assert(!i.isOperator(o),"unknown top level operator: "+o);for(var a=0,s=Object.entries(i.normalize(u));a<s.length;a++){var c=s[a],l=c[0],f=c[1];this._processOperator(o,l,f)}}i.isObject(e)&&this._processOperator(e.field,e.field,e.expr)}},e.prototype._processOperator=function(e,t,r){var o=n.getOperator(n.OperatorType.QUERY,t);i.assert(!!o,"unknown operator "+t);var u=o(e,r,this.__options);this.__compiled.push(u)},e.prototype.test=function(e){for(var t=0,r=this.__compiled.length;t<r;t++)if(!this.__compiled[t](e))return!1;return!0},e.prototype.find=function(e,t){var r=this;return new o.Cursor(e,(function(e){return r.test(e)}),t||{},this.__options)},e.prototype.remove=function(e){var t=this;return e.reduce((function(e,r){return t.test(r)||e.push(r),e}),[])},e}();t.Query=u},6588:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.normalize=t.isOperator=t.removeValue=t.setValue=t.traverse=t.filterMissing=t.resolveGraph=t.resolve=t.memoize=t.into=t.groupBy=t.sortBy=t.compare=t.hashCode=t.unique=t.isEqual=t.flatten=t.union=t.intersection=t.merge=t.objectMap=t.has=t.ensureArray=t.isEmpty=t.truthy=t.notInArray=t.inArray=t.isUndefined=t.isNull=t.isNil=t.isFunction=t.isRegExp=t.isDate=t.isObjectLike=t.isObject=t.isArray=t.isNumber=t.isString=t.isBoolean=t.getType=t.cloneDeep=t.assert=t.BsonType=t.JsType=t.MIN_LONG=t.MAX_LONG=t.MIN_INT=t.MAX_INT=void 0,t.MAX_INT=2147483647,t.MIN_INT=-2147483648,t.MAX_LONG=Number.MAX_SAFE_INTEGER,t.MIN_LONG=Number.MIN_SAFE_INTEGER;var r,n,o={},i=function(e){for(var t=b(e),r=0,n=t.length;n;)r=(r<<5)-r^t.charCodeAt(--n);return(r>>>0).toString()};!function(e){e.NULL="null",e.UNDEFINED="undefined",e.BOOLEAN="boolean",e.NUMBER="number",e.STRING="string",e.DATE="date",e.REGEXP="regexp",e.ARRAY="array",e.OBJECT="object",e.FUNCTION="function"}(r=t.JsType||(t.JsType={})),(n=t.BsonType||(t.BsonType={})).BOOL="bool",n.INT="int",n.LONG="long",n.DOUBLE="double",n.DECIMAL="decimal",n.REGEX="regex";var u=[r.NULL,r.UNDEFINED,r.BOOLEAN,r.NUMBER,r.STRING,r.DATE,r.REGEXP],a=Object.getPrototypeOf({}),s=/^\[object ([a-zA-Z0-9]+)\]$/;function c(e){return s.exec(Object.prototype.toString.call(e))[1]}function l(e){return typeof e===r.STRING}function f(e){if(!e)return!1;var t=Object.getPrototypeOf(e);return(t===a||null===t)&&"[object Object]"===Object.prototype.toString.call(e)}function p(e){return e===Object(e)}function v(e){return e instanceof RegExp}function h(e){return null==e}function y(e,r){return!t.inArray(e,r)}function d(e){return h(e)||l(e)&&!e||e instanceof Array&&0===e.length||f(e)&&0===Object.keys(e).length}function _(e,t){return!!e&&Object.prototype.hasOwnProperty.call(e,t)}function g(e,t){for(var r={},n=Object.keys(e),o=0;o<n.length;o++){var i=n[o];r[i]=t(e[i],i)}return r}function b(e){var t=c(e).toLowerCase();switch(t){case r.BOOLEAN:case r.NUMBER:case r.REGEXP:return e.toString();case r.STRING:return JSON.stringify(e);case r.DATE:return e.toISOString();case r.NULL:case r.UNDEFINED:return t;case r.ARRAY:return"["+e.map(b).join(",")+"]"}var n=t===r.OBJECT?"":""+c(e),o=Object.keys(e);return o.sort(),n+"{"+o.map((function(t){return b(t)+":"+b(e[t])})).join(",")+"}"}function O(e,t){return void 0===t&&(t=i),h(e)?null:t(e)}function m(e,t){return e<t?-1:e>t?1:0}t.assert=function(e,t){if(!e)throw new Error(t)},t.cloneDeep=function e(t){return t instanceof Array?t.map(e):t instanceof Date?new Date(t):f(t)?g(t,e):t},t.getType=c,t.isBoolean=function(e){return typeof e===r.BOOLEAN},t.isString=l,t.isNumber=function(e){return!isNaN(e)&&typeof e===r.NUMBER},t.isArray=Array.isArray||function(e){return e instanceof Array},t.isObject=f,t.isObjectLike=p,t.isDate=function(e){return e instanceof Date},t.isRegExp=v,t.isFunction=function(e){return typeof e===r.FUNCTION},t.isNil=h,t.isNull=function(e){return null===e},t.isUndefined=function(e){return void 0===e},t.inArray=Array.prototype.includes?function(e,t){return e.includes(t)}:function(e,t){return isNaN(t)&&!l(t)?e.some((function(e){return isNaN(e)&&!l(e)})):e.indexOf(t)>-1},t.notInArray=y,t.truthy=function(e){return!!e},t.isEmpty=d,t.ensureArray=function(e){return e instanceof Array?e:[e]},t.has=_,t.objectMap=g,t.merge=function e(r,n,i){if(r===o)return n;if(n===o)return r;var u=[r,n];if(!u.every(f)&&!u.every(t.isArray))throw Error("mismatched types. must both be array or object");if(i=i||{flatten:!1},t.isArray(r)){var a=r,s=n;if(i.flatten){for(var c=0,l=0;c<a.length&&l<s.length;)a[c]=e(a[c++],s[l++],i);for(;l<s.length;)a.push(n[l++])}else Array.prototype.push.apply(a,s)}else Object.keys(n).forEach((function(t){_(r,t)?r[t]=e(r[t],n[t],i):r[t]=n[t]}));return r},t.intersection=function(e,t,r){var n=!1;if(e.length>t.length){var o=e;e=t,t=o,n=!0}for(var i=Math.max(e.length,t.length),u=Math.min(e.length,t.length),a=e.reduce((function(e,t,n){return e[O(t,r)]=n,e}),{}),s=new Array,c=0,l=0;c<i&&l<u;c++){var f=a[O(t[c],r)];void 0!==f&&(s.push(f),l++)}return n||s.sort(),s.map((function(t){return e[t]}))},t.union=function(e,t){var r=[],n=t.filter(y.bind(null,e));return j(r,e),j(r,n),r},t.flatten=function(e,r){var n=[];return function e(r,o){for(var i=0,u=r.length;i<u;i++)t.isArray(r[i])&&(o>0||o<0)?e(r[i],Math.max(-1,o-1)):n.push(r[i])}(e,r),n},t.isEqual=function(e,t){for(var n=[e],o=[t];n.length>0;)if((e=n.pop())!==(t=o.pop())){var i=c(e).toLowerCase();if(i!==c(t).toLowerCase()||i===r.FUNCTION)return!1;if(i===r.ARRAY){var u=e,a=t;if(u.length!==a.length)return!1;if(u.length===a.length&&0===u.length)continue;j(n,u),j(o,a)}else if(i===r.OBJECT){var s=Object.keys(e),l=Object.keys(t);if(s.length!==l.length)return!1;s.sort(),l.sort();for(var f=0,p=s.length;f<p;f++){var v=s[f];if(v!==l[f])return!1;n.push(e[v]),o.push(t[v])}}else if(b(e)!==b(t))return!1}return 0===n.length},t.unique=function(e,t){for(var r={},n=[],o=0,i=e;o<i.length;o++){var u=i[o],a=O(u,t);_(r,a)||(n.push(u),r[a]=0)}return n},t.hashCode=O,t.compare=m,t.sortBy=function(e,t,r){var n=new Array,o=new Array,i={};if(r=r||m,d(e))return e;for(var u=0;u<e.length;u++){var a=e[u],s=t(a,u);h(s)?o.push(a):(l(s)&&(s+="\0"),i[s]?i[s].push(a):i[s]=[a],n.push(s))}for(n.sort(r),u=0;u<n.length;u++)j(o,i[n[u]]);return o},t.groupBy=function(e,t,r){for(var n={keys:new Array,groups:new Array},o={},i=0,u=e;i<u.length;i++){var a=u[i],s=t(a),c=O(s,r),l=-1;void 0===o[c]&&(l=n.keys.length,o[c]=l,n.keys.push(s),n.groups.push([])),l=o[c],n.groups[l].push(a)}return n};var $=5e4;function j(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return e instanceof Array?t.reduce((function(e,t){for(var r=Math.ceil(t.length/$),n=0;r-- >0;)Array.prototype.push.apply(e,t.slice(n,n+$)),n+=$;return e}),e):f(e)?t.filter(p).reduce((function(e,t){return Object.assign(e,t),e}),e):null}function E(e,t){return p(e)?e[t]:void 0}function A(e,t,r,n){var o=t.split("."),i=o[0],u=o.slice(1).join(".");1===o.length?r(e,i):(!0===n&&h(e[i])&&(e[i]={}),A(e[i],u,r,n))}t.into=j,t.memoize=function(e,t){var r,n=this;return r={},function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];var u=O(o,t);return _(r,u)||(r[u]=e.apply(n,o)),r[u]}},t.resolve=function(e,r,n){var o=0;n=n||{unwrapArray:!1};var i=t.inArray(u,c(e).toLowerCase())?e:function e(t,r){for(var n=t,i=function(t){var i=r[t];if(null===/^\d+$/.exec(i)&&n instanceof Array){if(0===t&&o>0)return"break";o+=1;var u=r.slice(t);return n=n.reduce((function(t,r){var n=e(r,u);return void 0!==n&&t.push(n),t}),[]),"break"}if(void 0===(n=E(n,i)))return"break"},u=0;u<r.length&&"break"!==i(u);u++);return n}(e,r.split("."));return i instanceof Array&&n.unwrapArray?function(e,t){if(t<1)return e;for(;t--&&1===e.length;)e=e[0];return e}(i,o):i},t.resolveGraph=function e(t,r,n){void 0===n&&(n={preserveMissing:!1});var i,u,a=r.split("."),s=a[0],c=a.slice(1).join("."),l=null!==/^\d+$/.exec(s),f=a.length>1;if(t instanceof Array)if(l)i=E(t,Number(s)),f&&(i=e(i,c,n)),i=[i];else{i=[];for(var p=0,v=t;p<v.length;p++)u=e(v[p],r,n),n.preserveMissing?(void 0===u&&(u=o),i.push(u)):void 0!==u&&i.push(u)}else{if(u=E(t,s),f&&(u=e(u,c,n)),void 0===u)return;(i={})[s]=u}return i},t.filterMissing=function e(t){if(t instanceof Array)for(var r=t.length-1;r>=0;r--)t[r]===o?t.splice(r,1):e(t[r]);else if(f(t))for(var n in t)_(t,n)&&e(t[n])},t.traverse=A,t.setValue=function(e,t,r){A(e,t,(function(e,t){e[t]=r}),!0)},t.removeValue=function(e,t){A(e,t,(function(e,t){if(e instanceof Array)if(/^\d+$/.test(t))e.splice(parseInt(t),1);else for(var r=0,n=e;r<n.length;r++){var o=n[r];f(o)&&delete o[t]}else f(e)&&delete e[t]}))};var w=/^\$[a-zA-Z0-9_]+$/;function M(e){return w.test(e)}t.isOperator=M,t.normalize=function(e){if(t.inArray(u,c(e).toLowerCase()))return v(e)?{$regex:e}:{$eq:e};if(p(e)){if(!Object.keys(e).some(M))return{$eq:e};_(e,"$regex")&&(e.$regex=new RegExp(e.$regex,e.$options),delete e.$options)}return e}}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,r),i.exports}(()=>{var e=r(4406);function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function r(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this._expression={},this.change(e)}var o,i;return o=r,(i=[{key:"expression",get:function(){return this._expression}},{key:"change",value:function(e){if("object"!==t(e)||null===e)throw new Error("Expressions can only be objects!");this._expression=e}},{key:"check",value:function(t){var r=!1;try{r=new e.AE(this._expression).test(t.keys)}catch(e){r=!1}return r}}])&&n(o.prototype,i),r}();function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var u=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._values={}}var r,n;return r=t,(n=[{key:"keys",get:function(){return this._values}},{key:"set",value:function(e,t){this._values[e]=t}},{key:"get",value:function(e){var t=null;return this.exists(e)&&(t=this._values[e]),t}},{key:"delete",value:function(e){var t=null;return this.exists(e)&&(t=this.get(e),delete this._values[e]),t}},{key:"exists",value:function(t){return new e.AE(function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},t,{$exists:!0})).test(this._values)}},{key:"size",value:function(){return Object.keys(this._values).length}}])&&i(r.prototype,n),t}();function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var c,l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._set=[]}var t,r;return t=e,(r=[{key:"add",value:function(e){if("object"!==a(e)||null===e)throw new Error("Qualities must be objects!");if(!this.has(e)){var t=new o(e);this._set.push(t)}}},{key:"has",value:function(e){if("object"===a(e)&&null!==e)return this._set.some((function(t){return JSON.stringify(t.expression)===JSON.stringify(e)}));throw new Error("Can only check object values!")}},{key:"remove",value:function(e){if("object"!==a(e)||null===e)throw new Error("Must pass object values to remove!");this._set=this._set.filter((function(t){return JSON.stringify(t.expression)!==JSON.stringify(e)}))}},{key:"check",value:function(e){if(e instanceof u)return this._set.every((function(t){return t.check(e)}));throw new Error("Must have State to check() against!")}},{key:"size",value:function(){return this._set.length}}])&&s(t.prototype,r),e}(),f=new Uint8Array(16);function p(){if(!c&&!(c="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return c(f)}const v=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,h=function(e){return"string"==typeof e&&v.test(e)};for(var y=[],d=0;d<256;++d)y.push((d+256).toString(16).substr(1));const _=function(e,t,r){var n=(e=e||{}).random||(e.rng||p)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var o=0;o<16;++o)t[r+o]=n[o];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(y[e[t+0]]+y[e[t+1]]+y[e[t+2]]+y[e[t+3]]+"-"+y[e[t+4]]+y[e[t+5]]+"-"+y[e[t+6]]+y[e[t+7]]+"-"+y[e[t+8]]+y[e[t+9]]+"-"+y[e[t+10]]+y[e[t+11]]+y[e[t+12]]+y[e[t+13]]+y[e[t+14]]+y[e[t+15]]).toLowerCase();if(!h(r))throw TypeError("Stringified UUID is invalid");return r}(n)};function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var O=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];g(this,e),this.content=t,this.qualities=r,this._hash=_()}var t,r;return t=e,(r=[{key:"content",get:function(){return this._content},set:function(e){if("string"!=typeof e)throw new Error("Content must be expressed as a string!");this._content=e}},{key:"qualities",get:function(){return this._qualities},set:function(e){var t=this;if(!Array.isArray(e))throw new Error("Qualities must be expressed as an array!");this._qualities=new l(this.state),e.forEach((function(e){return t.addQuality(e)}))}},{key:"hash",get:function(){return this._hash}},{key:"isAvailable",value:function(e){if(e instanceof u)return this._qualities.check(e);throw new Error("Must be passed State to check if available")}},{key:"addQuality",value:function(e){this._qualities.add(e)}},{key:"removeQuality",value:function(e){this._qualities.remove(e)}}])&&b(t.prototype,r),e}();function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var $=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.cards=[],this._state=new u}var t,r;return t=e,(r=[{key:"state",get:function(){return this._state},set:function(e){if(!(e instanceof u))throw new Error("Passed value is not an instance of State");this._state=e}},{key:"getCard",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=null;return e>=0&&e<this.cards.length&&(t=this.cards[e]),t}},{key:"updateCard",value:function(e){if(!(e instanceof O))throw new Error("Updated card must be Card!");this.cards.forEach((function(t){t.hash===e.hash&&(t=e)}))}},{key:"size",value:function(){return this.cards.length}},{key:"addCard",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if("string"!=typeof e)throw new Error("Card content must be string!");if(!Array.isArray(t))throw new Error("Qualities must be passed as array!");var r=new O(e,t);this.cards.push(r)}},{key:"removeCard",value:function(e){this.cards=this.cards.filter((function(t){return t!==e}))}},{key:"shuffle",value:function(){for(var e=this.cards.length-1;e>0;e--){var t=Math.floor(Math.random()*(e+1)),r=[this.cards[t],this.cards[e]];this.cards[e]=r[0],this.cards[t]=r[1]}}},{key:"draw",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=[];return t>0&&(r=(r=this.cards.filter((function(t){return t.isAvailable(e.state)}))).slice(0,t)),r}}])&&m(t.prototype,r),e}();window.Card=O,window.Deck=$,window.Expression=o,window.QualitySet=l,window.State=u})()})();