!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.SimpleQBN=e():t.SimpleQBN=e()}(this,()=>(()=>{"use strict";var t,e={d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},s={};e.r(s),e.d(s,{Card:()=>v,Deck:()=>N,Expression:()=>p,QualitySet:()=>l,State:()=>d,default:()=>y}),function(t){t.NUMBER="NUMBER",t.STRING="STRING",t.BOOLEAN="BOOLEAN",t.NULL="NULL",t.VARIABLE="VARIABLE",t.DOT="DOT",t.LBRACKET="LBRACKET",t.RBRACKET="RBRACKET",t.EQUALS="EQUALS",t.NOT_EQUALS="NOT_EQUALS",t.GREATER_THAN="GREATER_THAN",t.GREATER_THAN_EQUAL="GREATER_THAN_EQUAL",t.LESS_THAN="LESS_THAN",t.LESS_THAN_EQUAL="LESS_THAN_EQUAL",t.PLUS="PLUS",t.MINUS="MINUS",t.MULTIPLY="MULTIPLY",t.DIVIDE="DIVIDE",t.IS="IS",t.IS_NOT="IS_NOT",t.GT="GT",t.GTE="GTE",t.LT="LT",t.LTE="LTE",t.AND="AND",t.OR="OR",t.NOT="NOT",t.CUSTOM="CUSTOM",t.COLON="COLON",t.IDENTIFIER="IDENTIFIER",t.LPAREN="LPAREN",t.RPAREN="RPAREN",t.EOF="EOF",t.WHITESPACE="WHITESPACE"}(t||(t={}));class i{constructor(t){this.input=t.trim(),this.position=0,this.tokens=[]}tokenize(){for(this.tokens=[],this.position=0;this.position<this.input.length&&(this.skipWhitespace(),!(this.position>=this.input.length));){const t=this.peek();if(this.isDigit(t)||"-"===t&&this.isDigit(this.peekNext()))this.tokenizeNumber();else if('"'===t||"'"===t)this.tokenizeString();else if("$"===t)this.tokenizeVariable();else if(this.position+1<this.input.length){const e=this.input.slice(this.position,this.position+2);if(this.tokenizeTwoCharOperator(e))continue;this.tokenizeSingleChar(t)}else this.tokenizeSingleChar(t)}return this.addToken(t.EOF,""),this.tokens}peek(){return this.position<this.input.length?this.input[this.position]:""}peekNext(){return this.position+1<this.input.length?this.input[this.position+1]:""}advance(){return this.position<this.input.length?this.input[this.position++]:""}skipWhitespace(){for(;this.position<this.input.length&&/\s/.test(this.input[this.position]);)this.position++}isDigit(t){return/[0-9]/.test(t)}isLetter(t){return/[a-zA-Z_]/.test(t)}isAlphaNumeric(t){return/[a-zA-Z0-9_]/.test(t)}addToken(t,e){this.tokens.push({type:t,value:e,position:this.position-e.length})}tokenizeNumber(){const e=this.position;let s=!1;for("-"===this.peek()&&this.advance();this.position<this.input.length;){const t=this.peek();if(this.isDigit(t))this.advance();else{if("."!==t||s)break;s=!0,this.advance()}}const i=this.input.slice(e,this.position);this.addToken(t.NUMBER,i)}tokenizeString(){const e=this.advance(),s=this.position;for(;this.position<this.input.length&&this.peek()!==e;)this.advance();if(this.position>=this.input.length)throw new Error("Unterminated string starting at position "+(s-1));const i=this.input.slice(s,this.position);this.advance(),this.addToken(t.STRING,i)}tokenizeVariable(){const e=this.position;for(this.advance();this.position<this.input.length&&this.isAlphaNumeric(this.peek());)this.advance();const s=this.input.slice(e+1,this.position);this.addToken(t.VARIABLE,s)}tokenizeIdentifier(){const t=this.position;for(;this.position<this.input.length&&this.isAlphaNumeric(this.peek());)this.advance();return this.input.slice(t,this.position)}tokenizeKeywordOrIdentifier(){const e=this.tokenizeIdentifier();switch(e.toLowerCase()){case"true":this.addToken(t.BOOLEAN,"true");break;case"false":this.addToken(t.BOOLEAN,"false");break;case"null":this.addToken(t.NULL,"null");break;case"and":this.addToken(t.AND,"and");break;case"or":this.addToken(t.OR,"or");break;case"not":this.addToken(t.NOT,"not");break;case"is":this.skipWhitespace(),"not"===this.input.slice(this.position,this.position+3).toLowerCase()?(this.position+=3,this.addToken(t.IS_NOT,"is not")):this.addToken(t.IS,"is");break;case"gt":this.addToken(t.GT,"gt");break;case"gte":this.addToken(t.GTE,"gte");break;case"lt":this.addToken(t.LT,"lt");break;case"lte":this.addToken(t.LTE,"lte");break;case"custom":this.addToken(t.CUSTOM,"custom");break;default:this.addToken(t.IDENTIFIER,e)}}tokenizeTwoCharOperator(e){switch(e){case"==":return this.position+=2,this.addToken(t.EQUALS,"=="),!0;case"!=":return this.position+=2,this.addToken(t.NOT_EQUALS,"!="),!0;case">=":return this.position+=2,this.addToken(t.GREATER_THAN_EQUAL,">="),!0;case"<=":return this.position+=2,this.addToken(t.LESS_THAN_EQUAL,"<="),!0;case"&&":return this.position+=2,this.addToken(t.AND,"&&"),!0;case"||":return this.position+=2,this.addToken(t.OR,"||"),!0;default:return!!this.isLetter(e[0])&&(this.tokenizeKeywordOrIdentifier(),!0)}}tokenizeSingleChar(e){switch(e){case">":this.advance(),this.addToken(t.GREATER_THAN,">");break;case"<":this.advance(),this.addToken(t.LESS_THAN,"<");break;case"(":this.advance(),this.addToken(t.LPAREN,"(");break;case")":this.advance(),this.addToken(t.RPAREN,")");break;case".":this.advance(),this.addToken(t.DOT,".");break;case"[":this.advance(),this.addToken(t.LBRACKET,"[");break;case"]":this.advance(),this.addToken(t.RBRACKET,"]");break;case":":this.advance(),this.addToken(t.COLON,":");break;case"!":this.advance(),this.addToken(t.NOT,"!");break;case"+":this.advance(),this.addToken(t.PLUS,"+");break;case"-":if(this.isDigit(this.peekNext()))throw new Error(`Unexpected character '${e}' at position ${this.position}`);this.advance(),this.addToken(t.MINUS,"-");break;case"*":this.advance(),this.addToken(t.MULTIPLY,"*");break;case"/":this.advance(),this.addToken(t.DIVIDE,"/");break;default:if(!this.isLetter(e))throw new Error(`Unexpected character '${e}' at position ${this.position}`);this.tokenizeKeywordOrIdentifier()}}}class r{constructor(t){this.tokens=t,this.current=0}parse(){const t=this.parseOrExpression();if(!this.isAtEnd()){const t=this.peek();throw new Error(`Unexpected token '${t.value}' at position ${t.position}`)}return t}parseOrExpression(){let e=this.parseAndExpression();for(;this.match(t.OR);){const t=this.previous().value,s=this.parseAndExpression();e=this.createBinaryNode(t,e,s)}return e}parseAndExpression(){let e=this.parseComparisonExpression();for(;this.match(t.AND);){const t=this.previous().value,s=this.parseComparisonExpression();e=this.createBinaryNode(t,e,s)}return e}parseComparisonExpression(){if(this.match(t.NOT)){const t=this.previous().value,e=this.parseComparisonExpression();return this.createUnaryNode(t,e)}const e=this.parseArithmeticExpression();if(this.match(t.CUSTOM)){this.consume(t.COLON,"Expected ':' after 'custom'");const s=this.consume(t.IDENTIFIER,"Expected condition name after 'custom:'").value,i=this.parseArithmeticExpression();return this.createCustomConditionNode(s,e,i)}if(this.matchComparison()){const t=this.previous().value,s=this.parseArithmeticExpression();return this.createBinaryNode(t,e,s)}return e}parseArithmeticExpression(){return this.parseAdditionExpression()}parseAdditionExpression(){let e=this.parseMultiplicationExpression();for(;this.match(t.PLUS,t.MINUS);){const t=this.previous().value,s=this.parseMultiplicationExpression();e=this.createBinaryNode(t,e,s)}return e}parseMultiplicationExpression(){let e=this.parseValue();for(;this.match(t.MULTIPLY,t.DIVIDE);){const t=this.previous().value,s=this.parseValue();e=this.createBinaryNode(t,e,s)}return e}parseValue(){if(this.match(t.NUMBER)){const t=parseFloat(this.previous().value);return this.createLiteralNode(t)}if(this.match(t.STRING)){const t=this.previous().value;return this.createLiteralNode(t)}if(this.match(t.BOOLEAN)){const t="true"===this.previous().value;return this.createLiteralNode(t)}if(this.match(t.NULL))return this.createLiteralNode(null);if(this.match(t.LPAREN)){const e=this.parseOrExpression();return this.consume(t.RPAREN,"Expected ')' after expression"),e}if(this.match(t.VARIABLE)){const e=this.previous().value;if(this.match(t.DOT)){const s=this.consume(t.IDENTIFIER,"Expected property name after '.'").value;return this.createPropertyAccessNode(e,s,"dot")}if(this.match(t.LBRACKET)){let s;if(this.check(t.STRING))s=this.advance().value;else{if(!this.check(t.IDENTIFIER))throw new Error("Expected string or identifier in bracket notation");s=this.advance().value}return this.consume(t.RBRACKET,"Expected ']' after property name"),this.createPropertyAccessNode(e,s,"bracket")}return this.createVariableNode(e)}throw new Error(`Unexpected token '${this.peek().value}' at position ${this.peek().position}`)}match(...t){for(const e of t)if(this.check(e))return this.advance(),!0;return!1}matchComparison(){return this.match(t.EQUALS,t.NOT_EQUALS,t.GREATER_THAN,t.GREATER_THAN_EQUAL,t.LESS_THAN,t.LESS_THAN_EQUAL,t.IS,t.IS_NOT,t.GT,t.GTE,t.LT,t.LTE)}check(t){return!this.isAtEnd()&&this.peek().type===t}advance(){return this.isAtEnd()||this.current++,this.previous()}isAtEnd(){return this.peek().type===t.EOF}peek(){return this.tokens[this.current]}previous(){return this.tokens[this.current-1]}consume(t,e){if(this.check(t))return this.advance();const s=this.peek();throw new Error(`${e}. Got '${s.value}' at position ${s.position}`)}createLiteralNode(t){return{type:"literal",value:t}}createVariableNode(t){return{type:"variable",name:t}}createPropertyAccessNode(t,e,s){return{type:"property",object:t,property:e,notation:s}}createBinaryNode(t,e,s){return{type:"binary",operator:t,left:e,right:s}}createUnaryNode(t,e){return{type:"unary",operator:t,operand:e}}createCustomConditionNode(t,e,s){return{type:"custom",name:t,left:e,right:s}}}class n{constructor(t={}){this.options=t}evaluate(t){switch(t.type){case"literal":return this.evaluateLiteral(t);case"variable":return this.evaluateVariable(t);case"property":return this.evaluatePropertyAccess(t);case"binary":return this.evaluateBinaryOperation(t);case"unary":return this.evaluateUnaryOperation(t);case"custom":return this.evaluateCustomCondition(t);default:throw new Error(`Unknown AST node type: ${t.type}`)}}evaluateLiteral(t){return t.value}evaluateVariable(t){if(this.options.values&&"function"==typeof this.options.values)try{return this.options.values(t.name)}catch(t){return null}return null}evaluatePropertyAccess(t){if(this.options.values&&"function"==typeof this.options.values)try{const e=this.options.values(t.object);if(e&&"object"==typeof e&&t.property in e)return e[t.property]}catch(t){return null}return null}evaluateBinaryOperation(t){const e=this.evaluate(t.left),s=this.evaluate(t.right);switch(t.operator.toLowerCase()){case"&&":case"and":return!!e&&!!s;case"||":case"or":return e||s;case"==":case"is":return e==s;case"!=":case"is not":return e!=s;case">":case"gt":return e>s;case">=":case"gte":return e>=s;case"<":case"lt":return e<s;case"<=":case"lte":return e<=s;case"+":return e+s;case"-":return Number(e)-Number(s);case"*":return Number(e)*Number(s);case"/":return Number(e)/Number(s);default:throw new Error(`Unknown binary operator: ${t.operator}`)}}evaluateUnaryOperation(t){const e=this.evaluate(t.operand);switch(t.operator){case"!":case"not":return!e;default:throw new Error(`Unknown unary operator: ${t.operator}`)}}evaluateCustomCondition(t){const e=this.evaluate(t.left),s=this.evaluate(t.right);if(this.options.customConditions&&"function"==typeof this.options.customConditions[t.name])return this.options.customConditions[t.name](e,s);throw new Error(`Custom condition '${t.name}' is not defined`)}}class o extends Error{constructor(t,e,s,i){super(t),this.name="SyntaxError",this.expected=e,this.found=s,this.location=i}format(){let t=this.message;return this.location&&(t+=` at line ${this.location.start.line}, column ${this.location.start.column}`),t}}const a={},h={parse:(t,e)=>function(t,e){try{const s=new i(t).tokenize(),o=new r(s).parse();return new n(e).evaluate(o)}catch(t){if(t instanceof Error)throw new o(t.message,[],null);throw t}}(t,{...e,customConditions:{...a,...e?.customConditions}}),SyntaxError:o,addCustomCondition:(t,e)=>{a[t]=e},removeCustomCondition:t=>t in a&&(delete a[t],!0),getCustomConditions:()=>({...a}),clearCustomConditions:()=>{Object.keys(a).forEach(t=>{delete a[t]})}},c=h,{parse:u}=c;class p{constructor(t){this._expression="",this.change(t)}get expression(){return this._expression}change(t){if("string"!=typeof t)throw new Error("Expressions must be strings!");this._expression=t}check(t){if(!t||!t.keys)return!1;try{const e=e=>t.keys[e];return u(this._expression,{values:e})}catch(t){return console.warn("Expression check failed:",t),!1}}}class d{constructor(){this._values={}}get keys(){return this._values}set(t,e){this._values[t]=e}get(t){let e=null;return this.exists(t)&&(e=this._values[t]),e}delete(t){let e=null;return this.exists(t)&&(e=this.get(t),delete this._values[t]),e}exists(t){return Object.prototype.hasOwnProperty.call(this._values,t)}size(){return Object.keys(this._values).length}}class l{constructor(){this._set=[]}add(t){if("string"!=typeof t)throw new Error("Qualities must be strings!");if(!this.has(t)){const e=new p(t);this._set.push(e)}}has(t){if("string"!=typeof t)throw new Error("Can only check string values!");return this._set.some(e=>e.expression===t)}remove(t){if("string"!=typeof t)throw new Error("Must pass string values to remove!");this._set=this._set.filter(e=>e.expression!==t)}check(t){if(t instanceof d)return this._set.every(e=>e.check(t));throw new Error("Must have State to check() against!")}size(){return this._set.length}}const E={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let f;const k=new Uint8Array(16),T=[];for(let t=0;t<256;++t)T.push((t+256).toString(16).slice(1));function m(t,e,s){const i=(t=t||{}).random??t.rng?.()??function(){if(!f){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");f=crypto.getRandomValues.bind(crypto)}return f(k)}();if(i.length<16)throw new Error("Random bytes length must be >= 16");if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,e){if((s=s||0)<0||s+16>e.length)throw new RangeError(`UUID byte range ${s}:${s+15} is out of buffer bounds`);for(let t=0;t<16;++t)e[s+t]=i[t];return e}return function(t,e=0){return(T[t[e+0]]+T[t[e+1]]+T[t[e+2]]+T[t[e+3]]+"-"+T[t[e+4]]+T[t[e+5]]+"-"+T[t[e+6]]+T[t[e+7]]+"-"+T[t[e+8]]+T[t[e+9]]+"-"+T[t[e+10]]+T[t[e+11]]+T[t[e+12]]+T[t[e+13]]+T[t[e+14]]+T[t[e+15]]).toLowerCase()}(i)}class v{constructor(t="",e=[]){var s,i,r;this._content="",this._qualities=new l,this.content=t,this.qualities=e,this._hash=!E.randomUUID||i||s?m(s,i,r):E.randomUUID()}get content(){return this._content}set content(t){if("string"!=typeof t)throw new Error("Content must be expressed as a string!");this._content=t}get qualities(){return this._qualities}set qualities(t){this._qualities=new l,t.forEach(t=>this.addQuality(t))}get hash(){return this._hash}isAvailable(t){if(t instanceof d)return this._qualities.check(t);throw new Error("Must be passed State to check if available")}addQuality(t){this._qualities.add(t)}removeQuality(t){this._qualities.remove(t)}}class N{constructor(){this.cards=[],this._state=new d}get state(){return this._state}set state(t){if(!(t instanceof d))throw new Error("Passed value is not an instance of State");this._state=t}getCard(t=-1){let e=null;return t>=0&&t<this.cards.length&&(e=this.cards[t]),e}updateCard(t){if(!(t instanceof v))throw new Error("Updated card must be Card!");this.cards.forEach((e,s)=>{e.hash===t.hash&&(this.cards[s]=t)})}size(){return this.cards.length}addCard(t,e=[]){if("string"!=typeof t)throw new Error("Card content must be string!");if(!Array.isArray(e))throw new Error("Qualities must be passed as array!");const s=new v(t,e);this.cards.push(s)}removeCard(t){this.cards=this.cards.filter(e=>e!==t)}shuffle(){for(let t=this.cards.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[this.cards[t],this.cards[e]]=[this.cards[e],this.cards[t]]}}draw(t=1){let e=[];return t>0&&(e=this.cards.filter(t=>t.isAvailable(this.state)),e=e.slice(0,t)),e}}"undefined"!=typeof window&&(window.SimpleQBN={Card:v,Deck:N,Expression:p,QualitySet:l,State:d});const y={Card:v,Deck:N,Expression:p,QualitySet:l,State:d};return s})());